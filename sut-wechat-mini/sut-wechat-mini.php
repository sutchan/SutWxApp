锘块敇鍧楁晣??php\n/**\n * Plugin Name: SUT闁诲海鏁婚崑濠囧窗閺囩喓鈹嶅┑鐘插閻掑﹪鐓崶銊︾５闁哄被鍊濋獮?
 * Plugin URI: https://github.com/sutchan/SutWxApp\n * Description: 濠电偞鍨堕幐楣冾敋濞撴獧dPress缂傚倸鍊搁崯顖炲垂瑜版帗鍋熸い鏍仜缁犵敻鏌熼柇锔跨敖閺夆晜姊婚埀顒傛暬閸嬪﹪宕伴弴鐔衡攳濠电姴瀚悞濠囩叓閸ャ劍纾甸柡灞诲€濋獮鏍级閹寸姷顔囧銈嗘处閸ｏ綁鐛幒妤€唯闁靛鍎哄顒勬⒑閼圭増鐝柡瀣吹濡叉劕鈹戠€ｎ亞鍝楀銈嗙墬缁嬫垿鎯侀鈧弻娑㈠箛椤掍礁娅ｅ銈嗘⒐閸旀绂掗敃鍌氬嵆闁绘﹩鍠曠划鐢告⒑闂堟稒顥欓柤鍐茬埣瀵偊骞栨担鍝ユ焾闂佺硶鍓濋〃鍛达綖閻樼粯鐓犻柛鎰▕濞肩喖鏌嶈閸忔盯鎳楅崼鏇炴瀬闁靛牆顦粻锝咁渻鐎ｎ亜鐦ㄩ柛姘ｅ亾闂備浇宕甸崑娑樜涙惔銊ョ劦妞ゆ垼娉曢崝宥囩磼婢跺苯鍘存鐐扮窔椤㈡稑鈽夊Ο鍨倕闂傚倷绶￠崑鍌炴嚄閸洘鍋ら柟杈剧畱杩?
 * Version: 1.0.9\n * Author: SUT\n * Author URI: https://github.com/sutchan\n * License: GPL2\n * License URI: https://www.gnu.org/licenses/gpl-2.0.html\n * Text Domain: sut-wechat-mini\n * Domain Path: /languages\n *\n * SUT闁诲海鏁婚崑濠囧窗閺囩喓鈹嶅┑鐘插閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔夊┑鈩冨絻閹诧紕绮欐径鎰劦妞ゆ帊鑳堕埢鏃€銇勮箛鎾虫殺缂佲偓婵狗rdPress缂傚倸鍊搁崯顖炲垂瑜版帗鍋熸い鏍仜缁犵敻鏌熼柇锔跨敖閺夆晜姊婚埀顒傛暬閸嬪﹪宕伴弴鐔衡攳濠电姴瀚悞濠囩叓閸ャ劍纾甸柡灞诲€濋獮鏍级閹寸姷顔囧銈嗘处閸ｏ綁鐛幒妤€唯闁靛鍎哄顒勬⒑閻撳海锛嶉柡鍜佸亜閳绘捇骞嬮敃鈧粻鐢告煙閸濆嫮校妞ゆ劒绮欓弻?
 * 闂備浇銆€閸嬫挻銇勯弽銊р槈闁伙富鍣ｉ弻娑㈠箛椤掍礁娅ｅ銈嗘⒐閸旀绂掗敃鍌氬嵆闁绘﹩鍠曠划鐢告⒑闂堟稒顥欓柤鍐茬埣瀵偊骞栨担鍝ユ焾闂佺硶鍓濋〃鍛达綖閻樼粯鐓犻柛鎰▕濞肩喖鏌嶈閸忔盯鎳楅崼鏇炴瀬闁靛牆顦粻锝咁渻鐎ｎ亜鐦ㄩ柛姘ｅ亾闂備浇宕甸崑娑樜涙惔銊ョ劦妞ゆ垼娉曢崝宥囩磼婢跺苯鍘存鐐扮窔椤㈡稑鈽夊Ο鍨倕闂傚倷绶￠崑鍌炴嚄閸洘鍋ら柟杈剧畱缁€澶愭煟閺冨浂鍤欓柛妯绘尦閺?
 *\n * @package SUT_WeChat_Mini\n */\n\n// 闂傚倸鍊搁崯顐㈩嚕閸洦鏁嗘繛鎴欏灪閸庡酣鎮楀☉娅亝寰勫澶嬪仯濞达絽鎲￠崑銉︿繆椤愩伄顡磇f ( ! defined( 'ABSPATH' ) ) {\n    exit;\n}\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪€栭崑瀣煕椤愩倕鏋戦柟鐑戒憾閺?
 */\ndefine( 'SUT_WECHAT_MINI_VERSION', '1.0.9' );\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪€栭崕搴亜閺冨洤浜圭紒澶庢硶缁辨挻鎷呴崷顓犵暤濡炪倖娲﹂崰姘跺箲閸曨垼鏁嶆慨妯夸含閻涚敍n */\ndefine( 'SUT_WECHAT_MINI_PLUGIN_DIR', plugin_dir_path( __FILE__ ) );\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庢い銏㈢潕L\n */\ndefine( 'SUT_WECHAT_MINI_PLUGIN_URL', plugin_dir_url( __FILE__ ) );\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇ョ磿閳绘梻绱撴担鑲℃垿鎮楅娴庡綊鎮╅崘鎻掑Ц闂佹椿鍘介崕鎶筋敋?
 */\ndefine( 'SUT_WECHAT_MINI_PLUGIN_FILE', __FILE__ );\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪€曢崘鈧梺闈╁瘜閸樼晫绮ｅΔ鍐╁枑闁绘鐗婄粈鈧梺璇″枟濡差櫞 */\ndefine( 'SUT_WECHAT_MINI_PLUGIN_BASENAME', plugin_basename( __FILE__ ) );\n\n/**\n * 闂備礁鎲″缁樻叏閹灐褰掑炊瑜滈崯鍛存煏婢跺牆鍔氱€电増妫冮弻娑㈠箣閿濆憛鎾绘煛閸℃瑥澧祅 */\nif ( ! class_exists( 'SUT_WeChat_Mini_Utils' ) ) {\n    require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/utils/class-sut-wechat-mini-utils.php';\n}\n\n/**\n * 闂備礁鎲″缁樻叏閹灐褰掑炊閳规儳浜鹃柣鐔煎亰濡插吋銇勯妷銉姛闁?
 */\nif ( ! class_exists( 'SUT_WeChat_Mini_Install' ) ) {\n    require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/install.php';\n}\n\n/**\n * 闂備礁鎲″缁樻叏閹灐褰掑炊椤掆偓缁€澶愭煟濡厧鍔嬬紒浣峰嵆閺屾盯鏁愰崘銊ヮ瀷闁荤偞姘ㄧ敮鐒?*/\nif ( ! class_exists( 'SUT_WeChat_Mini_Loader' ) ) {\n    require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/class-sut-wechat-mini-loader.php';\n}\n\n/**\n * 闂備礁鎲＄敮妤冩崲閸岀儑缍栭柟鐗堟緲缁€宀勬煛瀹ュ啫濡肩紒鑼额嚙闇?
 *\n * @return SUT_WeChat_Mini_Loader 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪€曠粈澶愭煟濡厧鍔嬬紒浣峰嵆閺屾盯鏁愰崘銊ヮ瀳闂佹眹鍊曠€氼厾绮?
 */\nfunction sut_wechat_mini_init() {\n    // 婵犵妲呴崑鈧柛瀣崌閺屸€崇暆婵犲啰寮窰P闂備胶绮〃鍛存偋婵犲偊鑰块柣褉鏆?   if ( version_compare( PHP_VERSION, '5.6.0', '<' ) ) {\n        add_action( 'admin_notices', 'sut_wechat_mini_php_version_notice' );\n        return;\n    }\n    \n    // 婵犵妲呴崑鈧柛瀣崌閺屸€崇暆婵犲啰褰噊rdPress闂備胶绮〃鍛存偋婵犲偊鑰块柣褉鏆?   if ( version_compare( get_bloginfo( 'version' ), '4.7', '<' ) ) {\n        add_action( 'admin_notices', 'sut_wechat_mini_wp_version_notice' );\n        return;\n    }\n    \n    // 闂備礁鎲＄敮妤冩崲閸岀儑缍栭柟鐗堟緲缁€宀勬煛瀹擃喖鍠氬閬嶆煛婢跺苯浠╂俊顐㈠閳诲秹骞庨崓?   $loader = SUT_WeChat_Mini_Loader::get_instance();\n    \n    return $loader;\n}\n\n/**\n * 闂備礁鎼€氼剚鏅舵禒瀣︽慨婵嗗皞P闂備胶绮〃鍛存偋婵犲偊鑰块柣妤€鐗忛埢鏃傗偓骞垮劚閹冲酣骞冮幋锔藉€甸柣鐔稿缁夋椽鏌嶈閸撴艾顫濋妸鈺傚亗妞も槅鏅?*/\nfunction sut_wechat_mini_php_version_notice() {\n    $notice = sprintf( \n        esc_html__( 'SUT闁诲海鏁婚崑濠囧窗閺囩喓鈹嶅┑鐘插閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔夐悷婊勬緲閸燁垳绮嬮幒妤€閱囬柡鍥╁枍缁垶鏌ｉ悢鍛婄；閻犙冣攬P 5.6.0闂備胶鎳撻悺銊╂偋濡も偓鐓ら柟绋垮瘨濞堟淇婇婊冨付妞わ絽銈搁弻锟犲醇椤愩垹顫繝鈷€鍛枅闁硅櫕顨婂畷鎰版偄閾忚鍚嬮梺鑽ゅ仦缁嬫垹鎮锕€鐒垫い鎺嗗亾闁稿﹤鎽滅槐鐐碘偓锝庡枛缁€鍫⑩偓骞垮劚濡绂嶉崼鏇熺厽闁靛鍎卞▓绯嶱闂備胶绮〃鍛存偋婵犲偊鑰垮ù鍏兼綑閸?%s闂備線娼уΛ妤呭磹娴犲鏁嬫い鎺戝绾偓闂佹悶鍎弲鐘绘偘閹剧粯鐓欐い鏂挎惈婵℃寧绻涢崼鐔峰箹HP闂備胶绮〃鍛存偋婵犲偊鑰垮ù鍏兼綑杩?, 'sut-wechat-mini' ), \n        PHP_VERSION\n    );\n    \n    echo '<div class="notice notice-error"><p>' . esc_html( $notice ) . '</p></div>';\n}\n\n/**\n * 闂備礁鎼€氼剚鏅舵禒瀣︽慨婵囦粶rdPress闂備胶绮〃鍛存偋婵犲偊鑰块柣妤€鐗忛埢鏃傗偓骞垮劚閹冲酣骞冮幋锔藉€甸柣鐔稿缁夋椽鏌嶈閸撴艾顫濋妸鈺傚亗妞も槅鏅?*/\nfunction sut_wechat_mini_wp_version_notice() {\n    $notice = sprintf( \n        esc_html__( 'SUT闁诲海鏁婚崑濠囧窗閺囩喓鈹嶅┑鐘插閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔夐悷婊勬緲閸燁垳绮嬮幒妤€閱囬柡鍥╁枍缁垶鏌ｉ悢鍛婄；缂佺姵螙rdPress 4.7闂備胶鎳撻悺銊╂偋濡も偓鐓ら柟绋垮瘨濞堟淇婇婊冨付妞わ絽銈搁弻锟犲醇椤愩垹顫繝鈷€鍛枅闁硅櫕顨婂畷鎰版偄閾忚鍚嬮梺鑽ゅ仦缁嬫垹鎮锕€鐒垫い鎺嗗亾闁稿﹤鎽滅槐鐐碘偓锝庡枛缁€鍫⑩偓骞垮劚濡绂嶉崼鏇熺厽闁靛鍎遍悗绶妑dPress闂備胶绮〃鍛存偋婵犲偊鑰垮ù鍏兼綑閸?%s闂備線娼уΛ妤呭磹娴犲鏁嬫い鎺戝绾偓闂佹悶鍎弲鐘绘偘閹剧粯鐓欐い鏂挎惈婵℃寧绻涢崼鐔峰即ordPress闂備胶绮〃鍛存偋婵犲偊鑰垮ù鍏兼綑杩?, 'sut-wechat-mini' ), \n        get_bloginfo( 'version' )\n    );\n    \n    echo '<div class="notice notice-error"><p>' . esc_html( $notice ) . '</p></div>';\n}\n\n/**\n * 闂備礁鎼€氼剚鏅舵禒瀣︽慨妯挎硾缁犵敻鏌熼崫鍕ｆい鎰矙閺岋繝宕奸锟犲仐闂佸憡菧閸婃妲愰弮鍫晪闁逞屽墴閸┾偓妞ゆ帊鐒﹂惃鎴︽煟閹垮啯鎲磏 */\nfunction sut_wechat_mini_config_notice() {\n    if ( ! current_user_can( 'manage_options' ) ) {\n        return;\n    }\n    \n    $settings_url = admin_url( 'admin.php?page=sut-wechat-mini' );\n    $notice = sprintf( \n        esc_html__( 'SUT闁诲海鏁婚崑濠囧窗閺囩喓鈹嶅┑鐘插閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔夐悷婊勬緲閸燁垳绮嬮幒鏃€宕夐柛婵嗗濞堛儱鈹戦悩娈挎毌闁稿鎸荤换娑㈢叓椤撶姳瑕嗙紓浣介哺缁诲啴骞忛崨鏉戝耿婵°倕鍟姗€姊洪崫鍕⒈濞存粠浜畷銏ゅΧ閸モ晝锛炲銈嗘閵嗏偓闁稿鎹囧畷鎺戔攽閹邦剚顔夐梻浣告啞閹稿摜绮旂€靛憡顐?%s 闂佽娴烽幊鎾诲嫉椤掑嫬鍨傛慨妯垮煐閻撯偓閻庡箍鍎卞ú銊╁几閸岀偞鐓?, 'sut-wechat-mini' ),\n        '<a href="' . esc_url( $settings_url ) . '">' . esc_html__( '闂佽崵濮崇粈浣规櫠娴犲鍋柛鈩兦滄禍婊堟煟閵忕姵鍟炴俊?, 'sut-wechat-mini' ) . '</a>'\n    );\n    \n    echo '<div class="notice notice-warning"><p>' . wp_kses_post( $notice ) . '</p></div>';\n}\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇曞Л閺€浠嬫煃瑜滈崜娆戝弲婵犵數濮电喊宥囦焊濞嗘挻鍊?
 *\n * @param bool $network_wide 闂備礁鎼€氱兘宕规导鏉戠畾濞撴埃鍋撶€规洜鍏樻俊姝岊槾缂佸婀辩槐鎾存媴閸︻厾鐓勯柣搴＄仛閻楃姴鐣烽崼鏇炵骇闁瑰瓨绻冮弳銉モ攽閻樻鏆柛瀣尰缁?
 */\nfunction sut_wechat_mini_activate( $network_wide ) {\n    // 闂備礁鎲＄敮妤冩崲閸岀儑缍栭柟鐗堟緲缁€宀勬煛瀹擃喖鎳忓▓褔鏌?
    SUT_WeChat_Mini_Install::activate( $network_wide );\n}\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪€曠壕缁樼節婵犲倹鍣洪柡鍡楃箻濮婅櫣鎲撮敐鍡樼彅闂佺儵鍓濋埞妾?*/\nfunction sut_wechat_mini_deactivate() {\n    // 闂備礁婀遍悷鎶藉幢閳哄倹鏉搁梻浣侯焾椤戝棛鍒掓惔銊ユ瀬闁靛牆顦粻鑲┾偓骞垮劚鐎氼喚绮欐總鐞?   SUT_WeChat_Mini_Install::deactivate();\n}\n\n/**\n * 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪€曠涵鈧┑顔界箓閺堫剛绮婃导瀛樷拺閻熸瑱绲惧▍鍛存煟閳╁啠鏁妌 */\nfunction sut_wechat_mini_uninstall() {\n    // 闂備礁婀遍悷鎶藉幢閳哄倹鏉搁梻浣告啞椤ㄥ棝鎮洪弴鐏诲綊宕堕鈧粻鑲┾偓骞垮劚鐎氼喚绮欐總鐞?   SUT_WeChat_Mini_Install::uninstall();\n}\n\n// 婵犵數鍋涢ˇ顓㈠礉瀹€鍕埞闁芥ê顦弨浠嬫煃瑜滈崜娆戝弲濠殿喚鎳撳ú鐘诲磻閹惧瓨濯撮梻鈧幇顔荤瑝闂備焦妞垮鍧楀礉瀹€鍕濞村吋娼欑涵鈧┑顔界箓閺堫剛绮婃导瀛樷拺閻熸瑱绲惧▍鍛存煟閳╁啠鏁妌register_activation_hook( __FILE__, 'sut_wechat_mini_activate' );\nregister_deactivation_hook( __FILE__, 'sut_wechat_mini_deactivate' );\nregister_uninstall_hook( __FILE__, 'sut_wechat_mini_uninstall' );\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閹宕烽鐐扮钵缂備線顤傚▍瀹?*\n * @return SUT_WeChat_Mini_Loader|null 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇婃噰閸嬫捇宕烽鐐扮钵缂備線顤傚▍瀹?*/\nfunction sut_wechat_mini() {\n    static $instance = null;\n    \n    if ( is_null( $instance ) ) {\n        $instance = sut_wechat_mini_init();\n    }\n    \n    return $instance;\n}\n\n/**\n * 闁荤喐绮庢晶妤勩亹閻庢ΜdPress闂備礁鎲″缁樻叏閹灐褰掑炊閳规儳浜鹃柣鐔哄濠€浼存煕閵婏箑鍝虹€规洏鍎查幆鏃堝灳瀹曞洣娣┑鐘愁問閸犳牠顢栭崨顖楀亾閸偆鍙€妤犵偞鎹囬獮鎺戭吋閸♀晛浠篭n */\nadd_action( 'plugins_loaded', 'sut_wechat_mini' );\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閹鎷呯粙搴撴寖闂佹眹鍊曢幗鐜?*\n * @return array 闂備礁婀辩划顖滄暜婵犲倵鏋庨柕蹇嬪灪婵ジ鏌涢幘妤€鎳忛悗鐠 */\nfunction sut_wechat_mini_get_settings() {\n    $loader = sut_wechat_mini();\n    \n    if ( $loader instanceof SUT_WeChat_Mini_Loader ) {\n        return $loader->get_settings();\n    }\n    \n    return array();\n}\n\n/**\n * 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑閻熸粍婢橀崯顖滅矉閹烘鍤嬮柛顭戝€ｉ敃鍌涚厱婵ê澧介悾鐢告煕濡鈧妲愰弮鍫晩缂佹稑顑呮俊褏绱?
 *\n * @return bool 闂備礁鎼€氱兘宕规导鏉戠畾濞撴埃鍋撻柡灞斤工椤撳ジ宕堕埡鍌溾偓顓炩攽椤旂晫绠扮紒鎻掓健閸ㄦ儳顫楀?*/\nfunction sut_wechat_mini_is_configured() {\n    $loader = sut_wechat_mini();\n    \n    if ( $loader instanceof SUT_WeChat_Mini_Loader ) {\n        return $loader->is_configured();\n    }\n    \n    return false;\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閺岋絽螖閳ь剟鎮ф繝鍌﹁€垮ù鍏兼綑閻?
 *\n * @return string 闂備胶绮〃鍛存偋婵犲偊鑰垮ù鍏兼綑閻?
 */\nfunction sut_wechat_mini_get_version() {\n    return SUT_WECHAT_MINI_VERSION;\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閺岋綁鍩℃繝鍌涚亪缂傚倸绉寸粔鍫曞箲閸曨垼鏁嶆慨妯夸含閻涚敍n *\n * @return string 闂備胶鍎甸弲鈺呭窗閺嶎偆绀婄€广儱娲﹀畷澶嬨亜閺嶃劍鐨戠紒鎰偓鍒?*/\nfunction sut_wechat_mini_get_plugin_dir() {\n    return SUT_WECHAT_MINI_PLUGIN_DIR;\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰サRL\n *\n * @return string 闂備礁婀辩划顖滄暜婵犲倵鏋庢い銏㈢潕L\n */\nfunction sut_wechat_mini_get_plugin_url() {\n    return SUT_WECHAT_MINI_PLUGIN_URL;\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉㈡櫆鐏忓酣鏌涢弴銊ュ闁绘牠浜堕弻锟犲磼濮橆厾鐓戝┑鐐叉－閺佺冬L\n *\n * @param string $path 闂佽崵濮嶉崘顭戜痪缂備緡鐓堥崰姘跺箲閸曨垼鏁嶆慨妯夸含閻涚敍n * @return string 闂佽崵濮嶉崘顭戜痪缂備降鍔庨弨绋睱\n */\nfunction sut_wechat_mini_get_asset_url( $path ) {\n    $loader = sut_wechat_mini();\n    \n    if ( $loader instanceof SUT_WeChat_Mini_Loader ) {\n        return $loader->get_asset_url( $path );\n    }\n    \n    return SUT_WECHAT_MINI_PLUGIN_URL . 'assets/' . ltrim( $path, '/' );\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銏犳ГI闂備胶纭堕弲鐐测枍閿濆鈧線宕犻惈绋琝n *\n * @return string API闂備胶纭堕弲鐐测枍閿濆鈧線宕犻惈绋琝n */\nfunction sut_wechat_mini_get_api_base_url() {\n    $loader = sut_wechat_mini();\n    \n    if ( $loader instanceof SUT_WeChat_Mini_Loader ) {\n        return $loader->get_api_base_url();\n    }\n    \n    return home_url( 'sut-wechat-mini-api/' );\n}\n\n/**\n * 闂備礁鎼崯銊╁磿鏉堚晜宕查柡鍐ㄥ€规刊濂告煛婢跺孩纭剁紒澶婃健閺屾盯骞嬮敐鍛呮捇鏌￠崱娆忓⒌n *\n * @param mixed $message 闂備礁鎼崯銊╁磿鏉堚晜宕查柡鍌氱氨濡插牓鏌涢銈呮瀺缂佽鲸婀簄 * @param string $level 闂備礁鎼崯銊╁磿鏉堚晜宕查柡鍐ㄥ€诲Λ顖滄喐瀹ュ鏄ラ柛婵堟箯 */\nfunction sut_wechat_mini_log( $message, $level = 'info' ) {\n    $settings = sut_wechat_mini_get_settings();\n    \n    // 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑濠碘€冲级閹倸鐣烽妷鈺傛櫇闁逞屽墴楠炲棙鎯旈妸锕€浠洪梺闈涱煭闂勫嫰鏁嶆径鎰彄?
    if ( empty( $settings['enable_log'] ) ) {\n        return;\n    }\n    \n    // 濠电姷顣介埀顒€鍟块埀顒€缍婇幃妯诲緞閹邦剙寮峰銈嗙墬閸戝綊宕甸悩缁樺仯闁绘劏鏅涙晶鏌ユ煕閵婏絽濮傜€殿噮鍋婇獮宥夘敊閸撗呭帒闂備焦瀵х粙鎴︽儗娴ｈ褰掑幢濞戞顔夊銈庡亽閸欌偓缂佲偓婵犵攱ON\n    if ( is_object( $message ) || is_array( $message ) ) {\n        $message = json_encode( $message, JSON_UNESCAPED_UNICODE );\n    }\n    \n    // 闂備礁鎼鍛偓姘煎墰缁辨捇骞樼拠鑼潉闂侀潧顦崕宕囩不閸洘鐓曢柟閭﹀墯閸ｈ銇勯弮鈧埀顒傚崟    $log_content = date( 'Y-m-d H:i:s' ) . ' [' . strtoupper( $level ) . '] ' . $message . "\n";\n    \n    // 闂備礁鎲￠崝鏍偡閵夆晛鐭楅柛鈩冪☉缁秹鏌曟径鍫濆姢缂佺姴鐖奸弻锟犲磼濮橆厾鐓戝┑鐐叉－閺呮笜    $log_file = SUT_WECHAT_MINI_PLUGIN_DIR . 'logs/' . date( 'Y-m-d' ) . '.log';\n    \n    // 缂備胶铏庨崣搴ㄥ窗閺囩姵宕叉慨妯挎硾缁秹鏌曟径鍫濆姢缂佺姴鐖奸弻锝夊煛婵犲倹鐏堢紓鍌氱Т缁夊爼鍩€椤掍胶鈯曢柨姘節閳ь剟鎮?   $log_dir = dirname( $log_file );\n    \n    if ( ! is_dir( $log_dir ) ) {\n        wp_mkdir_p( $log_dir );\n    }\n    \n    // 闂備礁鎲￠崝鏍偡閵夆晛鐭楅柛鈩冪☉缁秹鏌曟径鍫濆姢缂佺姷巍n    file_put_contents( $log_file, $log_content, FILE_APPEND );\n}\n\n/**\n * 闂備礁鎼€氼剚鏅舵禒瀣︽繛鍡欐珒I闂佽崵濮村ú顓㈠绩闁秵鍎戝ù鐓庣摠閸庡秹鏌涢弴銊ョ仭闁哄應鏅犻幃褰掑炊鐠鸿櫣浠ф繛锝呮搐閿曨亪鐛?
 *\n * @param string $message 闂傚倷鐒︾€笛囨偡閵娾晩鏁嬮柕鍫濇噳濡插牓鏌涢銈呮瀺缂佽鲸婀簄 * @param int $code 闂傚倷鐒︾€笛囨偡閵娾晩鏁嬮柕鍫濇椤╃兘鏌ㄥ┑鍡樺窛闁搞劎鐗刵 */\nfunction sut_wechat_mini_api_error( $message, $code = 1 ) {\n    wp_send_json_error( array(\n        'code' => $code,\n        'message' => $message\n    ) );\n}\n\n/**\n * 闂備礁鎼€氼剚鏅舵禒瀣︽繛鍡欐珒I闂佽崵濮村ú顓㈠绩闁秵鍎戝ù鐓庣摠閸庡秹鏌涢弴銊ュ闁诲繐娲弻娑㈠籍閸屾碍鐎烘繛锝呮搐閿曨亪鐛?
 *\n * @param mixed $data 闂備礁鎲＄换鍌滅矓鐎垫瓕濮抽柡灞诲劚閺嬩線鏌ｅΔ鈧悧鍡欑矈椤╀糠 * @param string $message 闂備胶鎳撻悺銊╁礉閺囩喐鍙忔繛鎴炃氬Σ鍫ユ煕椤愩倕鏋嶇紒杈ㄦ购n */\nfunction sut_wechat_mini_api_success( $data = array(), $message = '闂備胶鎳撻悘婵堢矓瀹曞洨绀婇柡鍐ㄧ墕缁狅綁鏌熼柇锕€澧い? ) {\n    wp_send_json_success( array(\n        'code' => 0,\n        'message' => $message,\n        'data' => $data\n    ) );\n}\n\n/**\n * 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑Б闂佽桨闄嶉崐婵嬬嵁鐎ｎ喗鐓ラ悗锝庡€ｉ敃鍌涚厱婵ɑ鍎抽々顒佺箾閸涱偄鍔ラ柕鍥ㄥ姍瀵挳顢旈崱娆樻П闁诲海鏁婚崑濠囧窗閺囩喓鈹嶅┑鐘插閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔婇梺杞伴檷閸婃繈鐛€ｎ喖绀勯柕鍫濇川椤︾帟n *\n * @return bool 闂備礁鎼€氱兘宕规导鏉戠畾濞撴埃鍋撻柟顖氬€婚幏鐘绘嚑椤掑倐鐠 */\nfunction sut_wechat_mini_is_user_logged_in() {\n    $user_id = get_current_user_id();\n    \n    if ( $user_id <= 0 ) {\n        return false;\n    }\n    \n    // 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑Б闂佽桨闄嶉崐婵嬬嵁鐎ｎ喗鐓ラ悗锝庡€ｉ敃鍌涚厱婵﹢绠栧顔界節閳ь剚鎷呮潪鎵墾闂婎偄娲﹀ú宥夊蓟閵堝绠归柡澶嬪灩缁犳娊鏌℃担闈涒偓婵嬬嵁鐎ｎ剛鐭氶柡澶婂a闂備浇妗ㄩ懗鑸垫櫠濡も偓閻ｅ灚绋婂?   $wechat_openid = get_user_meta( $user_id, 'sut_wechat_mini_openid', true );\n    \n    return ! empty( $wechat_openid );\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉簵娴滃綊鏌熼幆褍鏆辨い銈呮嚇閺岋綀顦舵い鏇嗗懐绀婄€广儱顦伴崕宥夋煕閺囥劌浜炴慨锝呯墢缁辨帞鈧綆浜堕崕蹇曠磼椤垵寮柟顔荤矙婵℃悂鏁冮埀顒勬偂閺冪稘\n *\n * @return int 闂備焦妞垮鍧楀礉瀹ュ鏄ユ慨鍦嫃\n */\nfunction sut_wechat_mini_get_current_user_id() {\n    if ( sut_wechat_mini_is_user_logged_in() ) {\n        return get_current_user_id();\n    }\n    \n    return 0;\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉㈡櫃閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔婇梺杞伴檷閸婃繈鐛€ｎ喗鎲ラ柛灞剧懅缁犳岸姊?
 *\n * @param int $user_id 闂備焦妞垮鍧楀礉瀹ュ鏄ユ慨鍦嫃\n * @return array 闂備焦妞垮鍧楀礉瀹ュ鏄ユ繛鎴炵懅閳瑰秹鏌嶉埡浣告殨缂佽鲸婀簄 */\nfunction sut_wechat_mini_get_user_info( $user_id = 0 ) {\n    if ( empty( $user_id ) ) {\n        $user_id = sut_wechat_mini_get_current_user_id();\n    }\n    \n    if ( empty( $user_id ) ) {\n        return array();\n    }\n    \n    $user = get_user_by( 'id', $user_id );\n    \n    if ( ! $user ) {\n        return array();\n    }\n    \n    // 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墯閸嬨劑鏌曟繝蹇曠暠闁绘挻娲熼弻娑㈠煛閸愩劌濡哄┑鐘亾闁绘鐗忛埞宥夋煃閳轰礁鏆曠紒杈ㄦ购n    $user_info = array(\n        'id' => $user->ID,\n        'username' => $user->user_login,\n        'nickname' => $user->display_name,\n        'avatar' => get_avatar_url( $user->ID ),\n        'email' => $user->user_email,\n        'register_date' => $user->user_registered,\n    );\n    \n    // 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉㈡櫃閻掑﹪鐓崶銊︾５闁哄被鍊濋獮鏍级閹寸姷顔婃繝銏ｎ潐鐢偤鍩€椤掑喚娼愭慨妯稿妼閳绘捇骞嬮敂钘変缓闂侀潧顭粻鎴︽偂閺囩們搴ㄥ炊閿濆懎鈷夋繛瀵稿帶鐏忕灐    $wechat_info = array(\n        'openid' => get_user_meta( $user_id, 'sut_wechat_mini_openid', true ),\n        'unionid' => get_user_meta( $user_id, 'sut_wechat_mini_unionid', true ),\n        'nickname' => get_user_meta( $user_id, 'sut_wechat_mini_nickname', true ),\n        'avatar' => get_user_meta( $user_id, 'sut_wechat_mini_avatar', true ),\n        'gender' => get_user_meta( $user_id, 'sut_wechat_mini_gender', true ),\n        'country' => get_user_meta( $user_id, 'sut_wechat_mini_country', true ),\n        'province' => get_user_meta( $user_id, 'sut_wechat_mini_province', true ),\n        'city' => get_user_meta( $user_id, 'sut_wechat_mini_city', true ),\n        'language' => get_user_meta( $user_id, 'sut_wechat_mini_language', true ),\n    );\n    \n    // 闂備礁鎲￠懝楣冩偋閸℃稒鍤愰柣鏂挎憸閳瑰秹鏌嶉埡浣告殨缂佽鲸婀簄    $user_info['wechat_info'] = $wechat_info;\n    \n    return $user_info;\n}\n\n/**\n * 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑濠碘€冲级閹倸鐣烽妷鈺傛櫇闁逞屽墴楠炲棙鎯旈妸锕€浠洪梺闈涱焾閸婃宕繝鍥ㄧ厽闁靛繈鍊栧☉褔鏌￠崨顐㈢伈鐎规洘绻堥幃銏㈡嫚閹绘帒绠n *\n * @return bool 闂備礁鎼€氱兘宕规导鏉戠畾濞撴埃鍋撶€规洏鍎甸、娑橆煥閸曨剚顓筡n */\nfunction sut_wechat_mini_is_ecommerce_enabled() {\n    return class_exists( 'WooCommerce' );\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閺岋繝鍩€椤掑嫷鏁嶆繛鎴烆焽濡茬兘姊哄Ч鍥у閻庢凹鍓氶幈銊モ槈閵忊€虫畱闂佽姤锚椤︻垶鎮樺▎鎾村仩?
 *\n * @return array 闂備礁鎲″濠氬窗閺囥垹绀傛慨妞诲亾鐎规洘鑹捐灃闁告洍鏂侀崑鎾诲磽濞?*/\nfunction sut_wechat_mini_get_supported_features() {\n    $features = array(\n        'content' => true,       // 闂備礁鎲￠崝鏇㈠箠鎼搭煈鏁婇柟閭﹀枙濞岊亪鏌￠崶鈺佇炲ù鐘崇煇n        'users' => true,         // 闂備焦妞垮鍧楀礉瀹ュ鏄ユ繛鎴炴皑娑撳秹鏌ㄥ☉妯侯仾闁稿﹦鈧埖        'messages' => true,      // 婵犵數鍋為崹鐢告偋婵犲啫顕遍柛娑欐綑缁犳娊鏌曟繛鐐澒闁?
        'points' => true,        // 缂傚倷绀侀ˇ浠嬪垂娴兼潙鍨傞幖杈剧到鐎垫煡鏌ゆ慨鎰偓妤呭春閻曠        'cache' => true,         // 缂傚倸鍊搁崐褰掑箰閹间焦鍋ら柕濞у啫顕ч梺鐓庮潟閸婃宕洪悤绉?   );\n    \n    // 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑Б闂佽桨鐒﹂幃鍌氱暦椤栫偛骞㈡俊銈傚亾妞ゎ偆濞€閺?
    $features['ecommerce'] = sut_wechat_mini_is_ecommerce_enabled();\n    \n    // 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑闂佽桨绶￠崰妤冪矉閹烘嚦鐔煎传閸曞灚娴嗛梻?
    if ( $features['ecommerce'] ) {\n        $settings = sut_wechat_mini_get_settings();\n        $features['payment'] = ! empty( $settings['mch_id'] ) && ! empty( $settings['api_key'] );\n    } else {\n        $features['payment'] = false;\n    }\n    \n    return $features;\n}\n\n/**\n * 婵犵妲呴崑鈧柛瀣崌閺岋紕浠︾拠鎻掑婵犳鍠楅惄顖炲箠濡ゅ懏鍤嶉柕澹偓閿曞倹鐓曟慨妯哄⒔閻ｈ京鎲搁悧鍫㈠弨闁?
 *\n * @param string $feature 闂備礁鎲″濠氬窗閺囥垹绀傛慨妞诲亾鐎规洏鍎遍濂稿炊閸℃瑢鍋撻崚?* @return bool 闂備礁鎼€氱兘宕规导鏉戠畾濞撴埃鍋撶€规洩缍侀、娑橆煥閸曨剚顓筡n */\nfunction sut_wechat_mini_is_feature_available( $feature ) {\n    $features = sut_wechat_mini_get_supported_features();\n    \n    return isset( $features[ $feature ] ) && $features[ $feature ];\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閺岋綁濡搁妷銉紑婵犳鍠楅幃鍌炵嵁閳ь剙霉閿濆牊鑵圭紒璇叉閺?
 *\n * @return array 闂備胶绮…鍫ュ春閺嶎厼鐒垫い鎴炲椤﹀嘲菐閸パ嶈含妤?
 */\nfunction sut_wechat_mini_get_status() {\n    $status = array(\n        'version' => SUT_WECHAT_MINI_VERSION,\n        'configured' => sut_wechat_mini_is_configured(),\n        'php_version' => PHP_VERSION,\n        'wp_version' => get_bloginfo( 'version' ),\n        'features' => sut_wechat_mini_get_supported_features(),\n        'multisite' => is_multisite(),\n        'ssl' => is_ssl(),\n    );\n    \n    return $status;\n}\n\n/**\n * 闂備礁鍚嬮崕鎶藉床閼艰翰浜归柛銉墮缁犵敻鏌熼崫鍕ｆい鎰矙閺岋綁濡搁妷銉紓闂佹眹鍔庨崰鎾诲箯閻樿鍗虫慨姗嗗亞缁犳岸姊?
 *\n * @return array 闂佽崵濮撮鍛村疮閹惰姤鍎婃い鏍ㄧ〒閳瑰秹鏌嶉埡浣告殨缂佽鲸婀簄 */\nfunction sut_wechat_mini_get_debug_info() {\n    $debug_info = array(\n        'status' => sut_wechat_mini_get_status(),\n        'settings' => sut_wechat_mini_get_settings(),\n        'constants' => array(\n            'SUT_WECHAT_MINI_VERSION' => SUT_WECHAT_MINI_VERSION,\n            'SUT_WECHAT_MINI_PLUGIN_DIR' => SUT_WECHAT_MINI_PLUGIN_DIR,\n            'SUT_WECHAT_MINI_PLUGIN_URL' => SUT_WECHAT_MINI_PLUGIN_URL,\n            'SUT_WECHAT_MINI_PLUGIN_FILE' => SUT_WECHAT_MINI_PLUGIN_FILE,\n            'SUT_WECHAT_MINI_PLUGIN_BASENAME' => SUT_WECHAT_MINI_PLUGIN_BASENAME,\n            'ABSPATH' => ABSPATH,\n        ),\n        'server' => array(\n            'PHP_OS' => PHP_OS,\n            'SERVER_SOFTWARE' => isset( $_SERVER['SERVER_SOFTWARE'] ) ? $_SERVER['SERVER_SOFTWARE'] : '',\n            'PHP_MAX_INPUT_VARS' => ini_get( 'max_input_vars' ),\n            'PHP_MAX_EXECUTION_TIME' => ini_get( 'max_execution_time' ),\n            'PHP_MEMORY_LIMIT' => ini_get( 'memory_limit' ),\n        ),\n        'active_plugins' => get_option( 'active_plugins', array() ),\n        'theme' => wp_get_theme()->get( 'Name' ) . ' ' . wp_get_theme()->get( 'Version' ),\n    );\n    \n    return $debug_info;\n}\n