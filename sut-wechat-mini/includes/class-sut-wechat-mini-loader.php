锘??php\n/**\n * SUT瀵邦喕淇婄亸蹇曗柤鎼村繐濮炴潪钘夋珤缁?
 *\n * 鐠愮喕鐭楅崝鐘烘祰閸滃苯鍨垫慨瀣閹绘帊娆㈤惃鍕倗娑擃亜濮涢懗鑺ツ侀崸?
 *\n * @package SUT_WeChat_Mini\n */\n\nif ( ! defined( 'ABSPATH' ) ) {\n    exit;\n}\n\n/**\n * SUT_WeChat_Mini_Loader 缁?
 */\nclass SUT_WeChat_Mini_Loader {\n    \n    /**\n     * 閸楁洑绶ョ€圭偘绶n     *\n     * @var SUT_WeChat_Mini_Loader\n     */\n    private static $instance = null;\n    \n    /**\n     * 瀹稿弶鏁為崘宀€娈戦柦鈺佺摍閸掓銆僜n     *\n     * @var array\n     */\n    protected $hooks = array();\n    \n    /**\n     * 閺嬪嫰鈧姴鍤遍弫?
     */\n    private function __construct() {\n        // 濞夈劌鍞介懛顏勫З閸旂姾娴嘰n        $this->register_autoloader();\n        \n        // 閸掓繂顫愰崠鏍ㄥ絻娴?
        $this->init();\n    }\n    \n    /**\n     * 閼惧嘲褰囬崡鏇氱伐鐎圭偘绶n     *\n     * @return SUT_WeChat_Mini_Loader\n     */\n    public static function get_instance() {\n        if ( is_null( self::$instance ) ) {\n            self::$instance = new self();\n        }\n        \n        return self::$instance;\n    }\n    \n    /**\n     * 濞夈劌鍞介懛顏勫З閸旂姾娴嘰n     */\n    private function register_autoloader() {\n        spl_autoload_register( array( $this, 'autoload' ) );\n    }\n    \n    /**\n     * 閼奉亜濮╅崝鐘烘祰缁粯鏋冩禒?
     *\n     * @param string $class 缁鎮昞n     */\n    public function autoload( $class ) {\n        // 閸欘亜顦╅悶鍝燯T_WeChat_Mini瀵偓婢跺娈戠猾?
        if ( 0 !== strpos( $class, 'SUT_WeChat_Mini_' ) ) {\n            return;\n        }\n        \n        // 鏉烆剚宕茬猾璇叉倳娑撶儤鏋冩禒鎯扮熅瀵?
        $class_path = str_replace( 'SUT_WeChat_Mini_', '', $class );\n        $class_path = strtolower( str_replace( '_', '-', $class_path ) );\n        \n        // 閺嬪嫬缂撻弬鍥︽鐠侯垰绶瀄n        $parts = explode( '-', $class_path );\n        $module = '';\n        $file_name = '';\n        \n        if ( count( $parts ) > 1 ) {\n            $module = $parts[0];\n            $file_name = 'class-sut-wechat-mini-' . $class_path . '.php';\n        } else {\n            $file_name = 'class-sut-wechat-mini-' . $class_path . '.php';\n        }\n        \n        // 绾喖鐣鹃弬鍥︽娴ｅ秶鐤哱n        $file_path = '';\n        \n        if ( ! empty( $module ) ) {\n            // 濡偓閺屻儲膩閸ф娲拌ぐ?
            $module_dir = SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/' . $module . '/';\n            \n            if ( file_exists( $module_dir . $file_name ) ) {\n                $file_path = $module_dir . $file_name;\n            }\n        }\n        \n        // 濡偓閺屻儲鐗撮惄顔肩秿\n        if ( empty( $file_path ) ) {\n            $root_dir = SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/';\n            \n            if ( file_exists( $root_dir . $file_name ) ) {\n                $file_path = $root_dir . $file_name;\n            }\n        }\n        \n        // 閸旂姾娴囬弬鍥︽\n        if ( ! empty( $file_path ) && file_exists( $file_path ) ) {\n            require_once $file_path;\n        }\n    }\n    \n    /**\n     * 閸掓繂顫愰崠鏍ㄥ絻娴?
     */\n    private function init() {\n        // 閸旂姾娴囬弬鍥ㄦ拱閸?
        $this->load_textdomain();\n        \n        // 濞夈劌鍞介柦鈺佺摍\n        $this->register_hooks();\n        \n        // 閸旂姾娴嘇PI濡€虫健\n        $this->load_api();\n        \n        // 閸旂姾娴囬悽銊﹀煕濡€虫健\n        $this->load_users();\n        \n        // 閸旂姾娴囬崘鍛啇濡€虫健\n        $this->load_content();\n        \n        // 閸旂姾娴嘩ooCommerce濡€虫健閿涘牆顩ч弸婊冪暔鐟佸懍绨ooCommerce閿?
        $this->load_woocommerce();\n        \n        // 閸旂姾娴囬弨顖欑帛濡€虫健\n        $this->load_payments();\n        \n        // 閸旂姾娴囧☉鍫熶紖濡€虫健\n        $this->load_messages();\n        \n        // 閸旂姾娴囩粔顖氬瀻濡€虫健\n        $this->load_points();\n        \n        // 閸旂姾娴囩紓鎾崇摠濡€虫健\n        $this->load_cache();\n        \n        // 閸旂姾娴囩粻锛勬倞濡€虫健\n        $this->load_admin();\n    }\n    \n    /**\n     * 閸旂姾娴囬弬鍥ㄦ拱閸?
     *\n     * @return void\n     */\n    private function load_textdomain() {\n        // 娑撹桨绨＄憴锝呭枀閹绘帊娆㈠┑鈧ú濠氭６妫版﹫绱濋弳鍌涙缁備胶鏁ょ紙鏄忕槯閸旂姾娴囬崝鐔诲厴閵?
        // load_plugin_textdomain( 'sut-wechat-mini', false, basename( SUT_WECHAT_MINI_PLUGIN_DIR ) . '/languages' );\n    }\n    \n    /**\n     * 濞夈劌鍞介柦鈺佺摍\n     */\n    private function register_hooks() {\n        // 濠碘偓濞插鎸€?
        register_activation_hook( SUT_WECHAT_MINI_PLUGIN_FILE, array( 'SUT_WeChat_Mini_Install', 'activate' ) );\n        \n        // 閸嬫粎鏁ら柦鈺佺摍\n        register_deactivation_hook( SUT_WECHAT_MINI_PLUGIN_FILE, array( 'SUT_WeChat_Mini_Install', 'deactivate' ) );\n        \n        // 閸楁瓕娴囬柦鈺佺摍\n        register_uninstall_hook( SUT_WECHAT_MINI_PLUGIN_FILE, array( 'SUT_WeChat_Mini_Install', 'uninstall' ) );\n        \n        // WordPress閸掓繂顫愰崠鏍尙鐎?
        add_action( 'init', array( $this, 'on_init' ) );\n        \n        // 閹绘帊娆㈤崝鐘烘祰鐎瑰本鍨氶柦鈺佺摍\n        add_action( 'plugins_loaded', array( $this, 'on_plugins_loaded' ) );\n        \n        // 濡剝婢橀柌宥呯暰閸氭垿鎸€?
        add_action( 'template_redirect', array( $this, 'on_template_redirect' ) );\n    }\n    \n    /**\n     * 閸旂姾娴嘇PI濡€虫健\n     */\n    private function load_api() {\n        // 鐎电厧鍙咥PI缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_API' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/api/class-sut-wechat-mini-api.php';\n        }\n        \n        // 閸掓繂顫愰崠鏈匬I\n        $api = SUT_WeChat_Mini_API::get_instance();\n        // 濞夈劍鍓伴敍姝﹏it()閺傝纭堕崷銊︾€柅鐘插毐閺侀鑵戝鑼跺殰閸斻劏鐨熼悽顭掔礉閺冪娀娓堕崘宥嗩偧鐠嬪啰鏁n    }\n    \n    /**\n     * 閸旂姾娴囬悽銊﹀煕濡€虫健\n     */\n    private function load_users() {\n        // 鐎电厧鍙嗛悽銊﹀煕缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_Users' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/users/class-sut-wechat-mini-users.php';\n        }\n        \n        // 閸掓繂顫愰崠鏍暏閹撮攱膩閸?
        $users = SUT_WeChat_Mini_Users::get_instance();\n        // 濞夈劍鍓伴敍姝﹏it()閺傝纭堕崷銊︾€柅鐘插毐閺侀鑵戝鑼跺殰閸斻劏鐨熼悽顭掔礉閺冪娀娓堕崘宥嗩偧鐠嬪啰鏁n    }\n    \n    /**\n     * 閸旂姾娴囬崘鍛啇濡€虫健\n     */\n    private function load_content() {\n        // 鐎电厧鍙嗛崘鍛啇缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_Content' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/content/class-sut-wechat-mini-content.php';\n        }\n        \n        // 閸掓繂顫愰崠鏍у敶鐎硅膩閸?
        $content = SUT_WeChat_Mini_Content::get_instance();\n        // 濞夈劍鍓伴敍姝﹏it()閺傝纭堕崷銊︾€柅鐘插毐閺侀鑵戝鑼跺殰閸斻劏鐨熼悽顭掔礉閺冪娀娓堕崘宥嗩偧鐠嬪啰鏁n    }\n    \n    /**\n     * 閸旂姾娴嘩ooCommerce濡€虫健\n     */\n    private function load_woocommerce() {\n        // 濡偓閺岊櫇ooCommerce閺勵垰鎯佸┑鈧ú?
        if ( class_exists( 'WooCommerce' ) ) {\n            // 鐎电厧鍙哤ooCommerce缁?
            if ( ! class_exists( 'SUT_WeChat_Mini_WooCommerce' ) ) {\n                require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/woocommerce/class-sut-wechat-mini-woocommerce.php';\n            }\n            \n            // 閸掓繂顫愰崠鏈﹐oCommerce濡€虫健 - get_instance()娴兼俺鐨熼悽銊︾€柅鐘插毐閺佸府绱濋懓灞剧€柅鐘插毐閺侀鑵戝鑼病鐠嬪啰鏁ゆ禍鍞卬it()\n            SUT_WeChat_Mini_WooCommerce::get_instance();\n        }\n    }\n    \n    /**\n     * 閸旂姾娴囬弨顖欑帛濡€虫健\n     */\n    private function load_payments() {\n        // 鐎电厧鍙嗛弨顖欑帛缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_Pay' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/payments/class-sut-wechat-mini-pay.php';\n        }\n        \n        // 閸掓繂顫愰崠鏍ㄦ暜娴犳ɑ膩閸?
        $pay = SUT_WeChat_Mini_Pay::get_instance();\n        // 濞夈劍鍓伴敍姝﹏it()閺傝纭堕崷銊︾€柅鐘插毐閺侀鑵戝鑼跺殰閸斻劏鐨熼悽顭掔礉閺冪娀娓堕崘宥嗩偧鐠嬪啰鏁n    }\n    \n    /**\n     * 閸旂姾娴囧☉鍫熶紖濡€虫健\n     */\n    private function load_messages() {\n        // 鐎电厧鍙嗗☉鍫熶紖缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_Messages' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/messages/class-sut-wechat-mini-messages.php';\n        }\n        \n        // 閸掓繂顫愰崠鏍ㄧХ閹垱膩閸?
        $messages = SUT_WeChat_Mini_Messages::get_instance();\n        // 濞戝牊浼呭Ο鈥虫健娑撳秹娓剁憰浣稿礋閻欘剛娈慽nit閺傝纭堕敍灞剧€柅鐘插毐閺佹澘鍑＄紒蹇擃槱閻炲棔绨￠崚婵嗩潗閸?
    }\n    \n    /**\n     * 閸旂姾娴囩粔顖氬瀻濡€虫健\n     */\n    private function load_points() {\n        // 鐎电厧鍙嗙粔顖氬瀻缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_Points' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/points/class-sut-wechat-mini-points.php';\n        }\n        \n        // 閸掓繂顫愰崠鏍濋崚鍡樐侀崸?
        $points = SUT_WeChat_Mini_Points::get_instance();\n        // 缁夘垰鍨庡Ο鈥虫健娑撳秹娓剁憰浣稿礋閻欘剛娈慽nit閺傝纭堕敍灞剧€柅鐘插毐閺佹澘鍑＄紒蹇擃槱閻炲棔绨￠崚婵嗩潗閸?
    }\n    \n    /**\n     * 閸旂姾娴囩紓鎾崇摠濡€虫健\n     */\n    private function load_cache() {\n        // 鐎电厧鍙嗙紓鎾崇摠缁?
        if ( ! class_exists( 'SUT_WeChat_Mini_Cache' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/cache/class-sut-wechat-mini-cache.php';\n        }\n        \n        // 閸掓繂顫愰崠鏍处鐎涙ɑ膩閸?
        $cache = SUT_WeChat_Mini_Cache::get_instance();\n        // 缂傛挸鐡ㄥΟ鈥虫健娑撳秹娓剁憰浣稿礋閻欘剛娈慽nit閺傝纭堕敍灞剧€柅鐘插毐閺佹澘鍑＄紒蹇擃槱閻炲棔绨￠崚婵嗩潗閸?
    }\n    \n    /**\n     * 閸旂姾娴囩粻锛勬倞濡€虫健\n     */\n    private function load_admin() {\n        // 閸欘亜婀崥搴″酱閸旂姾娴囩粻锛勬倞濡€虫健\n        if ( is_admin() ) {\n            // 鐎电厧鍙嗙粻锛勬倞缁?
            if ( ! class_exists( 'SUT_WeChat_Mini_Admin' ) ) {\n                require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/admin/class-sut-wechat-mini-admin.php';\n            }\n            \n            // 閸掓繂顫愰崠鏍吀閻炲棙膩閸?
            $admin = SUT_WeChat_Mini_Admin::get_instance();\n            // 濞夈劍鍓伴敍姝﹏it()閺傝纭堕崷銊︾€柅鐘插毐閺侀鑵戝鑼跺殰閸斻劏鐨熼悽顭掔礉閺冪娀娓堕崘宥嗩偧鐠嬪啰鏁n        }\n    }\n    \n    /**\n     * 婢跺嫮鎮奧ordPress閸掓繂顫愰崠鏍︾皑娴?
     */\n    public function on_init() {\n        // 濞夈劌鍞介柌宥呭晸鐟欏嫬鍨痋n        $this->register_rewrite_rules();\n        \n        // 濞夈劌鍞介懛顏勭暰娑斿鐓＄拠銏犲綁闁?
        $this->register_query_vars();\n        \n        // 濞夈劌鍞介懛顏勭暰娑斿鏋冪粩鐘佃閸ㄥ鎷伴崚鍡欒濞?
        $this->register_post_types_and_taxonomies();\n    }\n    \n    /**\n     * 婢跺嫮鎮婇幓鎺嶆閸旂姾娴囩€瑰本鍨氭禍瀣╂\n     */\n    public function on_plugins_loaded() {\n        // 鐟欙箑褰傞幓鎺嶆閸旂姾娴囩€瑰本鍨氶柦鈺佺摍\n        do_action( 'sut_wechat_mini_loaded' );\n    }\n    \n    /**\n     * 婢跺嫮鎮婂Ο鈩冩緲闁插秴鐣鹃崥鎴滅皑娴?
     */\n    public function on_template_redirect() {\n        // 濡偓閺屻儲妲搁崥锔芥ЦAPI鐠囬攱鐪癨n        if ( $this->is_api_request() ) {\n            // 娑撳秵澧界悰灞灸侀弶鍧楀櫢鐎规艾鎮淺n            return;\n        }\n    }\n    \n    /**\n     * 濞夈劌鍞介柌宥呭晸鐟欏嫬鍨痋n     */\n    private function register_rewrite_rules() {\n        // API闁插秴鍟撶憴鍕灟閻㈢泧PI濡€虫健婢跺嫮鎮奬n    }\n    \n    /**\n     * 濞夈劌鍞介懛顏勭暰娑斿鐓＄拠銏犲綁闁?
     */\n    private function register_query_vars() {\n        global $wp;\n        \n        $wp->add_query_var( 'sut_wechat_mini_api' );\n        $wp->add_query_var( 'sut_wechat_mini_action' );\n        $wp->add_query_var( 'sut_wechat_mini_token' );\n    }\n    \n    /**\n     * 濞夈劌鍞介懛顏勭暰娑斿鏋冪粩鐘佃閸ㄥ鎷伴崚鍡欒濞?
     */\n    private function register_post_types_and_taxonomies() {\n        // 濞夈劌鍞界亸蹇曗柤鎼村繘銆夐棃銏℃瀮缁旂姷琚崹?
        register_post_type( 'sut_wechat_mini_page', array(\n            'labels' => array(\n                'name' => __( '鐏忓繒鈻兼惔蹇涖€夐棃?, 'sut-wechat-mini' ),\n                'singular_name' => __( '鐏忓繒鈻兼惔蹇涖€夐棃?, 'sut-wechat-mini' ),\n                'add_new' => __( '濞ｈ濮為弬浼淬€夐棃?, 'sut-wechat-mini' ),\n                'add_new_item' => __( '濞ｈ濮為弬鏉跨毈缁嬪绨い鐢告桨', 'sut-wechat-mini' ),\n                'edit_item' => __( '缂傛牞绶亸蹇曗柤鎼村繘銆夐棃?, 'sut-wechat-mini' ),\n                'new_item' => __( '閺傛澘鐨粙瀣碍妞ょ敻娼?, 'sut-wechat-mini' ),\n                'view_item' => __( '閺屻儳婀呯亸蹇曗柤鎼村繘銆夐棃?, 'sut-wechat-mini' ),\n                'search_items' => __( '閹兼粎鍌ㄧ亸蹇曗柤鎼村繘銆夐棃?, 'sut-wechat-mini' ),\n                'not_found' => __( '閺堫亝澹橀崚鏉跨毈缁嬪绨い鐢告桨', 'sut-wechat-mini' ),\n                'not_found_in_trash' => __( '閸ョ偞鏁圭粩娆庤厬閺堫亝澹橀崚鏉跨毈缁嬪绨い鐢告桨', 'sut-wechat-mini' ),\n                'parent_item_colon' => __( '閻栧墎楠囨い鐢告桨:', 'sut-wechat-mini' ),\n                'menu_name' => __( '鐏忓繒鈻兼惔蹇涖€夐棃?, 'sut-wechat-mini' ),\n            ),\n            'public' => true,\n            'publicly_queryable' => true,\n            'show_ui' => true,\n            'show_in_menu' => 'sut-wechat-mini',\n            'query_var' => true,\n            'rewrite' => array( 'slug' => 'sut-wechat-mini-page' ),\n            'capability_type' => 'post',\n            'has_archive' => false,\n            'hierarchical' => false,\n            'menu_position' => null,\n            'supports' => array( 'title', 'editor', 'thumbnail', 'excerpt', 'custom-fields' )\n        ) );\n        \n        // 濞夈劌鍞界亸蹇曗柤鎼村繑膩閺夊灝鍨庣猾缁樼《\n        register_taxonomy( 'sut_wechat_mini_template', 'sut_wechat_mini_page', array(\n            'labels' => array(\n                'name' => __( '妞ょ敻娼板Ο鈩冩緲', 'sut-wechat-mini' ),\n                'singular_name' => __( '妞ょ敻娼板Ο鈩冩緲', 'sut-wechat-mini' ),\n                'search_items' => __( '閹兼粎鍌ㄦい鐢告桨濡剝婢?, 'sut-wechat-mini' ),\n                'all_items' => __( '閹碘偓閺堝銆夐棃銏∧侀弶?, 'sut-wechat-mini' ),\n                'parent_item' => __( '閻栧墎楠囧Ο鈩冩緲', 'sut-wechat-mini' ),\n                'parent_item_colon' => __( '閻栧墎楠囧Ο鈩冩緲:', 'sut-wechat-mini' ),\n                'edit_item' => __( '缂傛牞绶い鐢告桨濡剝婢?, 'sut-wechat-mini' ),\n                'update_item' => __( '閺囧瓨鏌婃い鐢告桨濡剝婢?, 'sut-wechat-mini' ),\n                'add_new_item' => __( '濞ｈ濮為弬浼淬€夐棃銏∧侀弶?, 'sut-wechat-mini' ),\n                'new_item_name' => __( '閺備即銆夐棃銏∧侀弶鍨倳缁?, 'sut-wechat-mini' ),\n                'menu_name' => __( '妞ょ敻娼板Ο鈩冩緲', 'sut-wechat-mini' ),\n            ),\n            'hierarchical' => true,\n            'public' => true,\n            'show_ui' => true,\n            'show_admin_column' => true,\n            'show_in_nav_menus' => true,\n            'show_tagcloud' => false,\n            'rewrite' => array( 'slug' => 'sut-wechat-mini-template' ),\n        ) );\n    }\n    \n    /**\n     * 濡偓閺屻儲妲搁崥锔芥ЦAPI鐠囬攱鐪癨n     *\n     * @return bool 閺勵垰鎯侀弰鐤塒I鐠囬攱鐪癨n     */\n    private function is_api_request() {\n        global $wp;\n        \n        $api_var = get_query_var( 'sut_wechat_mini_api', '' );\n        \n        return ! empty( $api_var );\n    }\n    \n    /**\n     * 濞夈劌鍞芥稉鈧稉顏勫З娴ｆ粓鎸€?
     *\n     * @param string $tag 闁解晛鐡欓弽鍥╊劮\n     * @param callable $function_to_add 鐟曚焦鍧婇崝鐘垫畱閸戣姤鏆焅n     * @param int $priority 娴兼ê鍘涚痪?
     * @param int $accepted_args 閹恒儱褰堥惃鍕棘閺佺増鏆熼柌?
     * @return bool 閹垮秳缍旂紒鎾寸亯\n     */\n    public function add_action( $tag, $function_to_add, $priority = 10, $accepted_args = 1 ) {\n        $this->hooks[] = array(\n            'type' => 'action',\n            'tag' => $tag,\n            'function_to_add' => $function_to_add,\n            'priority' => $priority,\n            'accepted_args' => $accepted_args\n        );\n        \n        return add_action( $tag, $function_to_add, $priority, $accepted_args );\n    }\n    \n    /**\n     * 濞夈劌鍞芥稉鈧稉顏囩箖濠娿倕娅掗柦鈺佺摍\n     *\n     * @param string $tag 闁解晛鐡欓弽鍥╊劮\n     * @param callable $function_to_add 鐟曚焦鍧婇崝鐘垫畱閸戣姤鏆焅n     * @param int $priority 娴兼ê鍘涚痪?
     * @param int $accepted_args 閹恒儱褰堥惃鍕棘閺佺増鏆熼柌?
     * @return bool 閹垮秳缍旂紒鎾寸亯\n     */\n    public function add_filter( $tag, $function_to_add, $priority = 10, $accepted_args = 1 ) {\n        $this->hooks[] = array(\n            'type' => 'filter',\n            'tag' => $tag,\n            'function_to_add' => $function_to_add,\n            'priority' => $priority,\n            'accepted_args' => $accepted_args\n        );\n        \n        return add_filter( $tag, $function_to_add, $priority, $accepted_args );\n    }\n    \n    /**\n     * 閼惧嘲褰囧鍙夋暈閸愬瞼娈戦柦鈺佺摍\n     *\n     * @return array 闁解晛鐡欓崚妤勩€僜n     */\n    public function get_hooks() {\n        return $this->hooks;\n    }\n    \n    /**\n     * 閼惧嘲褰囬幓鎺嶆鐠佸墽鐤哱n     *\n     * @return array 閹绘帊娆㈢拋鍓х枂\n     */\n    public function get_settings() {\n        $settings = get_option( 'sut_wechat_mini_settings', array() );\n        \n        // 閸氬牆鑻熸妯款吇鐠佸墽鐤哱n        $default_settings = $this->get_default_settings();\n        $settings = array_merge( $default_settings, $settings );\n        \n        return $settings;\n    }\n    \n    /**\n     * 閼惧嘲褰囨妯款吇鐠佸墽鐤哱n     *\n     * @return array 姒涙顓荤拋鍓х枂\n     */\n    private function get_default_settings() {\n        return array(\n            'app_id' => '',\n            'app_secret' => '',\n            'mch_id' => '',\n            'api_key' => '',\n            'notify_url' => '',\n            'cache_ttl' => 3600,\n            'enable_log' => 0,\n            'enable_template_message' => 1,\n            'template_message_order_paid' => '',\n            'template_message_order_shipped' => '',\n            'template_message_refund_success' => '',\n        );\n    }\n    \n    /**\n     * 濡偓閺屻儲褰冩禒鑸垫Ц閸氾箓鍘ょ純顔筋劀绾?
     *\n     * @return bool 閺勵垰鎯侀柊宥囩枂濮濓絿鈥榎n     */\n    public function is_configured() {\n        $settings = $this->get_settings();\n        \n        // 濡偓閺屻儱绻€鐟曚胶娈戦柊宥囩枂妞?
        if ( empty( $settings['app_id'] ) || empty( $settings['app_secret'] ) ) {\n            return false;\n        }\n        \n        // 婵″倹鐏夐崥顖滄暏娴滃棙鏁禒妯哄閼虫枻绱濆Λ鈧弻銉︽暜娴犳﹢鍘ょ純?
        if ( class_exists( 'WooCommerce' ) && empty( $settings['mch_id'] ) && empty( $settings['api_key'] ) ) {\n            // 閺€顖欑帛闁板秶鐤嗘稉宥呯暚閺佽揪绱濇担鍡曠瑝閺勵垵鍤ч崨浠嬫晩鐠?
        }\n        \n        return true;\n    }\n    \n    /**\n     * 閼惧嘲褰囬幓鎺嶆閻楀牊婀伴崣?
     *\n     * @return string 閻楀牊婀伴崣?
     */\n    public function get_version() {\n        return SUT_WECHAT_MINI_VERSION;\n    }\n    \n    /**\n     * 閼惧嘲褰囬幓鎺嶆閻╊喖缍嶇捄顖氱窞\n     *\n     * @return string 閻╊喖缍嶇捄顖氱窞\n     */\n    public function get_plugin_dir() {\n        return SUT_WECHAT_MINI_PLUGIN_DIR;\n    }\n    \n    /**\n     * 閼惧嘲褰囬幓鎺嶆URL\n     *\n     * @return string 閹绘帊娆RL\n     */\n    public function get_plugin_url() {\n        return SUT_WECHAT_MINI_PLUGIN_URL;\n    }\n    \n    /**\n     * 閼惧嘲褰囬幓鎺嶆閺傚洣娆㈢捄顖氱窞\n     *\n     * @return string 閺傚洣娆㈢捄顖氱窞\n     */\n    public function get_plugin_file() {\n        return SUT_WECHAT_MINI_PLUGIN_FILE;\n    }\n    \n    /**\n     * 閼惧嘲褰囬幓鎺嶆閸╃儤婀癠RL\n     *\n     * @return string 閸╃儤婀癠RL\n     */\n    public function get_base_url() {\n        return home_url();\n    }\n    \n    /**\n     * 閼惧嘲褰嘇PI閸╄櫣顢匲RL\n     *\n     * @return string API閸╄櫣顢匲RL\n     */\n    public function get_api_base_url() {\n        return home_url( 'sut-wechat-mini-api/' );\n    }\n    \n    /**\n     * 閼惧嘲褰囩挧鍕爱閺傚洣娆RL\n     *\n     * @param string $path 鐠у嫭绨捄顖氱窞\n     * @return string 鐠у嫭绨甎RL\n     */\n    public function get_asset_url( $path ) {\n        return $this->get_plugin_url() . 'assets/' . ltrim( $path, '/' );\n    }\n    \n    /**\n     * 閼惧嘲褰囧Ο鈩冩緲閺傚洣娆㈢捄顖氱窞\n     *\n     * @param string $template_name 濡剝婢橀崥宥囆瀄n     * @return string 濡剝婢橀弬鍥︽鐠侯垰绶瀄n     */\n    public function get_template_path( $template_name ) {\n        $template_path = $this->get_plugin_dir() . 'templates/' . $template_name;\n        \n        // 濡偓閺屻儰瀵屾０妯绘Ц閸氾附婀佺憰鍡欐磰濡剝婢榎n        $theme_template_path = get_stylesheet_directory() . '/sut-wechat-mini/' . $template_name;\n        \n        if ( file_exists( $theme_template_path ) ) {\n            $template_path = $theme_template_path;\n        }\n        \n        return $template_path;\n    }\n    \n    /**\n     * 閸旂姾娴囧Ο鈩冩緲閺傚洣娆n     *\n     * @param string $template_name 濡剝婢橀崥宥囆瀄n     * @param array $args 閸欏倹鏆熼弫鎵矋\n     * @return bool 閺勵垰鎯侀崝鐘烘祰閹存劕濮沑n     */\n    public function load_template( $template_name, $args = array() ) {\n        $template_path = $this->get_template_path( $template_name );\n        \n        if ( ! file_exists( $template_path ) ) {\n            return false;\n        }\n        \n        // 閹绘劕褰囬崣鍌涙殶閸欐﹢鍣篭n        if ( ! empty( $args ) && is_array( $args ) ) {\n            extract( $args );\n        }\n        \n        // 閸旂姾娴囧Ο鈩冩緲\n        include $template_path;\n        \n        return true;\n    }\n}\n