<?php\n/**\n * SUT寰俊灏忕▼搴忓姞杞藉櫒绫?
 *\n * 璐熻矗鍔犺浇鍜屽垵濮嬪寲鎻掍欢鐨勫悇涓姛鑳芥ā鍧?
 *\n * @package SUT_WeChat_Mini\n */\n\nif ( ! defined( 'ABSPATH' ) ) {\n    exit;\n}\n\n/**\n * SUT_WeChat_Mini_Loader 绫?
 */\nclass SUT_WeChat_Mini_Loader {\n    \n    /**\n     * 鍗曚緥瀹炰緥\n     *\n     * @var SUT_WeChat_Mini_Loader\n     */\n    private static $instance = null;\n    \n    /**\n     * 宸叉敞鍐岀殑閽╁瓙鍒楄〃\n     *\n     * @var array\n     */\n    protected $hooks = array();\n    \n    /**\n     * 鏋勯€犲嚱鏁?
     */\n    private function __construct() {\n        // 娉ㄥ唽鑷姩鍔犺浇\n        $this->register_autoloader();\n        \n        // 鍒濆鍖栨彃浠?
        $this->init();\n    }\n    \n    /**\n     * 鑾峰彇鍗曚緥瀹炰緥\n     *\n     * @return SUT_WeChat_Mini_Loader\n     */\n    public static function get_instance() {\n        if ( is_null( self::$instance ) ) {\n            self::$instance = new self();\n        }\n        \n        return self::$instance;\n    }\n    \n    /**\n     * 娉ㄥ唽鑷姩鍔犺浇\n     */\n    private function register_autoloader() {\n        spl_autoload_register( array( $this, 'autoload' ) );\n    }\n    \n    /**\n     * 鑷姩鍔犺浇绫绘枃浠?
     *\n     * @param string $class 绫诲悕\n     */\n    public function autoload( $class ) {\n        // 鍙鐞哠UT_WeChat_Mini寮€澶寸殑绫?
        if ( 0 !== strpos( $class, 'SUT_WeChat_Mini_' ) ) {\n            return;\n        }\n        \n        // 杞崲绫诲悕涓烘枃浠惰矾寰?
        $class_path = str_replace( 'SUT_WeChat_Mini_', '', $class );\n        $class_path = strtolower( str_replace( '_', '-', $class_path ) );\n        \n        // 鏋勫缓鏂囦欢璺緞\n        $parts = explode( '-', $class_path );\n        $module = '';\n        $file_name = '';\n        \n        if ( count( $parts ) > 1 ) {\n            $module = $parts[0];\n            $file_name = 'class-sut-wechat-mini-' . $class_path . '.php';\n        } else {\n            $file_name = 'class-sut-wechat-mini-' . $class_path . '.php';\n        }\n        \n        // 纭畾鏂囦欢浣嶇疆\n        $file_path = '';\n        \n        if ( ! empty( $module ) ) {\n            // 妫€鏌ユā鍧楃洰褰?
            $module_dir = SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/' . $module . '/';\n            \n            if ( file_exists( $module_dir . $file_name ) ) {\n                $file_path = $module_dir . $file_name;\n            }\n        }\n        \n        // 妫€鏌ユ牴鐩綍\n        if ( empty( $file_path ) ) {\n            $root_dir = SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/';\n            \n            if ( file_exists( $root_dir . $file_name ) ) {\n                $file_path = $root_dir . $file_name;\n            }\n        }\n        \n        // 鍔犺浇鏂囦欢\n        if ( ! empty( $file_path ) && file_exists( $file_path ) ) {\n            require_once $file_path;\n        }\n    }\n    \n    /**\n     * 鍒濆鍖栨彃浠?
     */\n    private function init() {\n        // 鍔犺浇鏂囨湰鍩?
        $this->load_textdomain();\n        \n        // 娉ㄥ唽閽╁瓙\n        $this->register_hooks();\n        \n        // 鍔犺浇API妯″潡\n        $this->load_api();\n        \n        // 鍔犺浇鐢ㄦ埛妯″潡\n        $this->load_users();\n        \n        // 鍔犺浇鍐呭妯″潡\n        $this->load_content();\n        \n        // 鍔犺浇WooCommerce妯″潡锛堝鏋滃畨瑁呬簡WooCommerce锛?
        $this->load_woocommerce();\n        \n        // 鍔犺浇鏀粯妯″潡\n        $this->load_payments();\n        \n        // 鍔犺浇娑堟伅妯″潡\n        $this->load_messages();\n        \n        // 鍔犺浇绉垎妯″潡\n        $this->load_points();\n        \n        // 鍔犺浇缂撳瓨妯″潡\n        $this->load_cache();\n        \n        // 鍔犺浇绠＄悊妯″潡\n        $this->load_admin();\n    }\n    \n    /**\n     * 鍔犺浇鏂囨湰鍩?
     *\n     * @return void\n     */\n    private function load_textdomain() {\n        // 涓轰簡瑙ｅ喅鎻掍欢婵€娲婚棶棰橈紝鏆傛椂绂佺敤缈昏瘧鍔犺浇鍔熻兘銆?
        // load_plugin_textdomain( 'sut-wechat-mini', false, basename( SUT_WECHAT_MINI_PLUGIN_DIR ) . '/languages' );\n    }\n    \n    /**\n     * 娉ㄥ唽閽╁瓙\n     */\n    private function register_hooks() {\n        // 婵€娲婚挬瀛?
        register_activation_hook( SUT_WECHAT_MINI_PLUGIN_FILE, array( 'SUT_WeChat_Mini_Install', 'activate' ) );\n        \n        // 鍋滅敤閽╁瓙\n        register_deactivation_hook( SUT_WECHAT_MINI_PLUGIN_FILE, array( 'SUT_WeChat_Mini_Install', 'deactivate' ) );\n        \n        // 鍗歌浇閽╁瓙\n        register_uninstall_hook( SUT_WECHAT_MINI_PLUGIN_FILE, array( 'SUT_WeChat_Mini_Install', 'uninstall' ) );\n        \n        // WordPress鍒濆鍖栭挬瀛?
        add_action( 'init', array( $this, 'on_init' ) );\n        \n        // 鎻掍欢鍔犺浇瀹屾垚閽╁瓙\n        add_action( 'plugins_loaded', array( $this, 'on_plugins_loaded' ) );\n        \n        // 妯℃澘閲嶅畾鍚戦挬瀛?
        add_action( 'template_redirect', array( $this, 'on_template_redirect' ) );\n    }\n    \n    /**\n     * 鍔犺浇API妯″潡\n     */\n    private function load_api() {\n        // 瀵煎叆API绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_API' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/api/class-sut-wechat-mini-api.php';\n        }\n        \n        // 鍒濆鍖朅PI\n        $api = SUT_WeChat_Mini_API::get_instance();\n        // 娉ㄦ剰锛歩nit()鏂规硶鍦ㄦ瀯閫犲嚱鏁颁腑宸茶嚜鍔ㄨ皟鐢紝鏃犻渶鍐嶆璋冪敤\n    }\n    \n    /**\n     * 鍔犺浇鐢ㄦ埛妯″潡\n     */\n    private function load_users() {\n        // 瀵煎叆鐢ㄦ埛绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_Users' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/users/class-sut-wechat-mini-users.php';\n        }\n        \n        // 鍒濆鍖栫敤鎴锋ā鍧?
        $users = SUT_WeChat_Mini_Users::get_instance();\n        // 娉ㄦ剰锛歩nit()鏂规硶鍦ㄦ瀯閫犲嚱鏁颁腑宸茶嚜鍔ㄨ皟鐢紝鏃犻渶鍐嶆璋冪敤\n    }\n    \n    /**\n     * 鍔犺浇鍐呭妯″潡\n     */\n    private function load_content() {\n        // 瀵煎叆鍐呭绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_Content' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/content/class-sut-wechat-mini-content.php';\n        }\n        \n        // 鍒濆鍖栧唴瀹规ā鍧?
        $content = SUT_WeChat_Mini_Content::get_instance();\n        // 娉ㄦ剰锛歩nit()鏂规硶鍦ㄦ瀯閫犲嚱鏁颁腑宸茶嚜鍔ㄨ皟鐢紝鏃犻渶鍐嶆璋冪敤\n    }\n    \n    /**\n     * 鍔犺浇WooCommerce妯″潡\n     */\n    private function load_woocommerce() {\n        // 妫€鏌ooCommerce鏄惁婵€娲?
        if ( class_exists( 'WooCommerce' ) ) {\n            // 瀵煎叆WooCommerce绫?
            if ( ! class_exists( 'SUT_WeChat_Mini_WooCommerce' ) ) {\n                require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/woocommerce/class-sut-wechat-mini-woocommerce.php';\n            }\n            \n            // 鍒濆鍖朩ooCommerce妯″潡 - get_instance()浼氳皟鐢ㄦ瀯閫犲嚱鏁帮紝鑰屾瀯閫犲嚱鏁颁腑宸茬粡璋冪敤浜唅nit()\n            SUT_WeChat_Mini_WooCommerce::get_instance();\n        }\n    }\n    \n    /**\n     * 鍔犺浇鏀粯妯″潡\n     */\n    private function load_payments() {\n        // 瀵煎叆鏀粯绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_Pay' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/payments/class-sut-wechat-mini-pay.php';\n        }\n        \n        // 鍒濆鍖栨敮浠樻ā鍧?
        $pay = SUT_WeChat_Mini_Pay::get_instance();\n        // 娉ㄦ剰锛歩nit()鏂规硶鍦ㄦ瀯閫犲嚱鏁颁腑宸茶嚜鍔ㄨ皟鐢紝鏃犻渶鍐嶆璋冪敤\n    }\n    \n    /**\n     * 鍔犺浇娑堟伅妯″潡\n     */\n    private function load_messages() {\n        // 瀵煎叆娑堟伅绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_Messages' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/messages/class-sut-wechat-mini-messages.php';\n        }\n        \n        // 鍒濆鍖栨秷鎭ā鍧?
        $messages = SUT_WeChat_Mini_Messages::get_instance();\n        // 娑堟伅妯″潡涓嶉渶瑕佸崟鐙殑init鏂规硶锛屾瀯閫犲嚱鏁板凡缁忓鐞嗕簡鍒濆鍖?
    }\n    \n    /**\n     * 鍔犺浇绉垎妯″潡\n     */\n    private function load_points() {\n        // 瀵煎叆绉垎绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_Points' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/points/class-sut-wechat-mini-points.php';\n        }\n        \n        // 鍒濆鍖栫Н鍒嗘ā鍧?
        $points = SUT_WeChat_Mini_Points::get_instance();\n        // 绉垎妯″潡涓嶉渶瑕佸崟鐙殑init鏂规硶锛屾瀯閫犲嚱鏁板凡缁忓鐞嗕簡鍒濆鍖?
    }\n    \n    /**\n     * 鍔犺浇缂撳瓨妯″潡\n     */\n    private function load_cache() {\n        // 瀵煎叆缂撳瓨绫?
        if ( ! class_exists( 'SUT_WeChat_Mini_Cache' ) ) {\n            require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/cache/class-sut-wechat-mini-cache.php';\n        }\n        \n        // 鍒濆鍖栫紦瀛樻ā鍧?
        $cache = SUT_WeChat_Mini_Cache::get_instance();\n        // 缂撳瓨妯″潡涓嶉渶瑕佸崟鐙殑init鏂规硶锛屾瀯閫犲嚱鏁板凡缁忓鐞嗕簡鍒濆鍖?
    }\n    \n    /**\n     * 鍔犺浇绠＄悊妯″潡\n     */\n    private function load_admin() {\n        // 鍙湪鍚庡彴鍔犺浇绠＄悊妯″潡\n        if ( is_admin() ) {\n            // 瀵煎叆绠＄悊绫?
            if ( ! class_exists( 'SUT_WeChat_Mini_Admin' ) ) {\n                require_once SUT_WECHAT_MINI_PLUGIN_DIR . 'includes/admin/class-sut-wechat-mini-admin.php';\n            }\n            \n            // 鍒濆鍖栫鐞嗘ā鍧?
            $admin = SUT_WeChat_Mini_Admin::get_instance();\n            // 娉ㄦ剰锛歩nit()鏂规硶鍦ㄦ瀯閫犲嚱鏁颁腑宸茶嚜鍔ㄨ皟鐢紝鏃犻渶鍐嶆璋冪敤\n        }\n    }\n    \n    /**\n     * 澶勭悊WordPress鍒濆鍖栦簨浠?
     */\n    public function on_init() {\n        // 娉ㄥ唽閲嶅啓瑙勫垯\n        $this->register_rewrite_rules();\n        \n        // 娉ㄥ唽鑷畾涔夋煡璇㈠彉閲?
        $this->register_query_vars();\n        \n        // 娉ㄥ唽鑷畾涔夋枃绔犵被鍨嬪拰鍒嗙被娉?
        $this->register_post_types_and_taxonomies();\n    }\n    \n    /**\n     * 澶勭悊鎻掍欢鍔犺浇瀹屾垚浜嬩欢\n     */\n    public function on_plugins_loaded() {\n        // 瑙﹀彂鎻掍欢鍔犺浇瀹屾垚閽╁瓙\n        do_action( 'sut_wechat_mini_loaded' );\n    }\n    \n    /**\n     * 澶勭悊妯℃澘閲嶅畾鍚戜簨浠?
     */\n    public function on_template_redirect() {\n        // 妫€鏌ユ槸鍚︽槸API璇锋眰\n        if ( $this->is_api_request() ) {\n            // 涓嶆墽琛屾ā鏉块噸瀹氬悜\n            return;\n        }\n    }\n    \n    /**\n     * 娉ㄥ唽閲嶅啓瑙勫垯\n     */\n    private function register_rewrite_rules() {\n        // API閲嶅啓瑙勫垯鐢盇PI妯″潡澶勭悊\n    }\n    \n    /**\n     * 娉ㄥ唽鑷畾涔夋煡璇㈠彉閲?
     */\n    private function register_query_vars() {\n        global $wp;\n        \n        $wp->add_query_var( 'sut_wechat_mini_api' );\n        $wp->add_query_var( 'sut_wechat_mini_action' );\n        $wp->add_query_var( 'sut_wechat_mini_token' );\n    }\n    \n    /**\n     * 娉ㄥ唽鑷畾涔夋枃绔犵被鍨嬪拰鍒嗙被娉?
     */\n    private function register_post_types_and_taxonomies() {\n        // 娉ㄥ唽灏忕▼搴忛〉闈㈡枃绔犵被鍨?
        register_post_type( 'sut_wechat_mini_page', array(\n            'labels' => array(\n                'name' => __( '灏忕▼搴忛〉闈?, 'sut-wechat-mini' ),\n                'singular_name' => __( '灏忕▼搴忛〉闈?, 'sut-wechat-mini' ),\n                'add_new' => __( '娣诲姞鏂伴〉闈?, 'sut-wechat-mini' ),\n                'add_new_item' => __( '娣诲姞鏂板皬绋嬪簭椤甸潰', 'sut-wechat-mini' ),\n                'edit_item' => __( '缂栬緫灏忕▼搴忛〉闈?, 'sut-wechat-mini' ),\n                'new_item' => __( '鏂板皬绋嬪簭椤甸潰', 'sut-wechat-mini' ),\n                'view_item' => __( '鏌ョ湅灏忕▼搴忛〉闈?, 'sut-wechat-mini' ),\n                'search_items' => __( '鎼滅储灏忕▼搴忛〉闈?, 'sut-wechat-mini' ),\n                'not_found' => __( '鏈壘鍒板皬绋嬪簭椤甸潰', 'sut-wechat-mini' ),\n                'not_found_in_trash' => __( '鍥炴敹绔欎腑鏈壘鍒板皬绋嬪簭椤甸潰', 'sut-wechat-mini' ),\n                'parent_item_colon' => __( '鐖剁骇椤甸潰:', 'sut-wechat-mini' ),\n                'menu_name' => __( '灏忕▼搴忛〉闈?, 'sut-wechat-mini' ),\n            ),\n            'public' => true,\n            'publicly_queryable' => true,\n            'show_ui' => true,\n            'show_in_menu' => 'sut-wechat-mini',\n            'query_var' => true,\n            'rewrite' => array( 'slug' => 'sut-wechat-mini-page' ),\n            'capability_type' => 'post',\n            'has_archive' => false,\n            'hierarchical' => false,\n            'menu_position' => null,\n            'supports' => array( 'title', 'editor', 'thumbnail', 'excerpt', 'custom-fields' )\n        ) );\n        \n        // 娉ㄥ唽灏忕▼搴忔ā鏉垮垎绫绘硶\n        register_taxonomy( 'sut_wechat_mini_template', 'sut_wechat_mini_page', array(\n            'labels' => array(\n                'name' => __( '椤甸潰妯℃澘', 'sut-wechat-mini' ),\n                'singular_name' => __( '椤甸潰妯℃澘', 'sut-wechat-mini' ),\n                'search_items' => __( '鎼滅储椤甸潰妯℃澘', 'sut-wechat-mini' ),\n                'all_items' => __( '鎵€鏈夐〉闈㈡ā鏉?, 'sut-wechat-mini' ),\n                'parent_item' => __( '鐖剁骇妯℃澘', 'sut-wechat-mini' ),\n                'parent_item_colon' => __( '鐖剁骇妯℃澘:', 'sut-wechat-mini' ),\n                'edit_item' => __( '缂栬緫椤甸潰妯℃澘', 'sut-wechat-mini' ),\n                'update_item' => __( '鏇存柊椤甸潰妯℃澘', 'sut-wechat-mini' ),\n                'add_new_item' => __( '娣诲姞鏂伴〉闈㈡ā鏉?, 'sut-wechat-mini' ),\n                'new_item_name' => __( '鏂伴〉闈㈡ā鏉垮悕绉?, 'sut-wechat-mini' ),\n                'menu_name' => __( '椤甸潰妯℃澘', 'sut-wechat-mini' ),\n            ),\n            'hierarchical' => true,\n            'public' => true,\n            'show_ui' => true,\n            'show_admin_column' => true,\n            'show_in_nav_menus' => true,\n            'show_tagcloud' => false,\n            'rewrite' => array( 'slug' => 'sut-wechat-mini-template' ),\n        ) );\n    }\n    \n    /**\n     * 妫€鏌ユ槸鍚︽槸API璇锋眰\n     *\n     * @return bool 鏄惁鏄疉PI璇锋眰\n     */\n    private function is_api_request() {\n        global $wp;\n        \n        $api_var = get_query_var( 'sut_wechat_mini_api', '' );\n        \n        return ! empty( $api_var );\n    }\n    \n    /**\n     * 娉ㄥ唽涓€涓姩浣滈挬瀛?
     *\n     * @param string $tag 閽╁瓙鏍囩\n     * @param callable $function_to_add 瑕佹坊鍔犵殑鍑芥暟\n     * @param int $priority 浼樺厛绾?
     * @param int $accepted_args 鎺ュ彈鐨勫弬鏁版暟閲?
     * @return bool 鎿嶄綔缁撴灉\n     */\n    public function add_action( $tag, $function_to_add, $priority = 10, $accepted_args = 1 ) {\n        $this->hooks[] = array(\n            'type' => 'action',\n            'tag' => $tag,\n            'function_to_add' => $function_to_add,\n            'priority' => $priority,\n            'accepted_args' => $accepted_args\n        );\n        \n        return add_action( $tag, $function_to_add, $priority, $accepted_args );\n    }\n    \n    /**\n     * 娉ㄥ唽涓€涓繃婊ゅ櫒閽╁瓙\n     *\n     * @param string $tag 閽╁瓙鏍囩\n     * @param callable $function_to_add 瑕佹坊鍔犵殑鍑芥暟\n     * @param int $priority 浼樺厛绾?
     * @param int $accepted_args 鎺ュ彈鐨勫弬鏁版暟閲?
     * @return bool 鎿嶄綔缁撴灉\n     */\n    public function add_filter( $tag, $function_to_add, $priority = 10, $accepted_args = 1 ) {\n        $this->hooks[] = array(\n            'type' => 'filter',\n            'tag' => $tag,\n            'function_to_add' => $function_to_add,\n            'priority' => $priority,\n            'accepted_args' => $accepted_args\n        );\n        \n        return add_filter( $tag, $function_to_add, $priority, $accepted_args );\n    }\n    \n    /**\n     * 鑾峰彇宸叉敞鍐岀殑閽╁瓙\n     *\n     * @return array 閽╁瓙鍒楄〃\n     */\n    public function get_hooks() {\n        return $this->hooks;\n    }\n    \n    /**\n     * 鑾峰彇鎻掍欢璁剧疆\n     *\n     * @return array 鎻掍欢璁剧疆\n     */\n    public function get_settings() {\n        $settings = get_option( 'sut_wechat_mini_settings', array() );\n        \n        // 鍚堝苟榛樿璁剧疆\n        $default_settings = $this->get_default_settings();\n        $settings = array_merge( $default_settings, $settings );\n        \n        return $settings;\n    }\n    \n    /**\n     * 鑾峰彇榛樿璁剧疆\n     *\n     * @return array 榛樿璁剧疆\n     */\n    private function get_default_settings() {\n        return array(\n            'app_id' => '',\n            'app_secret' => '',\n            'mch_id' => '',\n            'api_key' => '',\n            'notify_url' => '',\n            'cache_ttl' => 3600,\n            'enable_log' => 0,\n            'enable_template_message' => 1,\n            'template_message_order_paid' => '',\n            'template_message_order_shipped' => '',\n            'template_message_refund_success' => '',\n        );\n    }\n    \n    /**\n     * 妫€鏌ユ彃浠舵槸鍚﹂厤缃纭?
     *\n     * @return bool 鏄惁閰嶇疆姝ｇ‘\n     */\n    public function is_configured() {\n        $settings = $this->get_settings();\n        \n        // 妫€鏌ュ繀瑕佺殑閰嶇疆椤?
        if ( empty( $settings['app_id'] ) || empty( $settings['app_secret'] ) ) {\n            return false;\n        }\n        \n        // 濡傛灉鍚敤浜嗘敮浠樺姛鑳斤紝妫€鏌ユ敮浠橀厤缃?
        if ( class_exists( 'WooCommerce' ) && empty( $settings['mch_id'] ) && empty( $settings['api_key'] ) ) {\n            // 鏀粯閰嶇疆涓嶅畬鏁达紝浣嗕笉鏄嚧鍛介敊璇?
        }\n        \n        return true;\n    }\n    \n    /**\n     * 鑾峰彇鎻掍欢鐗堟湰鍙?
     *\n     * @return string 鐗堟湰鍙?
     */\n    public function get_version() {\n        return SUT_WECHAT_MINI_VERSION;\n    }\n    \n    /**\n     * 鑾峰彇鎻掍欢鐩綍璺緞\n     *\n     * @return string 鐩綍璺緞\n     */\n    public function get_plugin_dir() {\n        return SUT_WECHAT_MINI_PLUGIN_DIR;\n    }\n    \n    /**\n     * 鑾峰彇鎻掍欢URL\n     *\n     * @return string 鎻掍欢URL\n     */\n    public function get_plugin_url() {\n        return SUT_WECHAT_MINI_PLUGIN_URL;\n    }\n    \n    /**\n     * 鑾峰彇鎻掍欢鏂囦欢璺緞\n     *\n     * @return string 鏂囦欢璺緞\n     */\n    public function get_plugin_file() {\n        return SUT_WECHAT_MINI_PLUGIN_FILE;\n    }\n    \n    /**\n     * 鑾峰彇鎻掍欢鍩烘湰URL\n     *\n     * @return string 鍩烘湰URL\n     */\n    public function get_base_url() {\n        return home_url();\n    }\n    \n    /**\n     * 鑾峰彇API鍩虹URL\n     *\n     * @return string API鍩虹URL\n     */\n    public function get_api_base_url() {\n        return home_url( 'sut-wechat-mini-api/' );\n    }\n    \n    /**\n     * 鑾峰彇璧勬簮鏂囦欢URL\n     *\n     * @param string $path 璧勬簮璺緞\n     * @return string 璧勬簮URL\n     */\n    public function get_asset_url( $path ) {\n        return $this->get_plugin_url() . 'assets/' . ltrim( $path, '/' );\n    }\n    \n    /**\n     * 鑾峰彇妯℃澘鏂囦欢璺緞\n     *\n     * @param string $template_name 妯℃澘鍚嶇О\n     * @return string 妯℃澘鏂囦欢璺緞\n     */\n    public function get_template_path( $template_name ) {\n        $template_path = $this->get_plugin_dir() . 'templates/' . $template_name;\n        \n        // 妫€鏌ヤ富棰樻槸鍚︽湁瑕嗙洊妯℃澘\n        $theme_template_path = get_stylesheet_directory() . '/sut-wechat-mini/' . $template_name;\n        \n        if ( file_exists( $theme_template_path ) ) {\n            $template_path = $theme_template_path;\n        }\n        \n        return $template_path;\n    }\n    \n    /**\n     * 鍔犺浇妯℃澘鏂囦欢\n     *\n     * @param string $template_name 妯℃澘鍚嶇О\n     * @param array $args 鍙傛暟鏁扮粍\n     * @return bool 鏄惁鍔犺浇鎴愬姛\n     */\n    public function load_template( $template_name, $args = array() ) {\n        $template_path = $this->get_template_path( $template_name );\n        \n        if ( ! file_exists( $template_path ) ) {\n            return false;\n        }\n        \n        // 鎻愬彇鍙傛暟鍙橀噺\n        if ( ! empty( $args ) && is_array( $args ) ) {\n            extract( $args );\n        }\n        \n        // 鍔犺浇妯℃澘\n        include $template_path;\n        \n        return true;\n    }\n}\n