锘??php\n/**\n * SUT瀵邦喕淇婄亸蹇曗柤鎼村繒顓搁悶鍡欒\n *\n * 婢跺嫮鎮婇幓鎺嶆閻ㄥ嫬鎮楅崣鎵吀閻炲棗濮涢懗鏂ょ礉閸栧懏瀚拋鍓х枂妞ょ敻娼伴妴浣藉綅閸楁洜鐡慭n *\n * @package SUT_WeChat_Mini\n */\n\nif ( ! defined( 'ABSPATH' ) ) {\n    exit;\n}\n\n/**\n * SUT_WeChat_Mini_Admin 缁?
 */\nclass SUT_WeChat_Mini_Admin {\n    \n    /**\n     * 缁狅紕鎮婄猾璇茬杽娓?
     *\n     * @var SUT_WeChat_Mini_Admin\n     */\n    private static $instance = null;\n    \n    /**\n     * 閹绘帊娆㈢拋鍓х枂闁銆嶉崥宥囆瀄n     *\n     * @var string\n     */\n    private $option_name = 'sut_wechat_mini_settings';\n    \n    /**\n     * 閺嬪嫰鈧姴鍤遍弫?
     */\n    public function __construct() {\n        $this->init();\n    }\n    \n    /**\n     * 閼惧嘲褰囬崡鏇氱伐鐎圭偘绶n     *\n     * @return SUT_WeChat_Mini_Admin\n     */\n    public static function get_instance() {\n        if ( null === self::$instance ) {\n            self::$instance = new self();\n        }\n        return self::$instance;\n    }\n    \n\n    \n    /**\n     * 濞撳弶鐓嬬拋鍓х枂妞ょ敻娼癨n     */\n    public function render_settings_page() {\n        // 濡偓閺屻儳鏁ら幋閿嬫綀闂?
        if ( ! current_user_can( 'manage_options' ) ) {\n            wp_die( __( '閹劍鐥呴張澶庡喕婢剁喓娈戦弶鍐鐠佸潡妫跺銈夈€夐棃顫偓?, 'sut-wechat-mini' ) );\n        }\n        \n        // 閼惧嘲褰囪ぐ鎾冲鐠佸墽鐤嗛崐?
        $settings = get_option( 'sut_wechat_mini_settings', array() );\n        \n        // 鏉堟挸鍤い鐢告桨閺嶅洭顣介崪宀冾嚛閺?
        ?>\n        <div class="wrap">\n            <h1 class="wp-heading-inline"><?php _e( '瀵邦喕淇婄亸蹇曗柤鎼村繗顔曠純?, 'sut-wechat-mini' ); ?></h1>\n            <p class="description"><?php _e( '闁板秶鐤嗛幃銊ф畱瀵邦喕淇婄亸蹇曗柤鎼村繒娴夐崗瀹狀啎缂冾喓鈧?, 'sut-wechat-mini' ); ?></p>\n            \n            <?php if ( isset( $_GET['settings-updated'] ) ) : ?>\n                <div class="notice notice-success is-dismissible">\n                    <p><?php _e( '鐠佸墽鐤嗗韫箽鐎涙ǜ鈧?, 'sut-wechat-mini' ); ?></p>\n                </div>\n            <?php endif; ?>\n            \n            <div class="sut-wechat-mini-content">\n                <form method="post" action="options.php">\n                    <?php settings_fields( 'sut_wechat_mini_settings_group' ); ?>\n                    <?php $this->render_settings_form( $settings ); ?>\n                    <?php submit_button(); ?>\n                </form>\n            </div>\n        </div>\n        <?php\n    }\n    \n    /**\n     * 濞撳弶鐓嬮悽銊﹀煕妞ょ敻娼癨n     */\n    public function render_users_page() {\n        // 濡偓閺屻儳鏁ら幋閿嬫綀闂?
        if ( ! current_user_can( 'manage_options' ) ) {\n            wp_die( __( '閹劍鐥呴張澶庡喕婢剁喓娈戦弶鍐鐠佸潡妫跺銈夈€夐棃顫偓?, 'sut-wechat-mini' ) );\n        }\n        \n        // 鏉堟挸鍤い鐢告桨閺嶅洭顣介崪宀冾嚛閺?
        ?>\n        <div class="wrap">\n            <h1 class="wp-heading-inline"><?php _e( '閻劍鍩涚粻锛勬倞', 'sut-wechat-mini' ); ?></h1>\n            <p class="description"><?php _e( '缁狅紕鎮婂顔讳繆鐏忓繒鈻兼惔蹇曟畱閻劍鍩涢妴?, 'sut-wechat-mini' ); ?></p>\n            \n            <div class="sut-wechat-mini-content">\n                <?php $this->render_users_table(); ?>\n            </div>\n        </div>\n        <?php\n    }\n    \n    /**\n     * 濞撳弶鐓嬬拋銏犲礋妞ょ敻娼癨n     */\n    public function render_orders_page() {\n        // 濡偓閺屻儳鏁ら幋閿嬫綀闂?
        if ( ! current_user_can( 'manage_options' ) ) {\n            wp_die( __( '閹劍鐥呴張澶庡喕婢剁喓娈戦弶鍐鐠佸潡妫跺銈夈€夐棃顫偓?, 'sut-wechat-mini' ) );\n        }\n        \n        // 鏉堟挸鍤い鐢告桨閺嶅洭顣介崪宀冾嚛閺?
        ?>\n        <div class="wrap">\n            <h1 class="wp-heading-inline"><?php _e( '鐠併垹宕熺粻锛勬倞', 'sut-wechat-mini' ); ?></h1>\n            <p class="description"><?php _e( '缁狅紕鎮婂顔讳繆鐏忓繒鈻兼惔蹇曟畱鐠併垹宕熼妴?, 'sut-wechat-mini' ); ?></p>\n            \n            <div class="sut-wechat-mini-content">\n                <?php $this->render_orders_table(); ?>\n            </div>\n        </div>\n        <?php\n    }\n    \n    /**\n     * 濞撳弶鐓嬬拋鍓х枂鐞涖劌宕焅n     *\n     * @param array $settings 瑜版挸澧犵拋鍓х枂閸?
     */\n    private function render_settings_form( $settings ) {\n        $all_settings = $this->get_all_settings();\n        \n        // 濡偓閺屻儲妲搁崥锔芥箒妤傛ü绱崗鍫㈤獓閻ㄥ嫬绻€婵夘偄鐡у▓?
        $has_high_priority_fields = false;\n        foreach ( $all_settings as $section ) {\n            foreach ( $section['fields'] as $field ) {\n                if ( isset( $field['priority'] ) && $field['priority'] === 'high' ) {\n                    $has_high_priority_fields = true;\n                    break 2;\n                }\n            }\n        }\n        \n        // 鏉堟挸鍤拋鍓х枂鐞涖劌宕焅n        foreach ( $all_settings as $section_id => $section ) {\n            ?>\n            <div class="sut-wechat-mini-section">\n                <h2 class="sut-wechat-mini-section-title"><span class="dashicons <?php echo esc_attr( $section['icon'] ); ?>"></span> <?php echo esc_html( $section['title'] ); ?></h2>\n                <p class="sut-wechat-mini-section-desc"><?php echo esc_html( $section['desc'] ); ?></p>\n                \n                <table class="form-table">\n                    <?php foreach ( $section['fields'] as $field ) : ?>\n                        <tr<?php echo isset( $field['priority'] ) && $field['priority'] === 'high' ? ' class="sut-wechat-mini-field-high-priority"' : ''; ?>>\n                            <th scope="row">\n                                <label for="<?php echo esc_attr( $field['id'] ); ?>"><?php echo esc_html( $field['title'] ); ?></label>\n                                <?php if ( isset( $field['required'] ) && $field['required'] ) : ?>\n                                    <span class="description required">*</span>\n                                <?php endif; ?>\n                            </th>\n                            <td>\n                                <?php $this->render_field( $field, isset( $settings[$field['id']] ) ? $settings[$field['id']] : ( isset( $field['default'] ) ? $field['default'] : '' ) ); ?>\n                                <?php if ( isset( $field['desc'] ) ) : ?>\n                                    <p class="description"><?php echo esc_html( $field['desc'] ); ?></p>\n                                <?php endif; ?>\n                            </td>\n                        </tr>\n                    <?php endforeach; ?>\n                </table>\n            </div>\n            <?php\n        }\n        \n        // 閺勫墽銇氳箛鍛綖鐎涙顔岀拠瀛樻\n        if ( $has_high_priority_fields ) {\n            ?>\n            <p class="sut-wechat-mini-required-note">\n                <span class="description required">*</span> <?php _e( '鐞涖劎銇氳箛鍛綖鐎涙顔?, 'sut-wechat-mini' ); ?>\n            </p>\n            <?php\n        }\n    }\n    \n    /**\n     * 閺嶈宓佺€涙顔岀猾璇茬€峰〒鍙夌厠閻╃绨查惃鍕摟濞?
     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_field( $field, $value ) {\n        switch ( $field['type'] ) {\n            case 'text':\n                $this->render_input_field( $field, $value );\n                break;\n            case 'textarea':\n                $this->render_textarea_field( $field, $value );\n                break;\n            case 'checkbox':\n                $this->render_checkbox_field( $field, $value );\n                break;\n            case 'select':\n                $this->render_select_field( $field, $value );\n                break;\n            case 'radio':\n                $this->render_radio_field( $field, $value );\n                break;\n            case 'image':\n                $this->render_image_field( $field, $value );\n                break;\n            case 'color':\n                $this->render_color_field( $field, $value );\n                break;\n            case 'editor':\n                 $this->render_editor_field( $field, $value );\n                 break;\n             default:\n                 $this->render_input_field( $field, $value );\n         }\n     }\n    \n    /**\n     * 閸掓繂顫愰崠鏍吀閻炲棗濮涢懗?
     */\n    private function init() {\n        // 濞ｈ濮為懣婊冨礋妞?
        add_action( 'admin_menu', array( $this, 'add_admin_menu' ) );\n        \n        // 濞夈劌鍞界拋鍓х枂\n        add_action( 'admin_init', array( $this, 'register_settings' ) );\n        \n        // 濞ｈ濮為幓鎺嶆鐠佸墽鐤嗛柧鐐复\n        add_filter( 'plugin_action_links_' . SUT_WECHAT_MINI_PLUGIN_BASENAME, array( $this, 'add_plugin_links' ) );\n        \n        // 閸旂姾娴囩粻锛勬倞閼存碍婀伴崪灞剧壉瀵?
        add_action( 'admin_enqueue_scripts', array( $this, 'enqueue_admin_scripts' ) );\n    }\n    \n    /**\n     * 閸︺劍褰冩禒璺哄灙鐞涖劑銆夐棃銏″潑閸旂娀顤傛径鏍畱闁剧偓甯碶n     *\n     * @param array $links 閻滅増婀侀柧鐐复閺佹壆绮峔n     * @return array 娣囶喗鏁奸崥搴ｆ畱闁剧偓甯撮弫鎵矋\n     */\n    public function add_plugin_links( $links ) {\n        // 濞ｈ濮炵拋鍓х枂闁剧偓甯碶n        $settings_link = '<a href="admin.php?page=sut-wechat-mini">' . __( '鐠佸墽鐤?, 'sut-wechat-mini' ) . '</a>';\n        array_unshift( $links, $settings_link );\n        \n        return $links;\n    }\n    \n    /**\n     * 濞ｈ濮炵粻锛勬倞閼挎粌宕熸い?
     */\n    public function add_admin_menu() {\n        // 濞ｈ濮炴稉鏄忓綅閸楁洟銆峔n        add_menu_page(\n            __( 'SUT瀵邦喕淇婄亸蹇曗柤鎼?, 'sut-wechat-mini' ),\n            __( '瀵邦喕淇婄亸蹇曗柤鎼?, 'sut-wechat-mini' ),\n            'manage_options',\n            'sut-wechat-mini',\n            array( $this, 'render_settings_page' ),\n            'dashicons-smartphone',\n            80\n        );\n        \n        // 濞ｈ濮炵€涙劘褰嶉崡鏇€峔n        add_submenu_page(\n            'sut-wechat-mini',\n            __( '閸╄櫣顢呯拋鍓х枂', 'sut-wechat-mini' ),\n            __( '閸╄櫣顢呯拋鍓х枂', 'sut-wechat-mini' ),\n            'manage_options',\n            'sut-wechat-mini',\n            array( $this, 'render_settings_page' )\n        );\n        \n        add_submenu_page(\n            'sut-wechat-mini',\n            __( '閻劍鍩涚粻锛勬倞', 'sut-wechat-mini' ),\n            __( '閻劍鍩涚粻锛勬倞', 'sut-wechat-mini' ),\n            'manage_options',\n            'sut-wechat-mini-users',\n            array( $this, 'render_users_page' )\n        );\n        \n        add_submenu_page(\n            'sut-wechat-mini',\n            __( '鐠併垹宕熺粻锛勬倞', 'sut-wechat-mini' ),\n            __( '鐠併垹宕熺粻锛勬倞', 'sut-wechat-mini' ),\n            'manage_options',\n            'sut-wechat-mini-orders',\n            array( $this, 'render_orders_page' )\n        );\n        \n        add_submenu_page(\n            'sut-wechat-mini',\n            __( '閺佺増宓佺紒鐔活吀', 'sut-wechat-mini' ),\n            __( '閺佺増宓佺紒鐔活吀', 'sut-wechat-mini' ),\n            'manage_options',\n            'sut-wechat-mini-stats',\n            array( $this, 'render_stats_page' )\n        );\n    }\n    \n    /**\n     * 濞撳弶鐓嬫潏鎾冲弳濡楀棗鐡у▓?
     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_input_field( $field, $value ) {\n        // 閸掓繂顫愰崠鏍х潣閹勬殶缂佸嫸绱濈拋鍓х枂姒涙顓婚崐?
        $attrs = array(\n            'type' => $field['type'],\n            'class' => 'regular-text',\n        );\n        \n        // 婵″倹鐏夌€涙ê婀懛顏勭暰娑斿鐫橀幀褎鏆熺紒鍕剁礉閸氬牆鑻熺€瑰啩婊慭n        if ( isset( $field['attrs'] ) && is_array( $field['attrs'] ) ) {\n            $attrs = array_merge( $attrs, $field['attrs'] );\n        }\n        \n        // 婢跺嫮鎮婇悧鐟扮暰鐏炵偞鈧?
        if ( isset( $field['placeholder'] ) ) {\n            $attrs['placeholder'] = $field['placeholder'];\n        }\n        \n        if ( isset( $field['readonly'] ) && $field['readonly'] ) {\n            $attrs['readonly'] = 'readonly';\n        }\n        \n        if ( isset( $field['disabled'] ) && $field['disabled'] ) {\n            $attrs['disabled'] = 'disabled';\n        }\n        \n        if ( isset( $field['min'] ) ) {\n            $attrs['min'] = $field['min'];\n        }\n        \n        if ( isset( $field['max'] ) ) {\n            $attrs['max'] = $field['max'];\n        }\n        \n        if ( isset( $field['step'] ) ) {\n            $attrs['step'] = $field['step'];\n        }\n        \n        // 閺嬪嫬缂撶仦鐐粹偓褍鐡х粭锔胯\n        $attr_str = '';\n        foreach ( $attrs as $attr_name => $attr_value ) {\n            $attr_str .= sprintf( ' %s="%s"', esc_attr( $attr_name ), esc_attr( $attr_value ) );\n        }\n        \n        // 鏉堟挸鍤潏鎾冲弳濡?
        printf(\n            '<input id="sut_wechat_mini_field_%s" name="%s[%s]" value="%s"%s />',\n            esc_attr( $field['id'] ),\n            esc_attr( $this->option_name ),\n            esc_attr( $field['id'] ),\n            esc_attr( $value ),\n            $attr_str\n        );\n    }\n    \n    /**\n     * 濞撳弶鐓嬮弬鍥ㄦ拱閸╃喎鐡у▓?
     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_textarea_field( $field, $value ) {\n        // 閸掓繂顫愰崠鏍х潣閹勬殶缂佸嫸绱濈拋鍓х枂姒涙顓婚崐?
        $attrs = array(\n            'class' => 'large-text',\n        );\n        \n        // 婵″倹鐏夌€涙ê婀懛顏勭暰娑斿鐫橀幀褎鏆熺紒鍕剁礉閸氬牆鑻熺€瑰啩婊慭n        if ( isset( $field['attrs'] ) && is_array( $field['attrs'] ) ) {\n            $attrs = array_merge( $attrs, $field['attrs'] );\n        }\n        \n        // 婢跺嫮鎮婇悧鐟扮暰鐏炵偞鈧?
        if ( isset( $field['placeholder'] ) ) {\n            $attrs['placeholder'] = $field['placeholder'];\n        }\n        \n        if ( isset( $field['readonly'] ) && $field['readonly'] ) {\n            $attrs['readonly'] = 'readonly';\n        }\n        \n        if ( isset( $field['disabled'] ) && $field['disabled'] ) {\n            $attrs['disabled'] = 'disabled';\n        }\n        \n        // 婢跺嫮鎮婄悰灞炬殶閸滃苯鍨弫?
        $rows = isset( $attrs['rows'] ) ? $attrs['rows'] : ( isset( $field['rows'] ) ? $field['rows'] : 5 );\n        $cols = isset( $attrs['cols'] ) ? $attrs['cols'] : 50;\n        unset( $attrs['rows'], $attrs['cols'] );\n        \n        // 閺嬪嫬缂撶仦鐐粹偓褍鐡х粭锔胯\n        $attr_str = '';\n        foreach ( $attrs as $attr_name => $attr_value ) {\n            $attr_str .= sprintf( ' %s="%s"', esc_attr( $attr_name ), esc_attr( $attr_value ) );\n        }\n        \n        // 鏉堟挸鍤弬鍥ㄦ拱閸?
        printf(\n            '<textarea id="sut_wechat_mini_field_%s" name="%s[%s]" rows="%s" cols="%s"%s>%s</textarea>',\n            esc_attr( $field['id'] ),\n            esc_attr( $this->option_name ),\n            esc_attr( $field['id'] ),\n            esc_attr( $rows ),\n            esc_attr( $cols ),\n            $attr_str,\n            esc_textarea( $value )\n        );\n    }\n    \n    /**\n     * 濞撳弶鐓嬫径宥夆偓澶嬵攱鐎涙顔孿n     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_checkbox_field( $field, $value ) {\n        // 閼惧嘲褰囬崺铏诡攨鐏炵偞鈧?
        $id = $field['id'];\n        $checked = checked( $value, 1, false );\n        \n        // 閺嬪嫬缂撶仦鐐粹偓褎鏆熺紒?
        $attrs = array();\n        \n        // 濡偓閺屻儲妲搁崥锔芥箒閼奉亜鐣炬稊澶婄潣閹勬殶缂?
        if ( isset( $field['attrs'] ) && is_array( $field['attrs'] ) ) {\n            $attrs = $field['attrs'];\n        }\n        \n        // 婢跺嫮鎮婄粋浣烘暏鐏炵偞鈧?
        if ( isset( $field['disabled'] ) && $field['disabled'] ) {\n            $attrs['disabled'] = 'disabled';\n        }\n        \n        // 閺嬪嫬缂撶仦鐐粹偓褍鐡х粭锔胯\n        $attr_str = '';\n        foreach ( $attrs as $attr_name => $attr_value ) {\n            $attr_str .= sprintf( ' %s="%s"', esc_attr( $attr_name ), esc_attr( $attr_value ) );\n        }\n        \n        // 鏉堟挸鍤径宥夆偓澶嬵攱\n        printf(\n            '<input type="checkbox" id="sut_wechat_mini_field_%s" name="%s[%s]" value="1" %s%s />',\n            esc_attr( $id ),\n            esc_attr( $this->option_name ),\n            esc_attr( $id ),\n            $checked,\n            $attr_str\n        );\n    }\n    \n    /**\n     * 濞撳弶鐓嬫稉瀣闁瀚ㄧ€涙顔孿n     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_select_field( $field, $value ) {\n        // 妤犲矁鐦夐柅澶愩€嶉弫鎵矋閺勵垰鎯佺€涙ê婀猏n        if ( ! isset( $field['options'] ) || ! is_array( $field['options'] ) ) {\n            return;\n        }\n        \n        // 閼惧嘲褰囬崺铏诡攨鐏炵偞鈧?
        $id = $field['id'];\n        $options = $field['options'];\n        \n        // 閸掓繂顫愰崠鏍х潣閹勬殶缂佸嫸绱濈拋鍓х枂姒涙顓婚崐?
        $attrs = array(\n            'class' => 'regular-text',\n        );\n        \n        // 婵″倹鐏夌€涙ê婀懛顏勭暰娑斿鐫橀幀褎鏆熺紒鍕剁礉閸氬牆鑻熺€瑰啩婊慭n        if ( isset( $field['attrs'] ) && is_array( $field['attrs'] ) ) {\n            $attrs = array_merge( $attrs, $field['attrs'] );\n        }\n        \n        // 婢跺嫮鎮婃径姘垛偓澶婄潣閹?
        $multiple = false;\n        if ( ( isset( $attrs['multiple'] ) && $attrs['multiple'] ) || \n             ( isset( $field['multiple'] ) && $field['multiple'] ) ) {\n            $multiple = true;\n            $attrs['multiple'] = 'multiple';\n        }\n        \n        // 婢跺嫮鎮婄粋浣烘暏鐏炵偞鈧?
        if ( isset( $field['disabled'] ) && $field['disabled'] ) {\n            $attrs['disabled'] = 'disabled';\n        }\n        \n        // 閺嬪嫬缂撶仦鐐粹偓褍鐡х粭锔胯\n        $attr_str = '';\n        foreach ( $attrs as $attr_name => $attr_value ) {\n            $attr_str .= sprintf( ' %s="%s"', esc_attr( $attr_name ), esc_attr( $attr_value ) );\n        }\n        \n        // 鏉堟挸鍤柅澶嬪濡楀棗绱戞慨瀣垼缁?
        printf(\n            '<select id="sut_wechat_mini_field_%s" name="%s[%s]%s" %s>',\n            esc_attr( $id ),\n            esc_attr( $this->option_name ),\n            esc_attr( $id ),\n            $multiple ? '[]' : '',\n            $attr_str\n        );\n        \n        // 鏉堟挸鍤柅澶愩€峔n        foreach ( $options as $option_value => $option_label ) {\n            if ( is_array( $value ) ) {\n                $selected = selected( in_array( $option_value, $value ), true, false );\n            } else {\n                $selected = selected( $value, $option_value, false );\n            }\n            \n            printf(\n                '<option value="%s" %s>%s</option>',\n                esc_attr( $option_value ),\n                $selected,\n                esc_html( $option_label )\n            );\n        }\n        \n        echo '</select>';\n    }\n    \n    /**\n     * 濞撳弶鐓嬮崡鏇⑩偓澶嬵攱鐎涙顔孿n     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_radio_field( $field, $value ) {\n        // 妤犲矁鐦夐柅澶愩€嶉弫鎵矋閺勵垰鎯佺€涙ê婀猏n        if ( ! isset( $field['options'] ) || ! is_array( $field['options'] ) ) {\n            return;\n        }\n        \n        $id = $field['id'];\n        $options = $field['options'];\n        $i = 0;\n        \n        foreach ( $options as $option_value => $option_label ) {\n            // 閻㈢喐鍨氶崬顖欑閻ㄥ嫰鈧銆岻D\n            $option_id = sprintf( '%s_%s', $id, $i );\n            $checked = checked( $value, $option_value, false );\n            \n            // 閺嬪嫬缂撶仦鐐粹偓褎鏆熺紒?
            $atts = array(\n                'type' => 'radio',\n                'id' => 'sut_wechat_mini_field_' . $option_id,\n                'name' => $this->option_name . '[' . $id . ']',\n                'value' => $option_value,\n                'checked' => $checked,\n            );\n            \n            // 婢跺嫮鎮婄粋浣烘暏鐏炵偞鈧?
            if ( isset( $field['disabled'] ) && $field['disabled'] ) {\n                $atts['disabled'] = 'disabled';\n            }\n            \n            // 娴ｈ法鏁rintf閺嶇厧绱￠崠鏍翻閸戝搫宕熼柅澶嬵攱\n            printf(\n                '<label><input type="radio" id="%s" name="%s" value="%s" %s%s /> %s</label><br/>',\n                esc_attr( $atts['id'] ),\n                esc_attr( $atts['name'] ),\n                esc_attr( $atts['value'] ),\n                $atts['checked'],\n                isset( $atts['disabled'] ) ? ' disabled="disabled"' : '',\n                esc_html( $option_label )\n            );\n            \n            $i++;\n        }\n    }\n    \n    /**\n     * 濞撳弶鐓嬮崶鍓у娑撳﹣绱剁€涙顔孿n     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_image_field( $field, $value ) {\n        $image_url = '';\n        if ( $value ) {\n            $image_url = wp_get_attachment_url( $value );\n        }\n        \n        $html = '<div class="sut-wechat-mini-image-upload">';\n        $html .= '<input type="hidden" id="sut_wechat_mini_field_' . $field['id'] . '" name="' . $this->option_name . '[' . $field['id'] . ']" value="' . esc_attr( $value ) . '" />';\n        $html .= '<div class="image-preview">';\n        if ( $image_url ) {\n            $html .= '<img src="' . esc_url( $image_url ) . '" style="max-width: 200px; max-height: 200px;" />';\n        }\n        $html .= '</div>';\n        $html .= '<button type="button" class="button sut-wechat-mini-upload-image">' . __( '娑撳﹣绱堕崶鍓у', 'sut-wechat-mini' ) . '</button>';\n        $html .= '<button type="button" class="button sut-wechat-mini-remove-image" ' . ( $value ? '' : 'style="display: none;"' ) . '>' . __( '缁夊娅庨崶鍓у', 'sut-wechat-mini' ) . '</button>';\n        $html .= '</div>';\n        \n        echo $html;\n    }\n    \n    /**\n     * 濞撳弶鐓嬫０婊嗗闁瀚ㄧ€涙顔孿n     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_color_field( $field, $value ) {\n        // 绾喕绻氶崝鐘烘祰妫版粏澹婇柅澶嬪閸?
        wp_enqueue_style( 'wp-color-picker' );\n        wp_enqueue_script( 'wp-color-picker' );\n        \n        $atts = array(\n            'type' => 'text',\n            'id' => 'sut_wechat_mini_field_' . $field['id'],\n            'name' => $this->option_name . '[' . $field['id'] . ']',\n            'value' => esc_attr( $value ),\n            'class' => 'sut-wechat-mini-color-picker',\n            'data-default-color' => isset( $field['default'] ) ? $field['default'] : '',\n        );\n        \n        $html = '<input ';\n        foreach ( $atts as $key => $val ) {\n            $html .= $key . '="' . $val . '" ';\n        }\n        $html .= '/>';\n        \n        echo $html;\n    }\n    \n    /**\n     * 濞撳弶鐓嬬紓鏍帆閸ｃ劌鐡у▓?
     *\n     * @param array $field 鐎涙顔岄柊宥囩枂\n     * @param mixed $value 鐎涙顔岄崐?
     */\n    private function render_editor_field( $field, $value ) {\n        $editor_args = array(\n            'textarea_name' => $this->option_name . '[' . $field['id'] . ']',\n            'textarea_rows' => isset( $field['rows'] ) ? $field['rows'] : 10,\n            'media_buttons' => isset( $field['media_buttons'] ) ? $field['media_buttons'] : true,\n            'tinymce' => isset( $field['tinymce'] ) ? $field['tinymce'] : true,\n            'quicktags' => isset( $field['quicktags'] ) ? $field['quicktags'] : true,\n        );\n        \n        wp_editor( $value, 'sut_wechat_mini_field_' . $field['id'], $editor_args );\n    }\n    \n    /**\n     * 濞撳弶鐓嬮悽銊﹀煕鐞涖劍鐗竆n     */\n    private function render_users_table() {\n        global $wpdb;\n        \n        $table_name = $wpdb->prefix . 'sut_wechat_mini_users';\n        \n        // 閼惧嘲褰囬悽銊﹀煕閸掓銆僜n        $users = $wpdb->get_results( "SELECT * FROM $table_name ORDER BY create_time DESC" );\n        \n        if ( empty( $users ) ) {\n            echo '<div class="notice notice-info"><p>' . __( '閺嗗倹妫ゅ顔讳繆鐏忓繒鈻兼惔蹇曟暏閹?, 'sut-wechat-mini' ) . '</p></div>';\n            return;\n        }\n        \n        ?>\n        <table class="widefat fixed striped">\n            <thead>\n                <tr>\n                    <th scope="col" class="manage-column column-primary"><?php _e( '瀵邦喕淇婇弰鐢敌?, 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '瀵邦喕淇婃径鏉戝剼', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( 'OpenID', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( 'UnionID', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '閸忓疇浠堥悽銊﹀煕', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '閸掓稑缂撻弮鍫曟？', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '閹垮秳缍?, 'sut-wechat-mini' ); ?></th>\n                </tr>\n            </thead>\n            <tbody>\n                <?php foreach ( $users as $user ) : ?>\n                    <tr>\n                        <td class="column-primary">\n                            <?php echo esc_html( $user->nickname ); ?>\n                            <button type="button" class="toggle-row"><span class="screen-reader-text"><?php _e( '閺勫墽銇氶弴鏉戭樋鐠囷附鍎?, 'sut-wechat-mini' ); ?></span></button>\n                        </td>\n                        <td>\n                            <?php if ( $user->avatar_url ) : ?>\n                                <img src="<?php echo esc_url( $user->avatar_url ); ?>" style="width: 40px; height: 40px; border-radius: 50%;" />\n                            <?php endif; ?>\n                        </td>\n                        <td>\n                            <?php echo esc_html( $user->openid ); ?>\n                        </td>\n                        <td>\n                            <?php echo esc_html( $user->unionid ? $user->unionid : '-' ); ?>\n                        </td>\n                        <td>\n                            <?php if ( $user->wp_user_id ) : ?>\n                                <?php $wp_user = get_user_by( 'id', $user->wp_user_id ); ?>\n                                <?php if ( $wp_user ) : ?>\n                                    <a href="user-edit.php?user_id=<?php echo $user->wp_user_id; ?>"><?php echo esc_html( $wp_user->user_login ); ?></a>\n                                <?php endif; ?>\n                            <?php else : ?>\n                                -\n                            <?php endif; ?>\n                        </td>\n                        <td>\n                            <?php echo esc_html( $user->create_time ); ?>\n                        </td>\n                        <td>\n                            <a href="#" class="sut-wechat-mini-delete-user" data-id="<?php echo $user->id; ?>"><?php _e( '閸掔娀娅?, 'sut-wechat-mini' ); ?></a>\n                        </td>\n                    </tr>\n                <?php endforeach; ?>\n            </tbody>\n        </table>\n        <?php\n    }\n    \n    /**\n     * 濞撳弶鐓嬬拋銏犲礋鐞涖劍鐗竆n     */\n    private function render_orders_table() {\n        if ( ! class_exists( 'WooCommerce' ) ) {\n            echo '<div class="notice notice-error"><p>' . __( 'WooCommerce閺堫亝绺哄ú浼欑礉閺冪姵纭堕弻銉ф箙鐠併垹宕?, 'sut-wechat-mini' ) . '</p></div>';\n            return;\n        }\n        \n        // 閼惧嘲褰囩拋銏犲礋閸掓銆僜n        $args = array(\n            'post_type' => 'shop_order',\n            'post_status' => array_keys( wc_get_order_statuses() ),\n            'posts_per_page' => -1,\n            'orderby' => 'date',\n            'order' => 'DESC',\n        );\n        \n        $orders_query = new WP_Query( $args );\n        \n        if ( ! $orders_query->have_posts() ) {\n            echo '<div class="notice notice-info"><p>' . __( '閺嗗倹妫ょ拋銏犲礋', 'sut-wechat-mini' ) . '</p></div>';\n            return;\n        }\n        \n        ?>\n        <table class="widefat fixed striped">\n            <thead>\n                <tr>\n                    <th scope="col" class="manage-column column-primary"><?php _e( '鐠併垹宕熺紓鏍у娇', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '鐠併垹宕熼幀濠氼杺', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '鐠併垹宕熼悩鑸碘偓?, 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '鐎广垺鍩涙穱鈩冧紖', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '閸掓稑缂撻弮鍫曟？', 'sut-wechat-mini' ); ?></th>\n                    <th scope="col" class="manage-column"><?php _e( '閹垮秳缍?, 'sut-wechat-mini' ); ?></th>\n                </tr>\n            </thead>\n            <tbody>\n                <?php while ( $orders_query->have_posts() ) : $orders_query->the_post(); ?>\n                    <?php $order = wc_get_order( get_the_ID() ); ?>\n                    <tr>\n                        <td class="column-primary">\n                            <a href="post.php?post=<?php echo get_the_ID(); ?>&action=edit"><?php echo esc_html( $order->get_order_number() ); ?></a>\n                            <button type="button" class="toggle-row"><span class="screen-reader-text"><?php _e( '閺勫墽銇氶弴鏉戭樋鐠囷附鍎?, 'sut-wechat-mini' ); ?></span></button>\n                        </td>\n                        <td>\n                            <?php echo esc_html( $order->get_formatted_order_total() ); ?>\n                        </td>\n                        <td>\n                            <mark class="order-status status-<?php echo sanitize_title( $order->get_status() ); ?>"><span><?php echo esc_html( wc_get_order_status_name( $order->get_status() ) ); ?></span></mark>\n                        </td>\n                        <td>\n                            <?php if ( $order->get_billing_first_name() || $order->get_billing_last_name() ) : ?>\n                                <?php echo esc_html( $order->get_billing_first_name() . ' ' . $order->get_billing_last_name() ); ?><br/>\n                            <?php endif; ?>\n                            <?php if ( $order->get_billing_phone() ) : ?>\n                                <?php echo esc_html( $order->get_billing_phone() ); ?><br/>\n                            <?php endif; ?>\n                            <?php if ( $order->get_billing_email() ) : ?>\n                                <?php echo esc_html( $order->get_billing_email() ); ?><br/>\n                            <?php endif; ?>\n                        </td>\n                        <td>\n                            <?php echo esc_html( $order->get_date_created()->format( 'Y-m-d H:i:s' ) ); ?>\n                        </td>\n                        <td>\n                            <a href="post.php?post=<?php echo get_the_ID(); ?>&action=edit" class="button button-small"><?php _e( '缂傛牞绶?, 'sut-wechat-mini' ); ?></a>\n                        </td>\n                    </tr>\n                <?php endwhile; ?>\n            </tbody>\n        </table>\n        <?php\n        \n        wp_reset_postdata();\n    }\n    \n    /**\n     * 濞撳弶鐓嬮弫鐗堝祦缂佺喕顓告い鐢告桨\n     */\n    public function render_stats_page() {\n        // 濡偓閺屻儳鏁ら幋閿嬫綀闂?
        if ( ! current_user_can( 'manage_options' ) ) {\n            wp_die( __( '閹劍鐥呴張澶庡喕婢剁喓娈戦弶鍐鐠佸潡妫跺銈夈€夐棃顫偓?, 'sut-wechat-mini' ) );\n        }\n        \n        // 鏉堟挸鍤い鐢告桨閺嶅洭顣介崪宀冾嚛閺?
        ?>\n        <div class="wrap">\n            <h1 class="wp-heading-inline"><?php _e( '閺佺増宓佺紒鐔活吀', 'sut-wechat-mini' ); ?></h1>\n            <p class="description"><?php _e( '閺屻儳婀呴幃銊ф畱瀵邦喕淇婄亸蹇曗柤鎼村繋濞囬悽銊х埠鐠佲剝鏆熼幑顔衡偓?, 'sut-wechat-mini' ); ?></p>\n            \n            <div class="sut-wechat-mini-content">\n                <?php $this->render_stats_dashboard(); ?>\n            </div>\n        </div>\n        <?php\n    }\n    \n    /**\n     * 濞撳弶鐓嬮弫鐗堝祦缂佺喕顓告禒顏囥€冮惄?
     */\n    private function render_stats_dashboard() {\n        global $wpdb;\n        \n        // 閼惧嘲褰囩紒鐔活吀閺佺増宓乗n        $table_name = $wpdb->prefix . 'sut_wechat_mini_users';\n        $total_users = $wpdb->get_var( "SELECT COUNT(*) FROM $table_name" );\n        \n        $total_orders = 0;\n        $total_sales = 0;\n        if ( class_exists( 'WooCommerce' ) ) {\n            $total_orders = wc_get_orders( array(\n                'status' => array_keys( wc_get_order_statuses() ),\n                'return' => 'ids',\n            ) );\n            $total_orders = count( $total_orders );\n            \n            $total_sales = $wpdb->get_var( "\n                SELECT SUM(meta_value)\n                FROM $wpdb->postmeta\n                WHERE meta_key = '_order_total'\n                AND post_id IN (\n                    SELECT ID\n                    FROM $wpdb->posts\n                    WHERE post_type = 'shop_order'\n                    AND post_status IN ('wc-processing', 'wc-completed')\n                )\n            " );\n        }\n        \n        $total_views = get_option( 'sut_wechat_mini_total_views', 0 );\n        \n        ?>\n        <div class="sut-wechat-mini-stats-cards">\n            <div class="stat-card">\n                <div class="stat-value"><?php echo number_format( $total_users ); ?></div>\n                <div class="stat-label"><?php _e( '鐏忓繒鈻兼惔蹇曟暏閹?, 'sut-wechat-mini' ); ?></div>\n            </div>\n            \n            <?php if ( class_exists( 'WooCommerce' ) ) : ?>\n                <div class="stat-card">\n                    <div class="stat-value"><?php echo number_format( $total_orders ); ?></div>\n                    <div class="stat-label"><?php _e( '鐠併垹宕熼幀缁樻殶', 'sut-wechat-mini' ); ?></div>\n                </div>\n                \n                <div class="stat-card">\n                    <div class="stat-value"><?php echo wc_price( $total_sales ); ?></div>\n                    <div class="stat-label"><?php _e( '闁库偓閸烆喗鈧顤?, 'sut-wechat-mini' ); ?></div>\n                </div>\n            <?php endif; ?>\n            \n            <div class="stat-card">\n                <div class="stat-value"><?php echo number_format( $total_views ); ?></div>\n                <div class="stat-label"><?php _e( '妞ょ敻娼板ù蹇氼潔闁?, 'sut-wechat-mini' ); ?></div>\n            </div>\n        </div>\n        \n        <div class="sut-wechat-mini-stats-charts">\n            <div class="chart-container">\n                <h3><?php _e( '閻劍鍩涙晶鐐烘毐鐡掑濞?, 'sut-wechat-mini' ); ?></h3>\n                <div id="users-chart" style="height: 300px;"></div>\n            </div>\n            \n            <?php if ( class_exists( 'WooCommerce' ) ) : ?>\n                <div class="chart-container">\n                    <h3><?php _e( '闁库偓閸烆噣顤傜搾瀣◢', 'sut-wechat-mini' ); ?></h3>\n                    <div id="sales-chart" style="height: 300px;"></div>\n                </div>\n            <?php endif; ?>\n        </div>\n        <?php\n    }\n    \n    /**\n     * 閼惧嘲褰囬幍鈧張澶庮啎缂冾喚绮ㄩ弸?
     *\n     * @return array 鐠佸墽鐤嗙紒鎾寸€弫鎵矋\n     */\n    private function get_all_settings() {\n        return array(\n            'basic' => array(\n                'title' => '閸╄櫣顢呯拋鍓х枂',\n                'desc'  => '瀵邦喕淇婄亸蹇曗柤鎼村繒娈戦崺鐑樻拱闁板秶鐤嗘穱鈩冧紖',\n                'icon'  => 'dashicons-admin-generic',\n                'fields' => array(\n                    array(\n                        'id'      => 'appid',\n                        'title'   => '鐏忓繒鈻兼惔寤噋pID',\n                        'type'    => 'text',\n                        'desc'    => '瀵邦喕淇婄亸蹇曗柤鎼村繒娈慉ppID閿涘瞼鏁ゆ禍搴ら煩娴犱粙鐛欑拠?,\n                        'default' => '',\n                        'attrs'   => array(\n                            'placeholder' => '鐠囩柉绶崗銉ョ毈缁嬪绨瑼ppID',\n                            'class'       => 'regular-text sut-wechat-mini-input-primary'\n                        ),\n                        'required' => true,\n                        'priority' => 'high'\n                    ),\n                    array(\n                        'id'      => 'appsecret',\n                        'title'   => '鐏忓繒鈻兼惔寤噋pSecret',\n                        'type'    => 'text',\n                        'desc'    => '瀵邦喕淇婄亸蹇曗柤鎼村繒娈慉ppSecret閿涘瞼鏁ゆ禍宥I鐠嬪啰鏁?,\n                        'default' => '',\n                        'attrs'   => array(\n                            'placeholder' => '鐠囩柉绶崗銉ョ毈缁嬪绨瑼ppSecret',\n                            'class'       => 'regular-text'\n                        ),\n                        'required' => true,\n                        'priority' => 'high'\n                    ),\n                    array(\n                        'id'      => 'status',\n                        'title'   => '閸氼垳鏁ら悩鑸碘偓?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崥顖滄暏鐏忓繒鈻兼惔蹇撳閼?,\n                        'default' => 1,\n                        'priority' => 'high'\n                    ),\n                    array(\n                        'id'      => 'qrcode',\n                        'title'   => '鐏忓繒鈻兼惔蹇庣癌缂佸鐖?,\n                        'type'    => 'image',\n                        'desc'    => '鐏忓繒鈻兼惔蹇庣癌缂佸鐖滈崶鍓у閿涘瞼鏁ゆ禍搴℃躬閸撳秴褰撮弰鍓с仛',\n                        'default' => '',\n                        'attrs'   => array(\n                            'button_text' => '娑撳﹣绱舵禍宀€娣惍?\n                        )\n                    )\n                )\n            ),\n            'payment' => array(\n                'title' => '閺€顖欑帛鐠佸墽鐤?,\n                'desc'  => '瀵邦喕淇婇弨顖欑帛閻╃鍙ч柊宥囩枂',\n                'icon'  => 'dashicons-cart',\n                'fields' => array(\n                    array(\n                        'id'      => 'mch_id',\n                        'title'   => '瀵邦喕淇婇弨顖欑帛閸熷棙鍩涢崣?,\n                        'type'    => 'text',\n                        'desc'    => '瀵邦喕淇婇弨顖欑帛閸熷棙鍩涢崣鍑ょ礉閻劋绨顔讳繆閺€顖欑帛閸旂喕鍏?,\n                        'default' => '',\n                        'attrs'   => array(\n                            'placeholder' => '鐠囩柉绶崗銉ヤ簳娣団剝鏁禒妯烘櫌閹村嘲褰?,\n                            'class'       => 'regular-text'\n                        )\n                    ),\n                    array(\n                        'id'      => 'api_key',\n                        'title'   => '瀵邦喕淇婇弨顖欑帛API鐎靛棝鎸?,\n                        'type'    => 'text',\n                        'desc'    => '瀵邦喕淇婇弨顖欑帛API鐎靛棝鎸滈敍宀€鏁ゆ禍搴ｎ劮閸氬秹鐛欑拠?,\n                        'default' => '',\n                        'attrs'   => array(\n                            'placeholder' => '鐠囩柉绶崗銉ヤ簳娣団剝鏁禒妤I鐎靛棝鎸?,\n                            'class'       => 'regular-text'\n                        )\n                    ),\n                    array(\n                        'id'      => 'payment_status',\n                        'title'   => '閸氼垳鏁ら弨顖欑帛閸旂喕鍏?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崥顖滄暏瀵邦喕淇婇弨顖欑帛閸旂喕鍏?,\n                        'default' => 1\n                    )\n                )\n            ),\n            'message' => array(\n                'title' => '濞戝牊浼呴柅姘辩叀',\n                'desc'  => '瀵邦喕淇婄亸蹇曗柤鎼村繑绉烽幁顖炩偓姘辩叀闁板秶鐤?,\n                'icon'  => 'dashicons-email',\n                'fields' => array(\n                    array(\n                        'id'      => 'template_id',\n                        'title'   => '濞戝牊浼呴柅姘辩叀濡剝婢業D',\n                        'type'    => 'text',\n                        'desc'    => '閻劋绨拋銏犲礋闁氨鐓＄粵澶嬬Х閹垳娈戝Ο鈩冩緲ID',\n                        'default' => '',\n                        'attrs'   => array(\n                            'placeholder' => '鐠囩柉绶崗銉δ侀弶绺凞',\n                            'class'       => 'regular-text'\n                        )\n                    ),\n                    array(\n                        'id'      => 'message_status',\n                        'title'   => '閸氼垳鏁ゅ☉鍫熶紖闁氨鐓?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崥顖滄暏濞戝牊浼呴柅姘辩叀閸旂喕鍏?,\n                        'default' => 1\n                    )\n                )\n            ),\n            'display' => array(\n                'title' => '閺勫墽銇氱拋鍓х枂',\n                'desc'  => '鐏忓繒鈻兼惔蹇撳敶鐎硅妯夌粈铏规祲閸忔娊鍘ょ純?,\n                'icon'  => 'dashicons-format-image',\n                'fields' => array(\n                    array(\n                        'id'      => 'display_items_per_page',\n                        'title'   => '濮ｅ繘銆夐弰鍓с仛閺佷即鍣?,\n                        'type'    => 'number',\n                        'desc'    => '鐏忓繒鈻兼惔蹇庤厬濮ｅ繘銆夐弰鍓с仛閻ㄥ嫬鍞寸€硅鏆熼柌?,\n                        'default' => 10,\n                        'attrs'   => array(\n                            'min'   => 1,\n                            'max'   => 100,\n                            'step'  => 1,\n                            'class' => 'small-text'\n                        )\n                    ),\n                    array(\n                        'id'      => 'display_cover_image',\n                        'title'   => '閺勫墽銇氱亸渚€娼伴崶?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崷銊ュ灙鐞涖劋鑵戦弰鍓с仛閸愬懎顔愮亸渚€娼伴崶?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'theme_color',\n                        'title'   => '娑撳顣芥０婊嗗',\n                        'type'    => 'color',\n                        'desc'    => '鐏忓繒鈻兼惔蹇曟畱娑撳顣芥０婊嗗',\n                        'default' => '#1DA57A'\n                    ),\n                    array(\n                        'id'      => 'custom_css',\n                        'title'   => '閼奉亜鐣炬稊濉丼S',\n                        'type'    => 'textarea',\n                        'desc'    => '濞ｈ濮為懛顏勭暰娑斿SS閺嶅嘲绱￠弶銉ㄥ殰鐎规矮绠熺亸蹇曗柤鎼村繐顦荤憴?,\n                        'default' => '',\n                        'attrs'   => array(\n                            'rows'  => 5,\n                            'cols'  => 50,\n                            'placeholder' => '娓氬顩ч敍姝渙dy { color: #333; }',\n                            'class' => 'code'\n                        )\n                    )\n                )\n            ),\n            'user_management' => array(\n                'title' => '閻劍鍩涚粻锛勬倞',\n                'desc'  => '瀵邦喕淇婄亸蹇曗柤鎼村繒鏁ら幋椋庮吀閻炲棛娴夐崗鎶藉帳缂?,\n                'icon'  => 'dashicons-users',\n                'fields' => array(\n                    array(\n                        'id'      => 'user_sync_status',\n                        'title'   => '閸氼垳鏁ら悽銊﹀煕閸氬本顒?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崥顖滄暏瀵邦喕淇婇悽銊﹀煕娑撳豆ordPress閻劍鍩涢惃鍕倱濮濄儱濮涢懗?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'auto_register_users',\n                        'title'   => '閼奉亜濮╁▔銊ュ斀閻劍鍩?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺傛壆娈戝顔讳繆閻劍鍩涙＃鏍偧閻ц缍嶉弮鑸垫Ц閸氾箒鍤滈崝銊︽暈閸愬奔璐焀ordPress閻劍鍩?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'default_user_role',\n                        'title'   => '姒涙顓婚悽銊﹀煕鐟欐帟澹?,\n                        'type'    => 'select',\n                        'desc'    => '閼奉亜濮╁▔銊ュ斀閻ㄥ嫮鏁ら幋鐑界帛鐠併倛顫楅懝?,\n                        'default' => 'subscriber',\n                        'options' => $this->get_user_roles_options(),\n                        'attrs'   => array(\n                            'class' => 'regular-text'\n                        )\n                    ),\n                    array(\n                        'id'      => 'display_user_avatar',\n                        'title'   => '閺勫墽銇氶悽銊﹀煕婢舵潙鍎?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崷銊ф暏閹村嘲鍨悰銊よ厬閺勫墽銇氬顔讳繆婢舵潙鍎?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'user_data_retention',\n                        'title'   => '閻劍鍩涢弫鐗堝祦娣囨繄鏆€閺堢喖妾?,\n                        'type'    => 'number',\n                        'desc'    => '閺堫亝妞跨捄鍐暏閹撮攱鏆熼幑顔荤箽閻ｆ瑧娈戞径鈺傛殶閿?鐞涖劎銇氬闀愮畽娣囨繄鏆€閿?,\n                        'default' => 0,\n                        'attrs'   => array(\n                            'min'   => 0,\n                            'step'  => 1,\n                            'class' => 'small-text'\n                        )\n                    )\n                )\n            ),\n            'order_management' => array(\n                'title' => '鐠併垹宕熺粻锛勬倞',\n                'desc'  => '瀵邦喕淇婄亸蹇曗柤鎼村繗顓归崡鏇狀吀閻炲棛娴夐崗鎶藉帳缂?,\n                'icon'  => 'dashicons-list-alt',\n                'fields' => array(\n                    array(\n                        'id'      => 'order_sync_status',\n                        'title'   => '閸氼垳鏁ょ拋銏犲礋閸氬本顒?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺勵垰鎯侀崥顖滄暏鐏忓繒鈻兼惔蹇氼吂閸楁洑绗學ordPress/WooCommerce鐠併垹宕熼惃鍕倱濮?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'auto_update_order_status',\n                        'title'   => '閼奉亜濮╅弴瀛樻煀鐠併垹宕熼悩鑸碘偓?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺€顖欑帛閹存劕濮涢崥搴㈡Ц閸氾箒鍤滈崝銊︽纯閺傛媽顓归崡鏇犲Ц閹椒璐熷鎻掔暚閹?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'order_notification_admin',\n                        'title'   => '缁狅紕鎮婇崨妯款吂閸楁洟鈧氨鐓?,\n                        'type'    => 'checkbox',\n                        'desc'    => '閺傛媽顓归崡鏇炲灡瀵ょ儤妞傞弰顖氭儊闁氨鐓＄粻锛勬倞閸?,\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'order_notification_user',\n                        'title'   => '閻劍鍩涚拋銏犲礋闁氨鐓?,\n                        'type'    => 'checkbox',\n                        'desc'    => '鐠併垹宕熼悩鑸碘偓浣规纯閺傜増妞傞弰顖氭儊闁氨鐓￠悽銊﹀煕',\n                        'default' => 1\n                    ),\n                    array(\n                        'id'      => 'order_cancellation_period',\n                        'title'   => '鐠併垹宕熼崣鏍ㄧХ閺堢喖妾?,\n                        'type'    => 'number',\n                        'desc'    => '閺堫亝鏁禒妯款吂閸楁洝鍤滈崝銊ュ絿濞戝牏娈戠亸蹇旀閺佸府绱?鐞涖劎銇氭稉宥堝殰閸斻劌褰囧☉鍫礆',\n                        'default' => 24,\n                        'attrs'   => array(\n                            'min'   => 0,\n                            'step'  => 1,\n                            'class' => 'small-text'\n                        )\n                    ),\n                    array(\n                        'id'      => 'order_export_format',\n                        'title'   => '鐠併垹宕熺€电厧鍤弽鐓庣础',\n                        'type'    => 'select',\n                        'desc'    => '鐠併垹宕熼弫鐗堝祦鐎电厧鍤惃鍕帛鐠併倖鐗稿?,\n                        'default' => 'csv',\n                        'options' => array(\n                            'csv' => 'CSV閺嶇厧绱?,\n                            'excel' => 'Excel閺嶇厧绱?,\n                            'pdf' => 'PDF閺嶇厧绱?\n                        ),\n                        'attrs'   => array(\n                            'class' => 'regular-text'\n                        )\n                    )\n                )\n            )\n        );\n    }\n    \n    /**\n     * 閼惧嘲褰囬悽銊﹀煕鐟欐帟澹婇柅澶愩€峔n     *\n     * @return array 閻劍鍩涚憴鎺曞闁銆峔n     */\n    private function get_user_roles_options() {\n        global $wp_roles;\n        \n        if ( ! isset( $wp_roles ) ) {\n            $wp_roles = new WP_Roles();\n        }\n        \n        $roles = $wp_roles->get_names();\n        \n        return $roles;\n    }\n    \n    /**\n     * 閼惧嘲褰囬弬鍥╃彿缁鐎烽柅澶愩€峔n     *\n     * @return array 閺傚洨鐝风猾璇茬€烽柅澶愩€峔n     */\n    private function get_post_types_options() {\n        $post_types = get_post_types( array( 'public' => true ), 'objects' );\n        $options = array();\n        \n        foreach ( $post_types as $post_type ) {\n            $options[$post_type->name] = $post_type->labels->name;\n        }\n        \n        return $options;\n    }\n    \n    /**\n     * 妤犲矁鐦夐崪灞剧閻炲棜顔曠純顔芥殶閹?
     *\n     * @param array $input 鏉堟挸鍙嗛弫鐗堝祦\n     * @return array 濞撳懐鎮婇崥搴ｆ畱閺佺増宓乗n     */\n    public function sanitize_settings( $input ) {\n        $output = array();\n        \n        // 閼惧嘲褰囬幍鈧張澶庮啎缂冾噣鈧銆峔n        $settings = $this->get_all_settings();\n        \n        // 妤犲矁鐦夊В蹇庨嚋鐠佸墽鐤嗙€涙顔孿n        foreach ( $settings as $section_id => $section ) {\n            foreach ( $section['fields'] as $field ) {\n                $field_id = $field['id'];\n                \n                // 濡偓閺屻儱鐡у▓鍨Ц閸氾箑鐡ㄩ崷銊ょ艾鏉堟挸鍙嗘稉?
                if ( isset( $input[$field_id] ) ) {\n                    // 閺嶈宓佺€涙顔岀猾璇茬€锋潻娑滎攽妤犲矁鐦塡n                    switch ( $field['type'] ) {\n                        case 'text':\n                        case 'password':\n                        case 'email':\n                        case 'url':\n                            $output[$field_id] = sanitize_text_field( $input[$field_id] );\n                            break;\n                        case 'textarea':\n                            $output[$field_id] = sanitize_textarea_field( $input[$field_id] );\n                            break;\n                        case 'number':\n                            $output[$field_id] = intval( $input[$field_id] );\n                            break;\n                        case 'checkbox':\n                            $output[$field_id] = boolval( $input[$field_id] );\n                            break;\n                        case 'select':\n                        case 'radio':\n                            if ( isset( $field['options'] ) && is_array( $field['options'] ) ) {\n                                if ( isset( $field['multiple'] ) && $field['multiple'] ) {\n                                    $output[$field_id] = array();\n                                    if ( is_array( $input[$field_id] ) ) {\n                                        foreach ( $input[$field_id] as $value ) {\n                                            if ( array_key_exists( $value, $field['options'] ) ) {\n                                                $output[$field_id][] = $value;\n                                            }\n                                        }\n                                    }\n                                } else {\n                                    if ( array_key_exists( $input[$field_id], $field['options'] ) ) {\n                                        $output[$field_id] = $input[$field_id];\n                                    }\n                                }\n                            }\n                            break;\n                        case 'editor':\n                            $output[$field_id] = wp_kses_post( $input[$field_id] );\n                            break;\n                        case 'image':\n                            $output[$field_id] = intval( $input[$field_id] );\n                            break;\n                        default:\n                            $output[$field_id] = sanitize_text_field( $input[$field_id] );\n                    }\n                }\n            }\n        }\n        \n        return $output;\n    }\n    \n    /**\n     * 濞夈劌鍞界拋鍓х枂闁銆峔n     */\n    public function register_settings() {\n        // 濞夈劌鍞界拋鍓х枂缂佸嫬鎷扮€涙顔孿n        register_setting(\n            'sut_wechat_mini_settings_group',\n            'sut_wechat_mini_settings',\n            array(\n                'type' => 'array',\n                'sanitize_callback' => array( $this, 'sanitize_settings' ),\n                'default' => array()\n            )\n        );\n    }\n    \n    /**\n     * 閸旂姾娴囩粻锛勬倞閸涙鍓奸張顒€鎷伴弽宄扮础\n     */\n    public function enqueue_admin_scripts() {\n        // 閸欘亜婀幓鎺嶆妞ょ敻娼伴崝鐘烘祰閼存碍婀癨n        $screen = get_current_screen();\n        if ( $screen && $screen->id === 'toplevel_page_sut-wechat-mini' ) {\n            // 閸旂姾娴囬幓鎺嶆閺嶅嘲绱n            wp_enqueue_style(\n                'sut-wechat-mini-admin',\n                SUT_WECHAT_MINI_PLUGIN_URL . 'includes/admin/assets/css/admin.css',\n                array(),\n                SUT_WECHAT_MINI_VERSION\n            );\n            \n            // 閸旂姾娴囬幓鎺嶆閼存碍婀癨n            wp_enqueue_script(\n                'sut-wechat-mini-admin',\n                SUT_WECHAT_MINI_PLUGIN_URL . 'includes/admin/assets/js/admin.js',\n                array( 'jquery' ),\n                SUT_WECHAT_MINI_VERSION,\n                true\n            );\n            \n            // 娴肩娀鈧帒绻€鐟曚胶娈戦弫鐗堝祦閸掔檻avaScript\n            wp_localize_script(\n                'sut-wechat-mini-admin',\n                'sutWechatMiniAdmin',\n                array(\n                    'ajax_url' => admin_url( 'admin-ajax.php' ),\n                    'nonce' => wp_create_nonce( 'sut-wechat-mini-nonce' ),\n                    'i18n' => array(\n                        'confirm_delete' => __( '绾喖鐣剧憰浣稿灩闂勩倕鎮ч敍?, 'sut-wechat-mini' ),\n                        'delete_success' => __( '閸掔娀娅庨幋鎰', 'sut-wechat-mini' ),\n                        'delete_failed' => __( '閸掔娀娅庢径杈Е', 'sut-wechat-mini' )\n                    )\n                )\n            );\n        }\n    }\n}\n\n/**\n * 閸掓繂顫愰崠鏍吀閻炲棗濮涢懗?
 */\nfunction sut_wechat_mini_admin_init() {\n    SUT_WeChat_Mini_Admin::get_instance();\n}\n\nadd_action( 'admin_init', 'sut_wechat_mini_admin_init' );\n