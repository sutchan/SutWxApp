/**
 * 文件名: 01-环境搭建.md
 * 版本号: 1.0.0
 * 更新日期: 2025-11-23
 * 描述: 01-环境搭建 文档文件
 */
# 环境搭建指南

**版本号：1.0.16**
*最后更新时间：2024年11月1日*

## 1. 概述

本文档旨在指导系统管理员进行SutWxApp微信小程序项目的环境搭建，包括开发环境、测试环境和生产环境的准备与配置。

### 1.1 适用人群

- 系统管理员
- 运维人员
- 开发团队负责人

### 1.2 文档目的

- 提供标准化的环境搭建流程
- 确保各环境配置的一致性
- 减少环境差异导致的问题
- 加速项目部署和维护过程

## 2. 开发环境准备

### 2.1 系统要求

#### 2.1.1 操作系统

- **Windows 10/11**：推荐使用64位版本
- **内存**：至少8GB RAM，推荐16GB
- **硬盘空间**：至少50GB可用空间
- **处理器**：Intel i5或同等性能处理器以上
- **网络**：稳定的互联网连接（用于依赖下载和微信开发者工具使用）

#### 2.1.2 系统配置

- 确保Windows更新至最新版本
- 关闭不必要的安全软件或配置其白名单
- 确保足够的临时目录空间

### 2.2 开发工具安装

#### 2.2.1 微信开发者工具

1. 访问[微信开发者工具官方下载页](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 下载最新稳定版微信开发者工具
3. 运行安装程序，按照向导完成安装
4. 启动开发者工具，使用微信扫码登录

#### 2.2.2 Node.js环境

1. 访问[Node.js官方下载页](https://nodejs.org/en/download/)
2. 下载最新的LTS版本（推荐16.x或18.x）
3. 运行安装程序，选择默认配置
4. 安装完成后，打开命令提示符验证：
   ```
   node -v
   npm -v
   ```

#### 2.2.3 Git版本控制

1. 访问[Git官方下载页](https://git-scm.com/download/win)
2. 下载最新版本的Git for Windows
3. 运行安装程序，使用默认配置或根据需要自定义
4. 安装完成后，验证安装：
   ```
   git --version
   ```

#### 2.2.4 代码编辑器（推荐）

1. **Visual Studio Code**
   - 访问[VS Code官方下载页](https://code.visualstudio.com/Download)
   - 下载并安装VS Code
   - 安装推荐插件：
     - 微信小程序助手
     - ESLint
     - Prettier - Code formatter
     - Markdown All in One

### 2.3 项目依赖安装

#### 2.3.1 克隆项目仓库

```bash
git clone https://github.com/sutchan/SutWxApp.git
cd SutWxApp
```

#### 2.3.2 安装npm依赖

```bash
npm install
```

#### 2.3.3 安装开发依赖

```bash
npm install --save-dev jest eslint prettier
```

## 3. 测试环境配置

### 3.1 测试环境要求

- 与开发环境相似的硬件配置
- 独立的数据库实例
- 与生产环境隔离的网络环境
- 相同版本的软件依赖

### 3.2 测试环境搭建步骤

#### 3.2.1 环境准备

1. 按照开发环境的步骤安装基础软件
2. 创建独立的项目目录用于测试环境

#### 3.2.2 数据库配置

1. 设置测试数据库实例
2. 导入测试数据（可从开发环境导出或使用专用测试数据集）
3. 配置数据库连接信息（确保与生产环境隔离）

#### 3.2.3 配置文件设置

1. 创建测试环境配置文件
2. 设置适当的API端点和环境变量
3. 配置日志级别为详细（DEBUG模式）

#### 3.2.4 自动化测试配置

1. 配置Jest测试环境
2. 设置CI/CD管道用于自动测试
3. 配置测试报告生成

## 4. 生产环境部署

### 4.1 生产环境要求

#### 4.1.1 服务器配置

- **操作系统**：Windows Server 2019或更高版本
- **内存**：至少16GB RAM
- **硬盘**：SSD存储，至少100GB可用空间
- **处理器**：多核处理器，至少4核
- **网络**：高带宽、低延迟的网络连接

#### 4.1.2 安全要求

- 配置防火墙规则
- 启用HTTPS
- 定期备份
- 防病毒和入侵检测系统

### 4.2 生产环境部署流程

#### 4.2.1 环境准备

1. 安装必要的服务器软件
2. 配置网络和安全设置
3. 创建专用的服务账户

#### 4.2.2 应用部署

1. 从Git仓库拉取最新稳定版本
   ```bash
   git clone https://github.com/sutchan/SutWxApp.git
   cd SutWxApp
   git checkout main  # 或特定版本标签
   ```

2. 安装依赖
   ```bash
   npm install --production
   ```

3. 构建应用（如需要）
   ```bash
   npm run build
   ```

#### 4.2.3 配置文件设置

1. 创建生产环境配置文件
2. 设置生产环境API端点
3. 配置适当的日志级别
4. 设置安全相关配置

#### 4.2.4 部署验证

1. 启动应用服务
2. 进行基本功能测试
3. 监控系统性能和错误日志

## 5. 微信小程序发布配置

### 5.1 微信公众平台设置

1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入小程序管理后台
3. 配置基本信息和功能设置
4. 设置服务器域名（request合法域名、socket合法域名等）

### 5.2 小程序发布流程

#### 5.2.1 代码上传

1. 在微信开发者工具中打开项目
2. 完成开发和测试
3. 点击"上传"按钮
4. 填写版本号和更新描述

#### 5.2.2 代码审核

1. 登录微信公众平台
2. 进入"开发管理"->"版本管理"
3. 提交审核新版本
4. 等待审核通过

#### 5.2.3 正式发布

1. 审核通过后，进入"开发管理"->"版本管理"
2. 选择已审核通过的版本
3. 点击"发布"按钮
4. 设置发布范围（全量发布或分阶段发布）

## 6. 环境变量配置

### 6.1 开发环境变量

创建`.env.development`文件，包含以下内容：

```env
# 环境标识
NODE_ENV=development

# API配置
API_BASE_URL=http://dev-api.example.com
API_TIMEOUT=10000

# 微信小程序配置
APP_ID=wx1234567890abcdef
APP_SECRET=abcdef1234567890abcdef1234567890

# 日志配置
LOG_LEVEL=debug
LOG_OUTPUT=console

# 其他配置
DEBUG=true
```

### 6.2 测试环境变量

创建`.env.test`文件，包含以下内容：

```env
# 环境标识
NODE_ENV=test

# API配置
API_BASE_URL=http://test-api.example.com
API_TIMEOUT=10000

# 微信小程序配置
APP_ID=wx1234567890abcdef
APP_SECRET=abcdef1234567890abcdef1234567890

# 日志配置
LOG_LEVEL=info
LOG_OUTPUT=file
LOG_FILE=logs/test.log

# 其他配置
DEBUG=false
```

### 6.3 生产环境变量

创建`.env.production`文件，包含以下内容：

```env
# 环境标识
NODE_ENV=production

# API配置
API_BASE_URL=https://api.example.com
API_TIMEOUT=15000

# 微信小程序配置
APP_ID=wx1234567890abcdef
APP_SECRET=abcdef1234567890abcdef1234567890

# 日志配置
LOG_LEVEL=error
LOG_OUTPUT=file
LOG_FILE=logs/production.log

# 其他配置
DEBUG=false
```

## 7. 常见问题与解决方案

### 7.1 依赖安装失败

**问题**：npm install 安装依赖失败

**解决方案**：
- 检查网络连接
- 尝试使用npm镜像：`npm config set registry https://registry.npm.taobao.org`
- 删除node_modules目录和package-lock.json文件，重新安装
- 以管理员权限运行命令提示符

### 7.2 微信开发者工具问题

**问题**：微信开发者工具无法正常启动或扫码登录失败

**解决方案**：
- 确保网络连接正常
- 检查防火墙设置，允许微信开发者工具访问网络
- 更新到最新版本的开发者工具
- 清除缓存后重试

### 7.3 环境变量不生效

**问题**：配置的环境变量未正确加载

**解决方案**：
- 检查.env文件的命名和路径是否正确
- 确保变量名称没有拼写错误
- 重启应用服务使环境变量生效
- 检查是否有其他地方覆盖了环境变量设置

### 7.4 发布审核不通过

**问题**：小程序审核被驳回

**解决方案**：
- 仔细阅读审核反馈，修复相关问题
- 确保所有功能符合微信小程序规范
- 提供必要的资质证明材料
- 检查内容是否符合法律法规要求

## 8. 安全注意事项

### 8.1 配置文件安全

- 不要在代码仓库中存储敏感配置信息
- 使用环境变量或独立配置文件管理敏感信息
- 确保生产环境配置文件有适当的访问权限

### 8.2 数据库安全

- 使用强密码
- 限制数据库访问IP
- 定期备份数据库
- 使用参数化查询防止SQL注入

### 8.3 网络安全

- 所有API请求使用HTTPS
- 设置适当的CORS策略
- 实现请求频率限制
- 配置适当的防火墙规则

## 9. 附录

### 9.1 推荐的开发工具

- **微信开发者工具**：小程序开发和调试
- **VS Code**：代码编辑
- **Git GUI客户端**：如SourceTree、GitKraken等
- **Postman**：API测试
- **Notepad++**：文本编辑

### 9.2 相关文档链接

- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [Node.js官方文档](https://nodejs.org/en/docs/)
- [Git官方文档](https://git-scm.com/doc)
- [微信公众平台](https://mp.weixin.qq.com/)

---

**版本号：1.0.16**
*最后更新时间：2024年11月1日*
