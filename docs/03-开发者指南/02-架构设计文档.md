<!--
文件名: 02-架构设计文档.md
版本号: 1.0.0
更新日期: 2025-11-24
作者: Sut
描述: 架构设计文档，详细说明小程序的整体架构、技术选型和模块划分
-->
# 架构设计文档

## 1. 概述

本文档旨在描述 SutWxApp 微信小程序的整体架构设计，包括系统分层、模块划分、技术选型以及主要组件之间的交互关系。

## 2. 系统分层

SutWxApp 采用典型的三层架构设计：

1.  **表现层 (Presentation Layer)**：负责用户界面的展示和用户交互逻辑。主要包括小程序页面 (Pages) 和自定义组件 (Components)。
2.  **服务层 (Service Layer)**：负责业务逻辑处理、数据请求和数据处理。主要包括 `services` 目录下的各种服务模块。
3.  **数据层 (Data Layer)**：负责数据的存储和获取。主要通过服务层调用后端 API 或本地缓存进行数据操作。

## 3. 模块划分

项目根据功能和职责划分为以下主要模块：

- **`app.js`, `app.json`, `app.wxss`**: 小程序入口文件，负责全局配置、样式和生命周期管理。
- **`assets/`**: 静态资源目录，存放图片、字体等。
- **`components/`**: 自定义组件目录，存放可复用的 UI 组件，如 `lazyImage`。
- **`images/`**: 图片文件目录。
- **`pages/`**: 页面目录，按功能模块划分，如 `article` (文章), `user` (用户), `order` (订单) 等。
- **`services/`**: 服务层目录，存放业务逻辑和 API 调用封装，如 `userService.js`, `cartService.js`。
- **`tests/`**: 测试文件目录，存放单元测试和集成测试。
- **`utils/`**: 工具类目录，存放通用工具函数和辅助类，如 `i18n.js`, `cache-service.js`。

## 4. 技术选型

- **开发框架**：微信小程序原生框架
- **语言**：JavaScript (ES6+)
- **样式**：WXSS (基于 CSS)
- **模板**：WXML (基于 XML)
- **状态管理**：小程序内置 `setData` 及自定义数据管理方案
- **网络请求**：微信小程序 `wx.request` API 封装
- **国际化**：自定义 `i18n.js` 工具类

## 5. 主要组件交互

### 5.1 页面与服务层

页面通过调用服务层的方法来获取数据和执行业务逻辑。例如，用户页面可能调用 `userService.js` 来获取用户信息。

```javascript
// pages/user/index.js
import { getUserInfo } from '../../services/userService';

Page({
  data: {
    userInfo: null
  },
  onLoad() {
    getUserInfo().then(res => {
      this.setData({
        userInfo: res.data
      });
    });
  }
});
```

### 5.2 组件与页面

自定义组件通过 `properties` 接收父页面传递的数据，通过 `triggerEvent` 向父页面发送事件。

```xml
<!-- components/myComponent/myComponent.wxml -->
<view>
  <text>{{title}}</text>
  <button bindtap="_onTap">点击</button>
</view>
```

```javascript
// components/myComponent/myComponent.js
Component({
  properties: {
    title: String
  },
  methods: {
    _onTap() {
      this.triggerEvent('myEvent', { value: 'hello' });
    }
  }
});
```

### 5.3 国际化 (i18n)

`i18n.js` 工具类负责管理多语言文本。页面和组件通过数据绑定或直接调用 `i18n.translate` 方法来获取翻译文本。

```xml
<!-- pages/example/example.wxml -->
<text>{{i18n.welcomeMessage}}</text>
```

```javascript
// pages/example/example.js
import { I18n } from '../../utils/i18n';

Page({
  data: {
    i18n: I18n
  },
  onLoad() {
    // ...
  }
});
```

## 6. 数据流

用户操作 -> 表现层 (页面/组件) -> 服务层 (业务逻辑/API 调用) -> 数据层 (后端 API/本地缓存) -> 数据返回 -> 服务层处理 -> 表现层更新

## 7. 错误处理

项目采用统一的错误处理机制，服务层对 API 请求进行封装，捕获错误并进行统一处理。页面和组件通过 `try-catch` 捕获异步操作的错误，并向用户提供友好的提示。

## 8. 性能优化

*   **图片懒加载**：通过 `lazyImage` 组件实现。
*   **缓存机制**：通过 `cache-service.js` 实现数据缓存。
*   **节流与防抖**：在事件处理中应用节流和防抖技术。

## 9. 安全考虑

*   **敏感信息保护**：不硬编码 API 密钥和敏感信息。
*   **身份认证**：使用 Bearer Token 进行身份认证，Token 存储在本地缓存中。
*   **HTTPS**：所有网络请求强制使用 HTTPS。

## 10. 总结

SutWxApp 的架构设计旨在提供一个可维护、可扩展、高性能和安全的微信小程序应用。通过清晰的分层和模块划分，以及合理的技术选型，确保了项目的长期健康发展。
