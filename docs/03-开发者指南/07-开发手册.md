<!--
文件名: 05-开发手册.md
版本号: 1.0.0
更新日期: 2025-11-24
作者: Sut
描述: 开发手册，提供小程序开发的详细步骤、功能实现方法和常见问题解答
-->
# SutWxApp 开发手册

## 1. 项目概述

### 1.1 项目简介

**SutWxApp** 是一款微信小程序应用，旨在为用户提供便捷的服务体验。本开发手册提供了项目开发过程中的各项规范、流程和最佳实践，所有参与项目开发的人员都应严格遵循。

### 1.2 项目地址

- **GitHub 仓库**：https://github.com/sutchan
- **默认署名**：Sut

## 2. 开发环境设置

### 2.1 环境要求

- **操作系统**：Windows 10/11
- **微信开发者工具**：最新稳定版
- **Node.js**：16.x 或更高版本
- **npm**：8.x 或更高版本
- **Git**：最新稳定版
- **代码编辑器**：VSCode（推荐）

### 2.2 开发工具安装

#### 2.2.1 微信开发者工具

1. 访问 [微信开发者工具官方下载页面](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 下载并安装适合 Windows 的最新版本
3. 完成安装后，使用微信扫码登录

#### 2.2.2 Node.js 和 npm

1. 访问 [Node.js 官方下载页面](https://nodejs.org/zh-cn/)
2. 下载并安装 LTS 版本（推荐 16.x）
3. 安装完成后，在命令行中验证
   ```bash
   node -v
   npm -v
   ```

#### 2.2.3 Git

1. 访问 [Git 官方下载页面](https://git-scm.com/downloads)
2. 下载并安装适合 Windows 的最新版本
3. 安装完成后，在命令行中验证
   ```bash
   git --version
   ```

#### 2.2.4 VSCode

1. 访问 [VSCode 官方下载页面](https://code.visualstudio.com/)
2. 下载并安装适合 Windows 的最新版本
3. 推荐安装的扩展：
   - 微信小程序扩展
   - ESLint
   - Prettier
   - GitLens
   - Chinese (Simplified) Language Pack

### 2.3 项目初始化

1. **克隆仓库**
   ```bash
   git clone https://github.com/sutchan/SutWxApp.git
   cd SutWxApp
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **配置开发环境**
   - 复制配置文件模板（如果有）
   - 根据需要修改环境变量配置

4. **在微信开发者工具中导入项目**
   - 打开微信开发者工具
   - 点击「导入项目」
   - 选择项目根目录
   - 填写 AppID（如果有）或选择「测试号」

## 3. 代码规范

### 3.1 基础规范

#### 3.1.1 编码格式

- **字符编码**：UTF-8 无 BOM
- **换行符**：Unix LF
- **缩进**：使用 2 个空格
- **行宽**：每行代码不超过 100 个字符
- **文件结尾**：添加空行

#### 3.1.2 命名规范

- **变量名**：使用小驼峰命名法，如 `userInfo`
- **函数名**：使用小驼峰命名法，如 `getUserInfo()`
- **类名**：使用大驼峰命名法，如 `UserManager`
- **常量名**：使用全大写字母，单词间用下划线分隔，如 `MAX_RETRY_COUNT`
- **文件名**：
  - 页面文件：使用小驼峰命名法，如 `pointsTasks.js`
  - 组件文件：使用小驼峰命名法，如 `lazyImage.js`
  - 服务文件：使用小驼峰命名法，如 `userService.js`
  - 测试文件：使用小驼峰命名法，后缀为 `.test.js`，如 `pointsTasks.test.js`

#### 3.1.3 注释规范

- **文件头部**：包含文件描述、作者、创建日期等信息
- **函数注释**：每个函数必须添加函数级注释，说明功能、参数、返回值
- **代码注释**：复杂逻辑添加行内注释
- **注释语言**：使用中文编写注释

```javascript
/**
 * 文件名: 05-开发手册.md
 * 版本号: 1.0.0
 * 更新日期: 2025-11-24
 * 作者: Sut
 * 描述: 开发手册，提供小程序开发的详细步骤、功能实现方法和常见问题解答
 * 获取用户积分任务列表
 * @param {Object} options - 查询参数
 * @param {string} options.type - 任务类型：all/once/daily/weekly/monthly
 * @param {string} options.status - 任务状态：all/pending/completed/unclaimed
 * @param {number} options.page - 页码，默认为1
 * @param {number} options.pageSize - 每页数量，默认为20
 * @returns {Promise<Object>} 任务列表和分页信息
 */
async function getPointsTasks(options = {}) {
  // 实现逻辑
}
```

### 3.2 JavaScript 规范

#### 3.2.1 语法规范

- **变量声明**：优先使用 `const`，其次使用 `let`，避免使用 `var`
- **函数声明**：优先使用箭头函数，除非需要使用 `this` 绑定
- **模板字符串**：使用模板字符串代替字符串拼接
- **解构赋值**：使用解构赋值简化代码
- **展开运算符**：使用展开运算符处理数组和对象

#### 3.2.2 代码组织

- **模块化**：使用 ES6 模块化语法（import/export）
- **函数设计**：遵循单一职责原则，保持函数简短
- **错误处理**：使用 try-catch 处理可能的错误
- **异步处理**：使用 async/await 处理异步操作

#### 3.2.3 代码示例

```javascript
// 变量声明
const API_BASE_URL = 'https://api.example.com';
let currentPage = 1;

// 箭头函数
const fetchData = async (url, params = {}) => {
  try {
    const response = await wx.request({
      url,
      method: 'GET',
      data: params
    });
    
    return response.data;
  } catch (error) {
    console.error('请求失败:', error);
    throw error;
  }
};

// 解构赋值
const { data, statusCode } = await fetchData('/api/products');

// 展开运算符
const updatedProduct = {
  ...product,
  price: product.price * 0.9,
  updatedAt: new Date().toISOString()
};
```

- 使用 `const` 和 `let`，避免使用 `var`
- 使用箭头函数简化回调函数
- 使用模板字符串代替字符串拼接
- 使用解构赋值简化变量声明
- 使用展开运算符简化对象和数组操作
- 避免使用全局变量
- 使用 `===` 和 `!==` 进行比较
- 避免使用 `eval()` 和 `with`

### 3.3 WXML 规范

#### 3.3.1 语法规范

- **标签名**：使用小写字母
- **属性名**：使用短横线命名法，如 `bindtap`
- **组件命名**：使用小驼峰命名法
- **属性值**：使用双引号包裹

#### 3.3.2 代码组织

- **条件渲染**：使用 `wx:if` 和 `wx:else` 进行条件渲染
- **列表渲染**：使用 `wx:for` 进行列表渲染，添加 `wx:key` 提高性能
- **嵌套层级**：减少不必要的嵌套层级
- **复杂计算**：避免在 WXML 中进行复杂计算

#### 3.3.3 代码示例

```xml
<!-- 条件渲染 -->
<view wx:if="{{isLoggedIn}}" class="user-info">
  <text>{{userInfo.nickName}}</text>
</view>
<view wx:else class="login-prompt">
  <button bindtap="handleLogin">请登录</button>
</view>

<!-- 列表渲染 -->
<view class="product-list">
  <view 
    wx:for="{{products}}" 
    wx:key="id" 
    class="product-item"
    data-id="{{item.id}}"
    bindtap="handleProductTap"
  >
    <image src="{{item.imageUrl}}" mode="aspectFill"></image>
    <text class="product-name">{{item.name}}</text>
    <text class="product-price">¥{{item.price}}</text>
  </view>
</view>

<!-- 组件使用 -->
<custom-navbar 
  title="{{pageTitle}}" 
  background-color="{{navBgColor}}"
  bindback="handleNavBack"
/>
```

### 3.4 WXSS 规范

#### 3.4.1 语法规范

- **选择器**：避免过深嵌套，一般不超过3层
- **样式命名**：使用 BEM 规范（Block-Element-Modifier）
- **单位**：使用 rpx 适配不同屏幕尺寸
- **布局**：使用 flexbox 进行布局
- **优先级**：避免使用 !important

#### 3.4.2 代码组织

- **组件样式**：使用 `:host` 选择器定义组件样式
- **全局样式**：在 app.wxss 中定义全局样式
- **页面样式**：在页面目录的 wxss 文件中定义页面特定样式
- **样式复用**：使用样式类提高复用性

#### 3.4.3 代码示例

```css
/* BEM 命名规范示例 */
.product-list {
  display: flex;
  flex-wrap: wrap;
  padding: 20rpx;
}

.product-list__item {
  width: 345rpx;
  margin-bottom: 20rpx;
  border-radius: 8rpx;
  overflow: hidden;
}

.product-list__item--featured {
  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);
}

.product-list__image {
  width: 100%;
  height: 200rpx;
}

.product-list__info {
  padding: 16rpx;
}

.product-list__title {
  font-size: 28rpx;
  color: #333;
  margin-bottom: 8rpx;
}

.product-list__price {
  font-size: 32rpx;
  color: #e74c3c;
  font-weight: bold;
}

/* 组件样式 */
:host {
  display: block;
}

:host .title {
  font-size: 32rpx;
  font-weight: bold;
}

/* 响应式设计 */
.container {
  width: 100%;
  padding: 20rpx;
  box-sizing: border-box;
}

@media (min-width: 768px) {
  .container {
    max-width: 750px;
    margin: 0 auto;
  }
}
```

### 3.5 JSON 配置规范

#### 3.5.1 语法规范

- **引号**：使用双引号包裹键名和字符串值
- **键名**：使用小驼峰命名法
- **缩进**：保持一致的缩进，使用2个空格
- **注释**：使用 // 或 /* */ 添加注释
- **末尾**：对象或数组最后一个元素后不加逗号

#### 3.5.2 配置组织

- **功能分组**：按照功能对配置项进行分组
- **顺序**：按照重要性或逻辑顺序排列配置项
- **描述**：为复杂配置项添加描述性注释

#### 3.5.3 代码示例

```json
{
  // 页面配置
  "pages": [
    "pages/index/index",
    "pages/category/category",
    "pages/cart/cart",
    "pages/user/user"
  ],
  
  // 全局窗口配置
  "window": {
    "navigationBarBackgroundColor": "#ffffff",
    "navigationBarTitleText": "苏特商城",
    "navigationBarTextStyle": "black",
    "backgroundColor": "#f8f8f8",
    "backgroundTextStyle": "light"
  },
  
  // 底部导航栏配置
  "tabBar": {
    "color": "#999999",
    "selectedColor": "#e74c3c",
    "backgroundColor": "#ffffff",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页",
        "iconPath": "images/tab/home.png",
        "selectedIconPath": "images/tab/home-active.png"
      },
      {
        "pagePath": "pages/category/category",
        "text": "分类",
        "iconPath": "images/tab/category.png",
        "selectedIconPath": "images/tab/category-active.png"
      },
      {
        "pagePath": "pages/user/user",
        "text": "我的",
        "iconPath": "images/tab/user.png",
        "selectedIconPath": "images/tab/user-active.png"
      }
    ]
  },
  
  // 网络超时配置
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000,
    "uploadFile": 10000,
    "connectSocket": 10000
  },
  
  // 调试配置
  "debug": false,
  
  // 其他配置
  "sitemapLocation": "sitemap.json"
}
```

## 4. 开发流程

### 4.1 开发前准备

1. **需求理解**：详细阅读需求文档，理解功能要求
2. **技术方案**：制定详细的技术实现方案
3. **任务分解**：将功能拆分为可管理的小任务
4. **代码规划**：规划代码结构和文件组织

### 4.2 开发实施

1. **创建分支**：从 `develop` 分支创建功能分支
   ```bash
   git checkout develop
   git pull
   git checkout -b feature/feature-name
   ```

2. **编码实现**：按照代码规范进行开发
3. **单元测试**：为关键功能编写单元测试
4. **本地测试**：在微信开发者工具中进行本地测试
5. **真机调试**：在实际设备上进行测试

### 4.3 代码提交

1. **代码检查**：使用 eslint 等工具检查代码质量
2. **提交准备**：
   ```bash
   git add .
   git status  # 检查将要提交的文件
   ```

3. **提交代码**：使用语义化的提交信息
   ```bash
   git commit -m "feat(module): 功能描述"
   ```

   提交类型前缀：
   - `feat`：新功能
   - `fix`：修复 bug
   - `docs`：文档修改
   - `style`：代码风格调整
   - `refactor`：代码重构
   - `test`：测试相关
   - `chore`：构建过程或辅助工具变动

### 4.4 代码审查

1. **推送代码**：推送到远程仓库
   ```bash
   git push origin feature/feature-name
   ```

2. **创建 Pull Request**：在 GitHub 上创建 PR
3. **等待审查**：团队成员进行代码审查
4. **修复问题**：根据审查意见修复代码问题
5. **合并代码**：审查通过后，将代码合并到 `develop` 分支

### 4.5 版本发布

1. **创建发布分支**：从 `develop` 分支创建发布分支
   ```bash
   git checkout develop
   git pull
   git checkout -b release/v1.0.0
   ```

2. **版本准备**：
   - 更新版本号
   - 更新 CHANGELOG
   - 进行最终测试

3. **合并发布分支**：将发布分支合并到 `main` 和 `develop` 分支
   ```bash
   git checkout main
   git merge --no-ff release/v1.0.0
   git tag v1.0.0
   git checkout develop
   git merge --no-ff release/v1.0.0
   ```

4. **推送变更**：
   ```bash
   git push origin main
   git push origin develop
   git push origin --tags
   ```

## 5. 版本控制

### 5.1 分支策略

- **main/master**：主分支，稳定版本，只接受来自 release 分支的合并
- **develop**：开发分支，包含最新的开发成果
- **feature/\***：功能分支，从 develop 分支创建，完成后合并回 develop
- **release/\***：发布分支，从 develop 分支创建，完成后合并回 main 和 develop
- **hotfix/\***：修复分支，从 main 分支创建，完成后合并回 main 和 develop

### 5.2 版本号规范

采用语义化版本规范（SemVer）：MAJOR.MINOR.PATCH

- **MAJOR**：不兼容的破坏性变更
- **MINOR**：向下兼容的新功能
- **PATCH**：向下兼容的问题修复

## 6. 测试规范

### 6.1 测试类型

- **单元测试**：测试单个函数或组件
- **集成测试**：测试多个组件或模块的交互
- **端到端测试**：模拟真实用户操作的测试

### 6.2 测试工具

- **单元测试**：Jest
- **E2E 测试**：微信小程序提供的测试工具
- **性能测试**：微信开发者工具性能分析

### 6.3 测试流程

1. 开发人员编写单元测试
2. 提交代码前运行测试
3. CI/CD 流程自动运行测试
4. 手动进行功能测试
5. 进行性能测试和优化

## 7. 文档规范

### 7.1 文档类型

- **技术文档**：架构设计、API 接口、开发规范等
- **用户文档**：用户指南、功能说明等
- **部署文档**：环境配置、部署流程等
- **变更文档**：更新日志、版本说明等

### 7.2 文档格式

- **格式**：Markdown
- **编码**：UTF-8 无 BOM
- **命名**：使用中文命名，清晰表达文档内容
- **存储**：放在 `docs/` 目录下

### 7.3 文档更新

- 代码变更时同步更新相关文档
- 版本发布前更新文档
- 定期审查和优化文档

## 8. 常见问题解决

### 8.1 开发环境问题

**问题**：npm install 失败
**解决方法**：
- 检查网络连接
- 清除 npm 缓存：`npm cache clean --force`
- 使用 npm 镜像：`npm install --registry=https://registry.npmmirror.com`

**问题**：微信开发者工具无法识别项目
**解决方法**：
- 确保项目结构符合微信小程序规范
- 检查 project.config.json 配置文件
- 重启微信开发者工具

### 8.2 代码问题

**问题**：页面白屏
**解决方法**：
- 检查控制台错误信息
- 检查 WXML 和 JavaScript 代码
- 确保数据正确初始化

**问题**：组件不显示
**解决方法**：
- 检查组件是否正确导入
- 检查组件命名和路径
- 检查组件配置是否正确

### 8.3 网络问题

**问题**：API 请求失败
**解决方法**：
- 检查网络连接
- 检查请求地址和参数
- 检查服务器状态
- 检查域名是否在小程序管理后台配置

**问题**：图片加载失败
**解决方法**：
- 检查图片地址是否正确
- 检查图片域名是否在小程序管理后台配置
- 使用 CDN 加速图片加载

## 9. 项目结构

### 9.1 目录结构

```
SutWxApp/
├── app.js              # 小程序入口文件
├── app.json            # 全局配置
├── app.wxss            # 全局样式
├── assets/             # 静态资源
│   └── images/         # 图片资源
├── components/         # 自定义组件
├── images/             # 图片文件
├── pages/              # 页面文件
│   ├── article/        # 文章相关页面
│   ├── user/           # 用户相关页面
│   └── ...             # 其他功能模块页面
├── services/           # 服务层
├── tests/              # 测试文件
├── utils/              # 工具类
└── docs/               # 项目文档
```

### 9.2 文件组织规范

- 按功能模块组织文件
- 组件化开发，提高代码复用性
- 遵循高内聚低耦合原则
- 避免重复代码

## 10. 性能优化

### 10.1 页面加载优化

- 使用页面预加载
- 组件按需加载
- 减少首屏渲染内容
- 图片懒加载

### 10.2 数据处理优化

- 使用合适的数据结构
- 避免频繁的数据更新
- 缓存常用数据
- 数据分页加载

### 10.3 网络请求优化

- 减少网络请求次数
- 请求合并和批量处理
- 使用缓存减少重复请求
- 合理设置请求超时

### 10.4 渲染优化

- 减少不必要的渲染
- 使用虚拟列表处理长列表
- 优化样式选择器
- 避免在渲染过程中进行复杂计算

## 11. 安全规范

### 11.1 数据安全

- 敏感信息加密存储
- 接口数据传输加密
- 避免在代码中硬编码敏感信息
- 定期进行安全审计

### 11.2 接口安全

- 实现接口鉴权
- 防止 SQL 注入
- 防止 XSS 攻击
- 实现接口频率限制

### 11.3 用户数据保护

- 遵循隐私政策
- 最小权限原则
- 数据脱敏处理
- 用户数据备份和恢复

## 12. 发布流程

### 12.1 发布前准备

1. **功能验证**：确保所有功能正常运行
2. **性能测试**：进行性能测试和优化
3. **兼容性测试**：在不同设备上进行测试
4. **安全审查**：进行安全审查和渗透测试

### 12.2 发布步骤

1. **提交审核**：在微信开发者工具中提交代码审核
2. **审核通过**：等待微信官方审核通过
3. **发布版本**：审核通过后，发布正式版本
4. **版本更新**：更新小程序版本号和更新日志

### 12.3 发布后监控

1. **数据分析**：收集和分析用户行为数据
2. **问题反馈**：收集用户反馈和问题报告
3. **性能监控**：监控小程序性能指标
4. **紧急修复**：如需紧急修复，准备热修复方案

## 13. 团队协作

### 13.1 沟通协作

- **代码审查**：互相审查代码，提高代码质量
- **定期会议**：定期召开团队会议，同步进展和解决问题
- **文档共享**：使用共享文档记录重要决策和信息
- **问题跟踪**：使用项目管理工具跟踪任务和问题

### 13.2 协作工具

- **代码托管**：GitHub
- **项目管理**：根据团队选择适合的工具
- **即时通讯**：根据团队选择适合的通讯工具
- **文档协作**：根据团队选择适合的文档工具

## 14. 附录

### 14.1 开发工具快捷键

| 功能 | 快捷键 |
|------|--------|
| 格式化代码 | Shift + Alt + F |
| 查找文件 | Ctrl + P |
| 查找符号 | Ctrl + Shift + O |
| 行注释 | Ctrl + / |
| 块注释 | Shift + Alt + A |
| 复制行 | Shift + Alt + 向下箭头 |
| 移动行 | Alt + 向上/向下箭头 |
| 折叠代码 | Ctrl + Shift + [ |
| 展开代码 | Ctrl + Shift + ] |

### 14.2 推荐开发实践

- 保持代码简洁明了
- 遵循单一职责原则
- 编写可测试的代码
- 注重代码的可扩展性和可维护性
- 定期学习新技术和最佳实践
- 参与社区交流，分享经验

---

*本文档将根据项目需求和最佳实践不断更新*
