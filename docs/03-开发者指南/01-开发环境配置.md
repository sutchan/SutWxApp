# SutWxApp 开发环境配置指南

## 环境要求

### 1. 操作系统

- **Windows**: 推荐 Windows 10 或 Windows 11
- **最低配置**: 4GB RAM，2GHz 处理器，50GB 可用磁盘空间
- **推荐配置**: 8GB RAM 以上，i5 处理器以上，SSD 存储

### 2. 开发账号

- **微信公众平台账号**: 需要注册微信小程序开发账号
- **GitHub 账号**: 用于代码托管和协作

## 开发工具安装

### 1. 微信开发者工具

#### 1.1 下载安装

1. 访问 [微信开发者工具官方下载页面](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 根据操作系统选择对应的版本下载
3. 运行安装程序，按照提示完成安装

#### 1.2 首次配置

1. 启动微信开发者工具
2. 使用微信扫码登录
3. 选择 "小程序项目"
4. 填写项目信息：
   - 项目名称：SutWxApp
   - 目录：选择本地项目根目录
   - AppID：从微信公众平台获取
   - 开发模式：小程序
   - 后端服务：不使用云开发（根据实际需求选择）
5. 点击 "新建"

#### 1.3 工具设置

1. 打开设置（左上角菜单 -> 设置）
2. 通用设置：
   - 编辑器设置：选择适合的主题和字体
   - 自动保存：建议开启
   - 编译设置：按需配置
3. 外观设置：选择适合的界面主题
4. 代理设置：根据网络环境配置

### 2. 代码编辑器（可选）

如果您更习惯使用 VSCode 等编辑器，可以按以下步骤配置：

#### 2.1 VSCode 安装与配置

1. 下载并安装 [VSCode](https://code.visualstudio.com/)
2. 安装推荐插件：
   - Chinese (Simplified) Language Pack for VS Code
   - ESLint
   - Prettier - Code formatter
   - WeChat Miniprogram (可选，提供小程序相关功能)
3. 配置 settings.json：
   ```json
   {
     "editor.tabSize": 2,
     "editor.formatOnSave": true,
     "eslint.validate": [
       "javascript",
       "javascriptreact",
       "html"
     ],
     "files.eol": "\n",
     "files.encoding": "utf8"
   }
   ```

### 3. Git 版本控制

#### 3.1 Git 安装

1. 下载并安装 [Git](https://git-scm.com/downloads)
2. 安装完成后，在命令行运行以下命令验证：
   ```bash
   git --version
   ```

#### 3.2 Git 配置

1. 配置用户名和邮箱：
   ```bash
   git config --global user.name "Your Name"
   git config --global user.email "your.email@example.com"
   ```
2. 生成 SSH 密钥（推荐使用）：
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your.email@example.com"
   ```
3. 将生成的公钥添加到 GitHub 账号

## 项目初始化

### 1. 克隆项目

1. 打开命令行工具
2. 导航到您想要存放项目的目录
3. 克隆项目仓库：
   ```bash
   git clone https://github.com/sutchan/SutWxApp.git
   cd SutWxApp
   ```

### 2. 安装依赖

1. 项目依赖管理（如果使用 npm）：
   ```bash
   npm install
   ```

### 3. 配置文件设置

1. 检查并配置以下文件：
   - `project.config.json`：确保 AppID 和其他配置正确
   - `.gitignore`：确保忽略不必要的文件

## 构建与部署

### 1. 构建工具

项目目前主要依赖微信开发者工具进行构建。对于更复杂的自动化需求，可以考虑引入以下工具：

*   **Webpack/Gulp**：虽然小程序原生开发通常不直接使用这些工具，但可以通过插件或自定义脚本集成，用于处理图片压缩、代码混淆、资源预处理等。
*   **Miniprogram-ci**：微信官方提供的持续集成工具，可用于自动化上传、预览和发布小程序。

### 2. 自动化构建流程

建议配置自动化构建流程，以提高开发效率和发布质量：

1.  **代码检查**：在提交代码前运行 ESLint 检查，确保代码符合规范。
2.  **单元测试**：运行 Jest 单元测试，确保核心逻辑的正确性。
3.  **代码压缩与优化**：在生产环境构建时，自动进行 WXML、WXSS、JS 文件的压缩，以及图片等资源的优化。
4.  **版本管理**：自动化更新版本号，并生成 `CHANGELOG.md`。
5.  **自动化上传**：通过 `miniprogram-ci` 实现代码的自动化上传和发布。

### 3. 代码压缩与资源优化

*   **WXML/WXSS/JS 压缩**：微信开发者工具在上传时会自动进行部分压缩。对于更高级的压缩需求，可以集成第三方工具。
*   **图片优化**：使用图片压缩工具（如 TinyPNG、ImageOptim）对图片进行压缩，并考虑使用 WebP 格式。
*   **分包加载**：对于大型小程序，合理使用分包加载可以减少首次启动时间。

## 测试环境配置

### 1. 单元测试

项目已集成 Jest 进行单元测试。运行测试的命令：

```bash
npm test
```

### 2. 集成测试

对于集成测试，建议在微信开发者工具中进行模拟器测试和真机预览，确保不同模块之间的协作正常。

### 3. 端到端测试 (E2E)

对于端到端测试，可以考虑使用以下工具：

*   **Miniprogram-automator**：微信官方提供的自动化测试框架，可以模拟用户操作，进行 UI 自动化测试。
*   **Cypress/Puppeteer**：虽然主要用于 Web，但可以通过模拟器或真机调试环境进行部分 E2E 测试。

### 4. 测试覆盖率

建议配置代码覆盖率工具（如 Istanbul/nyc），并在 CI/CD 流程中强制要求达到一定的覆盖率标准。

### 5. 持续集成 (CI)

集成 CI 工具（如 Jenkins, GitHub Actions, GitLab CI/CD）可以自动化执行代码检查、测试和构建部署流程，确保代码质量和发布效率。

## 编辑器配置

### 1. ESLint 配置

1. 项目已配置 ESLint，用于代码质量检查
2. 规则配置位于 `.eslintrc.js` 文件
3. 推荐在编辑器中安装 ESLint 插件以获得实时反馈

### 2. 代码规范

1. 缩进：使用 2 个空格
2. 行长度：每行不超过 100 个字符
3. 文件编码：UTF-8 无 BOM
4. 换行符：Unix LF

## 多环境配置

### 1. 环境变量设置

项目支持以下环境配置：

- **开发环境**：用于日常开发和测试
- **测试环境**：用于集成测试和验收测试

### 2. 配置方式

建议通过以下方式管理不同环境的配置：

1.  **环境变量**：在构建或运行项目时，通过设置环境变量（如 `NODE_ENV`）来区分当前环境。
2.  **配置文件**：创建不同的配置文件（如 `config.dev.js`, `config.prod.js`），在代码中根据环境变量动态加载。

## 网络与安全

### 1. 网络请求

1.  **HTTPS 强制**：所有网络请求必须使用 HTTPS 协议，确保数据传输安全。
2.  **域名白名单**：在微信公众平台配置合法域名，小程序只能向白名单中的域名发起网络请求。
3.  **请求超时**：合理设置请求超时时间，避免长时间等待。
4.  **错误处理**：对网络请求的成功和失败进行统一处理，提供友好的用户反馈。

### 2. 安全策略

1.  **敏感信息保护**：
    *   **禁止硬编码**：API 密钥、敏感配置等绝不能硬编码在代码中。
    *   **环境变量/配置管理**：通过环境变量或安全的配置服务管理敏感信息。
    *   **本地存储加密**：对于必须在本地存储的敏感数据，应进行加密处理。
2.  **用户数据保护**：
    *   **授权机制**：获取用户敏感信息（如地理位置、用户信息）前，必须明确告知用户并获得授权。
    *   **数据脱敏**：在日志和分析中对用户敏感数据进行脱敏处理。
    *   **最小权限原则**：只请求必要的权限和数据。
3.  **代码安全**：
    *   **代码混淆/压缩**：生产环境代码进行混淆和压缩，增加逆向工程难度。
    *   **依赖项审计**：定期检查项目依赖项是否存在安全漏洞。
    *   **输入验证**：对所有用户输入进行严格的验证和过滤，防止 XSS、SQL 注入等攻击。
4.  **API 安全**：
    *   **鉴权机制**：使用 JWT、OAuth2 等标准鉴权机制保护 API 接口。
    *   **频率限制**：对 API 请求进行频率限制，防止恶意攻击和资源滥用。
    *   **数据加密**：对于敏感数据传输，考虑端到端加密。
    *   **日志审计**：记录关键 API 请求和响应，便于安全审计和问题追溯。

## 性能优化

### 1. 启动性能

1.  **分包加载**：将小程序代码按功能拆分成多个包，按需加载，减少首次启动时间。
2.  **预加载/预请求**：在用户可能访问的页面提前加载数据或资源。
3.  **首屏渲染优化**：减少首屏数据请求量，优化 WXML 结构，避免复杂计算。

### 2. 运行时性能

1.  **setData 优化**：
    *   **批量更新**：避免频繁调用 `setData`，尽量合并数据更新。
    *   **按需更新**：只更新需要改变的数据，避免更新整个 `data` 对象。
    *   **避免大数据量**：`setData` 传递的数据量不宜过大。
2.  **图片优化**：
    *   **懒加载**：使用 `lazy-image` 组件或小程序内置的图片懒加载功能。
    *   **适当尺寸**：根据显示需求提供合适尺寸的图片，避免加载过大图片。
    *   **WebP 格式**：优先使用 WebP 格式图片，减小图片体积。
3.  **组件化**：合理拆分组件，提高代码复用性和可维护性，减少不必要的渲染。
4.  **长列表优化**：对于长列表，使用虚拟列表等技术，只渲染可视区域内的列表项。
5.  **避免内存泄漏**：注意页面卸载时清除定时器、事件监听等。

### 3. 用户体验

1.  **骨架屏/加载动画**：在数据加载时显示骨架屏或加载动画，提升用户等待体验。
2.  **反馈机制**：提供清晰的加载、成功、失败等操作反馈。
3.  **离线缓存**：利用本地缓存存储不经常变动的数据，提升离线访问和加载速度。

## 附录

### 1. 常用命令

*   `npm install`：安装项目依赖
*   `npm test`：运行单元测试
*   `git clone [URL]`：克隆项目仓库
*   `git pull`：更新本地代码
*   `git push`：提交本地更改

### 2. 常见问题与解决方案

*   **Q: 微信开发者工具无法登录？**
    *   A: 检查网络连接，尝试重启开发者工具或更新到最新版本。
*   **Q: 小程序预览/上传失败？**
    *   A: 检查 `project.config.json` 中的 AppID 是否正确，确认网络连接正常，查看开发者工具的错误日志。
*   **Q: `wp i18n make-pot` 命令无法执行？**
    *   A: 确保已安装 PHP 并配置了环境变量。

---

**文档版本**：1.0.0
**最后更新**：2023-10-27
**作者**：Sut

- **生产环境**：正式上线环境

### 2. 配置切换方法

可以通过修改配置文件中的环境标志来切换不同环境：

```javascript
// config-service.js 中的环境配置示例
const env = {
  DEV: 'development',
  TEST: 'testing',
  PROD: 'production'
};

// 设置当前环境
const currentEnv = env.DEV;
```

## 真机调试

### 1. 启动真机调试

1. 在微信开发者工具中点击 "真机调试" 按钮
2. 选择调试设备类型（手机/平板）
3. 扫描生成的二维码
4. 在微信中打开小程序进行调试

### 2. 调试选项

- **调试基础库**：选择与生产环境兼容的版本
- **调试模式**：可以选择普通调试或性能调试
- **体验版**：可以部署体验版供测试人员使用

## 常见问题解决

### 1. 安装问题

- **微信开发者工具安装失败**：确保系统满足最低要求，关闭杀毒软件后重试
- **Git 命令无法执行**：检查 PATH 环境变量是否正确设置

### 2. 网络问题

- **无法访问 GitHub**：配置代理或使用 VPN
- **API 调用失败**：检查安全域名配置和网络连接

### 3. 编译问题

- **编译失败**：查看控制台错误信息，通常是语法错误或依赖问题
- **找不到模块**：检查模块路径和导入语句

### 4. 运行问题

- **真机运行异常**：检查基础库版本兼容性，查看控制台日志
- **性能问题**：使用性能调试工具分析瓶颈

## 开发工具快捷键

### 微信开发者工具常用快捷键

- **Ctrl + S**：保存文件
- **Ctrl + B**：编译项目
- **Ctrl + Shift + N**：新建文件
- **F5**：刷新预览
- **Alt + Shift + F**：格式化代码
- **Ctrl + Shift + H**：搜索

### VSCode 常用快捷键

- **Ctrl + P**：快速打开文件
- **Ctrl + Shift + P**：命令面板
- **F12**：跳转到定义
- **Alt + Shift + F**：格式化代码
- **Ctrl + Shift + L**：选择所有匹配项

## 推荐开发实践

### 1. 日常开发流程

1. 从主分支拉取最新代码
2. 创建新的功能分支
3. 完成开发并编写测试
4. 提交代码并创建 Pull Request
5. 代码审查通过后合并到主分支

### 2. 代码提交规范

- 提交信息应清晰描述变更内容
- 遵循 "类型: 描述" 的格式，如 "feat: 添加用户登录功能"
- 类型包括：feat(新功能)、fix(修复)、docs(文档)、style(样式)、refactor(重构)、test(测试)等

### 3. 测试习惯

- 编写单元测试覆盖关键功能
- 使用真机调试进行集成测试
- 定期进行回归测试

## 后续学习资源

- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信开发者社区](https://developers.weixin.qq.com/community/develop/)
- [ES6 入门教程](https://es6.ruanyifeng.com/)
- [Git 官方文档](https://git-scm.com/doc)

---

通过以上步骤，您应该能够成功搭建 SutWxApp 的开发环境并开始开发工作。如有任何问题，请参考常见问题部分或查阅相关文档。
