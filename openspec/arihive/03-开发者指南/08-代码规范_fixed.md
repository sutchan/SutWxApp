# 代码规范

<!--
文件名: 08-代码规范.md
版本号: 1.0.0
更新日期: 2025-11-30
作者: Sut
描述: 代码编写规范和风格要求
-->

## 目录

[TOC]

## 1. 概述

### 1.1 文档目的

本文档旨在介绍SutWxApp项目的代码规范，帮助开发者编写统一、规范、易于维护的代码。

### 1.2 适用范围

本规范适用于SutWxApp项目的所有代码，包括前端代码、后端代码和测试代码。

### 1.3 设计原则

- **可读性**：代码易于理解和维护
- **一致性**：代码风格一致，便于团队协作
- **可测试性**：代码易于测试
- **可扩展性**：代码易于扩展
- **高性能**：代码具有良好的性能表现

## 2. JavaScript代码规范

### 2.1 命名规范

- **变量命名**：使用小驼峰命名法，例如：`userName`
- **函数命名**：使用小驼峰命名法，动词开头，例如：`getUserInfo`
- **类名**：使用大驼峰命名法，例如：`UserService`
- **常量命名**：使用全大写字母，下划线分隔，例如：`MAX_RETRY_COUNT`
- **文件名**：使用小驼峰命名法，例如：`userService.js`
- **目录名**：使用小写字母，连字符分隔，例如：`user-service`

### 2.2 代码格式

- **缩进**：使用2个空格进行缩进
- **行宽**：每行不超过100个字符
- **空行**：函数之间空一行，代码块之间空一行
- **括号**：左括号不换行，右括号换行
- **空格**：
  - 运算符前后加空格，例如：`a = b + c`
  - 逗号后加空格，例如：`function(a, b, c)`
  - 冒号后加空格，例如：`const obj = { key: value }`
  - 大括号和条件语句之间加空格，例如：`if (condition) { }`

### 2.3 注释规范

- **文件注释**：文件顶部添加文件说明注释，包括文件名、版本号、更新日期、作者和描述
- **函数注释**：函数顶部添加函数说明注释，包括参数、返回值和异常
- **行注释**：对复杂代码行添加行内注释，说明代码的功能和逻辑
- **注释语言**：使用中文注释

### 2.4 代码质量

- **避免全局变量**：使用模块化设计，避免使用全局变量
- **避免重复代码**：提取公共函数和组件
- **使用const和let**：避免使用var
- **避免嵌套过深**：嵌套深度不超过4层
- **使用箭头函数**：优先使用箭头函数，尤其是在回调函数中
- **使用模板字符串**：优先使用模板字符串，例如：`Hello ${name}`
- **使用解构赋值**：优先使用解构赋值，例如：`const { name, age } = user`
- **使用扩展运算符**：优先使用扩展运算符，例如：`const newObj = { ...oldObj }`

### 2.5 错误处理

- **使用try-catch**：捕获和处理异常
- **使用Promise**：优先使用Promise处理异步操作
- **使用async/await**：优先使用async/await处理异步操作
- **避免静默失败**：记录错误日志，提供详细的错误信息

## 3. HTML代码规范

### 3.1 命名规范

- **标签名称**：使用小写字母，例如：`<div>`
- **属性名称**：使用小写字母，例如：`class="container"`
- **class名称**：使用小写字母，连字符分隔，例如：`container-fluid`
- **id名称**：使用小写字母，连字符分隔，例如：`main-content`

### 3.2 代码格式

- **缩进**：使用2个空格进行缩进
- **行宽**：每行不超过100个字符
- **空行**：模块级元素之间空一行
- **引号**：属性值使用双引号，例如：`class="container"`
- **自闭合标签**：使用自闭合标签，例如：`<img src="image.jpg" />`

### 3.3 代码质量

- **语义化标签**：优先使用语义化标签，例如：`<header>`, `<footer>`, `<nav>`
- **避免内联样式**：使用外部CSS文件
- **避免内联脚本**：使用外部JavaScript文件
- **避免冗余标签**：删除不必要的标签
- **使用alt属性**：为图片添加alt属性
- **使用title属性**：为链接添加title属性

## 4. CSS代码规范

### 4.1 命名规范

- **class名称**：使用小写字母，连字符分隔，例如：`container-fluid`
- **id名称**：使用小写字母，连字符分隔，例如：`main-content`
- **变量名称**：使用小写字母，连字符分隔，例如：`--primary-color`

### 4.2 代码格式

- **缩进**：使用2个空格进行缩进
- **行宽**：每行不超过100个字符
- **空行**：选择器之间空一行
- **空格**：
  - 冒号后加空格，例如：`color: red`
  - 选择器和大括号之间加空格，例如：`.container { }`
- **分号**：每个属性后加分号

### 4.3 注释规范

- **文件注释**：文件顶部添加文件说明注释
- **选择器注释**：对复杂选择器添加注释
- **块注释**：功能模块添加块注释
- **注释语言**：使用中文注释

### 4.4 代码质量

- **使用CSS变量**：使用CSS变量管理颜色、字体等
- **使用Flexbox和Grid**：优先使用Flexbox和Grid进行布局
- **避免!important**：避免使用!important，除非必要
- **避免嵌套过深**：嵌套深度不超过3层
- **使用简写属性**：优先使用简写属性，例如：`margin: 10px`
- **使用相对单位**：优先使用相对单位，例如：`rem`, `em`, `%`
- **使用CSS预处理器**：使用Sass或Less等CSS预处理器

## 5. 微信小程序代码规范

### 5.1 命名规范

- **页面文件命名**：使用小驼峰命名法，例如：`index.js`
- **组件文件命名**：使用小驼峰命名法，例如：`userInfo.js`
- **配置文件命名**：使用固定名称，例如：`app.json`, `page.json`
- **样式文件命名**：使用固定名称，例如：`app.wxss`, `page.wxss`

### 5.2 代码格式

- **缩进**：使用2个空格进行缩进
- **行宽**：每行不超过100个字符
- **空行**：函数之间空一行，代码块之间空一行
- **括号**：左括号不换行，右括号换行
- **空格**：语句结束使用分号

### 5.3 注释规范

- **文件注释**：文件顶部添加文件说明注释
- **函数注释**：函数顶部添加函数说明注释
- **行注释**：对复杂代码行添加行内注释
- **注释语言**：使用中文注释

### 5.4 代码质量

- **使用组件化开发**：将页面拆分为多个组件
- **使用数据绑定**：优先使用数据绑定，避免直接操作DOM
- **使用事件绑定**：优先使用事件绑定，避免直接操作DOM
- **使用生命周期函数**：正确使用生命周期函数
- **避免使用setTimeout**：优先使用wx.nextTick
- **避免使用setInterval**：优先使用wx.requestAnimationFrame

## 6. 后端代码规范

### 6.1 命名规范

- **变量命名**：使用小驼峰命名法，例如：`userName`
- **函数命名**：使用小驼峰命名法，动词开头，例如：`getUserInfo`
- **类名**：使用大驼峰命名法，例如：`UserService`
- **常量命名**：使用全大写字母，下划线分隔，例如：`MAX_RETRY_COUNT`
- **文件名**：使用小驼峰命名法，例如：`userService.js`
- **目录名**：使用小写字母，连字符分隔，例如：`user-service`

### 6.2 代码格式

- **缩进**：使用2个空格进行缩进
- **行宽**：每行不超过100个字符
- **空行**：函数之间空一行，代码块之间空一行
- **括号**：左括号不换行，右括号换行
- **空格**：语句结束使用分号

### 6.3 注释规范

- **文件注释**：文件顶部添加文件说明注释
- **函数注释**：函数顶部添加函数说明注释，包括参数、返回值和异常
- **行注释**：对复杂代码行添加行内注释
- **注释语言**：使用中文注释

### 6.4 代码质量

- **使用模块化设计**：将代码拆分为多个模块
- **使用中间件**：使用中间件处理公共逻辑
- **使用ORM**：使用ORM框架操作数据库
- **使用JWT**：使用JWT进行认证授权
- **使用日志**：记录请求日志和错误日志
- **使用缓存**：使用Redis等缓存数据库

## 7. 测试代码规范

### 7.1 命名规范

- **测试文件命名**：使用小驼峰命名法，后缀为.test.js，例如：`userService.test.js`
- **测试函数命名**：使用小驼峰命名法，动词开头，例如：`shouldGetUserById`
- **测试用例命名**：使用清晰的描述性名称，例如：`should return user when user exists`

### 7.2 代码格式

- **缩进**：使用2个空格进行缩进
- **行宽**：每行不超过100个字符
- **空行**：测试用例之间空一行
- **括号**：左括号不换行，右括号换行
- **空格**：语句结束使用分号

### 7.3 注释规范

- **文件注释**：文件顶部添加文件说明注释
- **测试用例注释**：对复杂测试用例添加注释
- **注释语言**：使用中文注释

### 7.4 代码质量

- **测试覆盖率**：测试覆盖率不低于80%
- **测试隔离**：测试用例之间相互隔离，不依赖于其他测试用例
- **测试数据**：使用测试数据，避免使用真实数据
- **测试断言**：使用清晰的断言，例如：`expect(result).toBe(expected)`
- **测试清理**：测试完成后清理测试数据

## 8. 代码审查

### 8.1 代码审查目的

- 提高代码质量
- 确保代码符合规范
- 发现潜在的问题
- 促进团队成员之间的知识共享

### 8.2 代码审查内容

- 代码是否符合规范
- 代码是否易于理解和维护
- 代码是否存在潜在的问题
- 代码是否具有良好的性能表现
- 代码是否具有良好的安全性

### 8.3 代码审查流程

1. 创建Pull Request
2. 邀请团队成员进行代码审查
3. 团队成员进行代码审查，提出意见和建议
4. 开发者修改代码审查中发现的问题
5. 团队成员再次进行代码审查
6. 合并Pull Request

## 9. 代码检查工具

### 9.1 ESLint

- **用途**：检查JavaScript代码是否符合规范
- **配置文件**：.eslintrc.js
- **运行命令**：`npm run lint`

### 9.2 Prettier

- **用途**：自动格式化代码
- **配置文件**：.prettierrc.js
- **运行命令**：`npm run format`

### 9.3 Stylelint

- **用途**：检查CSS代码是否符合规范
- **配置文件**：.stylelintrc.js
- **运行命令**：`npm run lint:css`

### 9.4 Commitlint

- **用途**：检查提交信息是否符合规范
- **配置文件**：.commitlintrc.js
- **运行命令**：`npm run lint:commit`

## 10. 常见问题

### 10.1 代码格式不一致

**问题**：团队成员之间的代码格式不一致
**解决方案**：
1. 使用Prettier自动格式化代码
2. 配置编辑器，使用统一的代码格式
3. 运行代码检查工具，确保代码符合规范

### 10.2 代码质量差

**问题**：代码质量差，难以维护
**解决方案**：
1. 遵循代码规范
2. 进行代码审查
3. 定期重构代码
4. 编写单元测试

### 10.3 测试覆盖率低

**问题**：测试覆盖率低，代码质量难以保证

**解决方案**：
1. 编写单元测试
2. 编写集成测试
3. 编写系统测试
4. 使用测试覆盖率工具，监控测试覆盖率

## 11. 相关链接

- [开发手册.md](./07-开发手册.md)
- [API开发指南.md](./04-API开发指南.md)
- [技术设计文档.md](./06-技术设计文档.md)