# 开发指南规范

## 目的
本规范定义了苏铁微信小程序（SutWxApp）项目的开发环境设置、配置和最佳实践，包括前端和后端环境要求、安装步骤、工具配置和开发指南。

## 要求

### 要求：开发环境设置
系统应为前端和后端开发定义清晰的开发环境要求。

#### 场景：微信小程序环境
- **当**设置前端开发环境时
- **则**开发人员应安装最新稳定版本的微信开发者工具
- **并**从微信公众平台获取微信小程序AppID
- **并**安装Node.js v16.0.0+和npm v8.0.0+

#### 场景：后端开发环境
- **当**设置后端开发环境时
- **则**开发人员应安装Node.js v16.0.0+和npm v8.0.0+
- **并**安装MySQL v8.0+和Redis v6.0+
- **并**安装最新稳定版本的Git

### 要求：项目安装
系统应提供清晰的项目安装步骤，包括克隆仓库和安装依赖。

#### 场景：仓库克隆
- **当**开始新的开发设置时
- **则**开发人员应使用`git clone https://github.com/sutchan/SutWxApp.git`克隆项目仓库

#### 场景：依赖安装
- **当**设置依赖时
- **则**开发人员应在适当的目录中使用`npm install`安装前端依赖
- **并**安装后端依赖（如果适用）

### 要求：项目配置
系统应为前端和后端组件定义配置要求。

#### 场景：小程序配置
- **当**配置前端时
- **则**开发人员应在`project.config.json`中设置AppID
- **并**在`app.js`中配置API基础URL

#### 场景：后端配置
- **当**配置后端时
- **则**开发人员应在`config/database.js`中设置数据库连接参数
- **并**在`config/redis.js`中配置Redis连接
- **并**在`config/jwt.js`中设置JWT密钥

### 要求：开发工具配置
系统应提供开发工具的配置指南，包括VS Code和微信开发者工具。

#### 场景：VS Code设置
- **当**配置VS Code时
- **则**开发人员应安装所需扩展（ESLint、Prettier、Vetur、微信代码片段、GitLens）
- **并**配置VS Code设置，使其在保存时自动格式化和 linting

#### 场景：微信开发者工具设置
- **当**配置微信开发者工具时
- **则**开发人员应启用ES6转ES5、增强编译和代码压缩
- **并**在微信公众平台中配置域名白名单

### 要求：项目执行
系统应提供运行前端和后端组件的清晰说明。

#### 场景：运行前端
- **当**运行前端项目时
- **则**开发人员应使用微信开发者工具编译和预览项目

#### 场景：运行后端
- **当**运行后端项目时
- **则**开发人员应使用`npm start`启动后端服务
- **或**使用带有nodemon的`npm run dev`进行热重载

### 要求：开发最佳实践
系统应定义开发最佳实践，包括代码风格、Git工作流和性能优化。

#### 场景：代码风格
- **当**编写代码时
- **则**开发人员应遵循JavaScript ES6+语法
- **并**使用ESLint和Prettier进行代码检查和格式化
- **并**实践基于组件的开发
- **并**保持清晰的代码注释

#### 场景：Git工作流
- **当**使用Git工作时
- **则**开发人员应遵循Git Flow分支策略
- **并**使用语义化提交消息
- **并**按照约定命名分支：feature/xxx、bugfix/xxx、hotfix/xxx
- **并**定期拉取和推送代码更改

#### 场景：性能优化
- **当**优化应用程序性能时
- **则**开发人员应优化图像大小和格式
- **并**实现懒加载和分页
- **并**适当使用缓存机制
- **并**优化API响应时间

### 要求：故障排除
系统应提供常见开发问题的故障排除指南。

#### 场景：API连接失败
- **当**遇到API连接问题时
- **则**开发人员应检查后端服务是否正在运行
- **并**验证API基础URL配置
- **并**确保服务器域名在白名单中
- **并**确认请求在允许的域名列表中

#### 场景：编译失败
- **当**遇到编译错误时
- **则**开发人员应验证Node.js版本兼容性
- **并**在必要时重新安装依赖
- **并**检查代码中的语法错误

#### 场景：页面加载缓慢
- **当**遇到页面加载缓慢时
- **则**开发人员应优化图像资源
- **并**实现懒加载和分页
- **并**优化缓存策略
- **并**努力提高API响应时间

## 开发环境要求

### 前端（微信小程序）
- **微信开发者工具**：最新稳定版本
- **小程序AppID**：从微信公众平台获取
- **Node.js**：v16.0.0+ 
- **npm**：v8.0.0+

### 后端
- **Node.js**：v16.0.0+
- **npm**：v8.0.0+
- **MySQL**：v8.0+
- **Redis**：v6.0+
- **Git**：最新稳定版本

## 项目安装步骤

1. **克隆仓库**：
   ```bash
   git clone https://github.com/sutchan/SutWxApp.git
   cd SutWxApp
   ```

2. **安装依赖**：
   - 前端：`cd SutWxApp && npm install`
   - 后端：`cd backend && npm install`（如果适用）

## 项目配置

### 前端配置

1. **在project.config.json中设置AppID**：
   ```json
   {
     "appid": "your-app-id-here"
     // 其他配置
   }
   ```

2. **在app.js中配置API基础URL**：
   ```javascript
   App({
     globalData: {
       apiBaseUrl: 'https://your-api-server.com/api/v1'
     }
     // 其他配置
   })
   ```

### 后端配置

1. **数据库配置（config/database.js）**：
   ```javascript
   module.exports = {
     host: 'localhost',
     port: 3306,
     user: 'root',
     password: 'your-password',
     database: 'sutwxapp',
     charset: 'utf8mb4'
   };
   ```

2. **Redis配置（config/redis.js）**：
   ```javascript
   module.exports = {
     host: 'localhost',
     port: 6379,
     password: '',
     db: 0
   };
   ```

3. **JWT配置（config/jwt.js）**：
   ```javascript
   module.exports = {
     secret: 'your-jwt-secret-key',
     expiresIn: '7d'
   };
   ```

## 开发工具配置

### VS Code设置

**所需扩展**：
- ESLint：代码检查
- Prettier：代码格式化
- Vetur：Vue.js支持（如果适用）
- 微信代码片段：微信小程序代码片段
- GitLens：Git增强功能

**VS Code设置**：
```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "prettier.singleQuote": true,
  "prettier.trailingComma": "es5",
  "prettier.tabWidth": 2
}
```

### 微信开发者工具设置

**所需设置**：
- 调试基础库：最新稳定版本
- ES6转ES5：启用
- 增强编译：启用
- 代码压缩：启用
- 上传时自动压缩：启用

**域名白名单配置**：
1. 登录微信公众平台
2. 导航至开发 > 开发设置
3. 将API服务器域名添加到服务器域名列表

## 运行项目

### 前端
1. 打开微信开发者工具
2. 从`SutWxApp/SutWxApp`目录导入项目
3. 点击"编译"按钮运行项目
4. 点击"预览"按钮在移动设备上测试

### 后端
1. 导航至后端目录
2. 启动服务：
   - 生产环境：`npm start`
   - 开发环境（带热重载）：`npm run dev`

## 开发标准

### 要求：代码标准
系统应对所有开发工作遵循一致的代码标准。

#### 场景：命名约定
- **当**命名变量、函数、类、常量、文件和目录时
- **则**开发人员应使用适当的命名约定（变量/函数使用camelCase，类使用PascalCase，常量使用UPPER_SNAKE_CASE等）

#### 场景：代码格式化
- **当**编写代码时
- **则**开发人员应使用2个空格进行缩进，每行最多100个字符，并在运算符周围使用适当的空格

#### 场景：注释标准
- **当**添加注释时
- **则**开发人员应根据需要包含文件注释、函数注释和内联注释，使用中文

#### 场景：代码质量
- **当**开发功能时
- **则**开发人员应避免全局变量，使用const/let代替var，避免深度嵌套，并遵循其他代码质量指南

#### 场景：代码检查工具
- **当**审查代码时
- **则**开发人员应使用ESLint、Prettier、Stylelint和Commitlint进行代码质量保证

### 要求：版本控制标准
系统应遵循一致的版本控制实践。

#### 场景：分支管理
- **当**使用Git分支时
- **则**开发人员应使用main/master作为生产分支，develop作为集成分支，feature/xxx用于新功能，bugfix/xxx用于bug修复

#### 场景：提交消息
- **当**提交更改时
- **则**开发人员应使用语义化提交消息，格式为：`<type>: <description>`，其中type是feat、fix、docs、style、refactor、test或chore之一

#### 场景：分支合并
- **当**合并分支时
- **则**开发人员应遵循分支策略：feature → develop，bugfix → develop和main，release → main和develop

### 要求：测试标准
系统应实施全面的测试标准。

#### 场景：测试覆盖率
- **当**编写测试时
- **则**开发人员应目标实现最小80%的单元测试覆盖率，70%的集成测试覆盖率，和60%的系统测试覆盖率

#### 场景：测试类型
- **当**规划测试时
- **则**开发人员应根据需要实施单元测试、集成测试、系统测试、性能测试和安全测试

#### 场景：测试框架
- **当**实施测试时
- **则**开发人员应使用适当的测试框架（Jest、Mocha、Chai、Postman、SuperTest、JMeter、Artillery）

#### 场景：测试流程
- **当**执行测试时
- **则**开发人员应遵循测试流程：编写测试用例，执行测试，分析结果，修复问题，重新运行测试

### 要求：代码审查标准
系统应遵循一致的代码审查实践。

#### 场景：代码审查目的
- **当**进行代码审查时
- **则**审查人员应关注代码质量、符合标准情况、潜在问题、性能和安全性

#### 场景：代码审查流程
- **当**提交代码进行审查时
- **则**开发人员应创建Pull Request，团队成员应审查并提供反馈，在合并前应进行更改

#### 场景：代码审查工具
- **当**审查代码时
- **则**团队成员应使用GitHub Pull Requests、GitLab Merge Requests或Bitbucket Pull Requests

### 要求：CI/CD标准
系统应实施持续集成和持续部署实践。

#### 场景：持续集成
- **当**提交代码时
- **则**CI系统应自动运行测试、代码审查和构建

#### 场景：持续部署
- **当**代码合并到main分支时
- **则**CD系统应在通过测试后自动部署到生产环境

#### 场景：CI/CD工具
- **当**实施CI/CD时
- **则**开发人员应使用适当的工具（Jenkins、GitHub Actions、GitLab CI/CD、CircleCI、Travis CI）

## 开发工作流

### 要求：开发流程
系统应遵循从需求分析到维护的一致开发流程。

#### 场景：需求分析
- **当**开始新功能时
- **则**开发人员应分析业务需求，确定技术解决方案，评估工作量，并创建开发计划

#### 场景：设计阶段
- **当**设计解决方案时
- **则**开发人员应进行架构设计、详细设计，编写设计文档，并审查设计文档

#### 场景：开发阶段
- **当**实现功能时
- **则**开发人员应克隆仓库，创建功能分支，编写代码和单元测试，并提交更改

#### 场景：测试阶段
- **当**验证功能时
- **则**开发人员应进行集成测试、系统测试、性能测试和安全测试

#### 场景：部署阶段
- **当**发布功能时
- **则**开发人员应部署到测试环境，进行验收测试，部署到生产环境，并监控系统状态

#### 场景：维护阶段
- **当**维护系统时
- **则**开发人员应修复生产问题，优化性能，添加新功能，并更新文档

## 最佳实践

### 要求：代码复用
系统应通过模块化设计促进代码复用。

#### 场景：组件复用
- **当**开发UI元素时
- **则**开发人员应创建可重用组件，而不是重复代码

#### 场景：函数复用
- **当**实现类似功能时
- **则**开发人员应提取通用函数，而不是重复代码

### 要求：错误处理
系统应实施健壮的错误处理机制。

#### 场景：异常处理
- **当**处理可能出错的代码时
- **则**开发人员应使用try-catch、Promises和async/await进行适当的错误处理

#### 场景：错误日志记录
- **当**发生错误时
- **则**系统应记录详细的错误信息，以便调试

#### 场景：用户友好的错误
- **当**向用户显示错误时
- **则**系统应提供清晰、有帮助的错误消息

### 要求：性能优化
系统应实施性能优化策略。

#### 场景：数据库优化
- **当**使用数据库时
- **则**开发人员应优化查询，使用索引，并实现缓存

#### 场景：代码优化
- **当**编写代码时
- **则**开发人员应使用高效算法，避免不必要的计算，并遵循性能最佳实践

### 要求：安全实践
系统应遵循安全最佳实践。

#### 场景：输入验证
- **当**处理用户输入时
- **则**开发人员应验证和清理所有输入，以防止SQL注入、XSS、CSRF和其他安全漏洞

#### 场景：数据安全
- **当**存储敏感数据时
- **则**开发人员应对静态数据和传输中的数据进行加密

#### 场景：访问控制
- **当**实现认证和授权时
- **则**开发人员应使用适当的安全机制，如JWT和RBAC

## 故障排除

### API连接问题
- 验证后端服务是否正在运行
- 检查API基础URL配置
- 确保服务器域名在白名单中
- 确认请求在允许的域名列表中

### 编译失败
- 检查Node.js版本兼容性
- 重新安装依赖（删除node_modules并运行npm install）
- 查看控制台错误消息中的语法问题

### 页面加载缓慢
- 优化图像大小和格式
- 实现懒加载和分页
- 适当使用缓存机制
- 优化API响应时间

### 代码质量问题
- 运行代码检查工具识别问题
- 遵循代码标准和最佳实践
- 进行彻底的代码审查
- 根据需要重构代码

### 测试失败
- 查看测试失败消息
- 检查代码问题
- 验证测试数据和断言
- 单独运行测试以隔离问题