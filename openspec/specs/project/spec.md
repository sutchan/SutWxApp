 项目规范

## 目的
本规范定义了苏铁微信小程序（SutWxApp）项目的基本信息、架构设计、开发流程和文档规范，旨在确保项目的一致性、可维护性和可扩展性。

## 项目概述

### 项目背景
苏铁微信小程序（SutWxApp）是一款面向普通消费者的电商微信小程序，专注于提供优质的商品和服务，通过创新的积分系统和社交功能，打造一个集购物、社交、娱乐于一体的综合性电商平台。

### 项目定位
- **目标用户**：普通消费者
- **核心价值**：优质商品、便捷购物体验、创新的积分系统
- **市场定位**：中高端电商平台

### 项目目标
- 提供稳定、可靠的电商服务
- 打造良好的用户体验
- 实现业务目标和用户增长
- 构建可扩展的技术架构

## 技术栈

### 前端技术栈
- **框架**：微信小程序原生框架
- **开发语言**：TypeScript
- **UI组件库**：WeUI + 自定义组件
- **开发工具**：微信开发者工具、VS Code、Bun

### 后端技术栈
- **运行时**：Bun 1.x
- **开发语言**：TypeScript
- **Web框架**：Hono / Bun原生HTTP服务器
- **数据库**：
  - MySQL 8.x（关系型数据）
  - Redis 7.x（缓存、会话管理）
  - MongoDB 6.x（非关系型数据）
- **认证授权**：JWT + RBAC
- **API设计**：RESTful API

### 基础设施
- **包管理器**：Bun
- **容器化**：Docker
- **容器编排**：Kubernetes（生产环境）、Docker Compose（开发环境）
- **CI/CD**：GitHub Actions（使用Bun）
- **监控**：Prometheus + Grafana
- **日志**：Bun内置日志 + ELK Stack

## 项目结构

### 目录结构
```
SutWxApp/
├── app.js              # 小程序入口文件
├── app.json            # 全局配置
├── app.wxss            # 全局样式
├── assets/             # 第三方资源
│   └── images/         # 图片资源
├── components/         # 自定义组件
├── images/             # 图片文件
├── pages/              # 页面文件
│   ├── home/           # 首页
│   ├── category/       # 分类页
│   ├── product/        # 商品页
│   ├── cart/           # 购物车
│   ├── order/          # 订单页
│   ├── user/           # 用户中心
│   └── ...             # 其他功能模块
├── services/           # 服务层
├── tests/              # 测试文件
├── utils/              # 工具类
├── docs/               # 项目文档
└── openspec/           # 规范文档
```

### 模块划分

#### 1. 首页模块
- 轮播图展示
- 推荐商品
- 分类导航
- 活动专区

#### 2. 分类模块
- 分类层级展示
- 商品筛选
- 商品排序
- 商品视图切换

#### 3. 商品模块
- 商品详情展示
- 商品规格选择
- 商品评价
- 商品操作（加入购物车、立即购买、收藏、分享）

#### 4. 购物车模块
- 商品管理
- 数量调整
- 价格计算
- 结算功能

#### 5. 订单模块
- 订单列表
- 订单详情
- 订单状态跟踪
- 订单操作（支付、取消、退款、评价）

#### 6. 用户模块
- 个人信息管理
- 收货地址管理
- 收藏夹
- 优惠券
- 积分管理
- 客服中心
- 设置

#### 7. 积分模块
- 积分获取
- 积分兑换
- 积分记录

#### 8. 支付模块
- 微信支付集成
- 支付流程管理
- 支付结果处理

#### 9. 物流模块
- 物流信息查询
- 物流状态更新

#### 10. 客服模块
- 在线客服
- 常见问题
- 联系方式

#### 11. 管理后台
- 商品管理
- 订单管理
- 用户管理
- 数据统计

## 开发流程

### 1. 需求分析
- 分析业务需求
- 确定功能范围
- 评估工作量
- 创建开发计划

### 2. 设计阶段
- 架构设计
- 详细设计
- 编写设计文档
- 设计评审

### 3. 开发阶段
- 代码编写
- 单元测试
- 代码审查
- 集成测试

### 4. 测试阶段
- 功能测试
- 性能测试
- 兼容性测试
- 回归测试
- 安全测试

### 5. 部署阶段
- 部署到测试环境
- 验收测试
- 部署到生产环境
- 监控系统状态

### 6. 维护阶段
- 修复生产问题
- 优化性能
- 添加新功能
- 更新文档

## 代码规范

### 命名规范
- **变量/函数**：camelCase（小驼峰命名法）
- **类/构造函数**：PascalCase（大驼峰命名法）
- **常量**：UPPER_SNAKE_CASE（全大写，下划线分隔）
- **文件/目录**：kebab-case（短横线分隔）
- **组件**：PascalCase（大驼峰命名法）

### 代码格式化
- 使用2个空格进行缩进
- 每行代码不超过100个字符
- 文件末尾添加空行
- 在运算符周围添加空格
- 函数括号前添加空格
- 逗号后添加空格

### 注释规范
- 每个函数必须添加函数级注释
- 注释使用中文
- 复杂逻辑添加行内注释
- 文件头部添加文件说明注释

```javascript
/**
 * 文件名: example.js
 * 版本号: 1.0.0
 * 更新日期: 2025-12-26
 * 功能描述: 示例函数
 * @param {Object} options - 查询参数
 * @param {string} options.type - 类型
 * @returns {Promise<Object>} 结果
 */
async function exampleFunction(options = {}) {
  // 实现逻辑
}
```

### 代码质量
- 避免使用全局变量，使用const/let代替var
- 避免深层嵌套，保持代码扁平
- 函数职责单一，避免过长函数
- 使用模块化设计，提高代码复用性

## Git工作流

### 分支策略
- **main/master**：生产分支，保持稳定
- **develop**：集成分支，用于测试
- **feature/xxx**：功能开发分支
- **bugfix/xxx**：bug修复分支
- **hotfix/xxx**：紧急修复分支

### 提交规范
使用语义化提交消息，格式为：`<type>: <description>`

**类型说明**：
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码样式修改（不影响功能）
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建或辅助工具的变动

**示例**：
```
feat: 添加用户积分系统
fix: 修复购物车数量计算错误
docs: 更新API文档
```

### 分支合并
- feature → develop
- bugfix → develop 和 main
- release → main 和 develop

## 文档规范

### 文档类型
- **需求文档**：描述项目需求
- **设计文档**：描述系统设计
- **API文档**：描述API接口
- **测试文档**：描述测试用例
- **用户文档**：描述用户操作

### 文档格式
- 使用Markdown格式编写
- 保持文档结构清晰
- 使用一致的标题层级
- 代码块使用正确的语法高亮
- 表格使用Markdown表格语法

### 文档更新
- 代码变更时同步更新相关文档
- 定期审查和更新文档
- 保持文档的准确性和完整性

## 质量保证

### 测试策略
- **单元测试**：测试单个函数或组件
- **集成测试**：测试多个组件或模块的交互
- **系统测试**：测试整个系统的功能
- **性能测试**：测试系统的性能表现
- **兼容性测试**：测试在不同设备和环境下的表现
- **安全测试**：测试系统的安全性

### 测试覆盖率
- 单元测试覆盖率：≥80%
- 集成测试覆盖率：≥70%
- 系统测试覆盖率：≥100%（核心功能）

### 代码审查
- 所有代码提交前必须进行代码审查
- 代码审查关注点：
  - 代码质量和可读性
  - 符合编码规范
  - 潜在问题
  - 性能和安全性
  - 测试覆盖率

## 部署策略

### 环境划分
- **开发环境**：供开发人员使用
- **测试环境**：供测试人员使用
- **预生产环境**：模拟生产环境
- **生产环境**：正式上线环境

### 部署流程
1. 代码提交到GitHub
2. GitHub Actions自动运行测试和构建
3. 构建成功后部署到测试环境
4. 测试通过后部署到预生产环境
5. 预生产环境验证通过后部署到生产环境

### 回滚策略
- 保留历史部署版本
- 实现一键回滚功能
- 回滚前备份数据
- 回滚后验证系统功能

## 监控与运维

### 监控指标
- **服务器指标**：CPU、内存、磁盘、网络
- **应用指标**：响应时间、请求成功率、并发数、错误率
- **数据库指标**：查询响应时间、连接数、缓存命中率

### 告警机制
- 设置合理的告警阈值
- 多种告警渠道（邮件、Slack、电话）
- 告警分级管理

### 日志管理
- 集中式日志管理
- 结构化日志格式
- 日志保留策略
- 日志查询和分析工具

## 安全策略

### 数据安全
- 敏感数据加密存储
- 传输数据加密
- 定期数据备份
- 访问控制和权限管理

### 应用安全
- 防止SQL注入
- 防止XSS攻击
- 防止CSRF攻击
- 输入验证和过滤
- 安全的认证和授权机制

### 基础设施安全
- 防火墙配置
- 定期安全扫描
- 漏洞修复
- 安全审计

## 性能优化

### 前端优化
- 图片优化（压缩、懒加载）
- 代码压缩
- 减少网络请求
- 合理使用缓存

### 后端优化
- 数据库查询优化
- 合理使用缓存
- 异步处理
- 负载均衡

### 基础设施优化
- 服务器配置优化
- CDN加速
- 数据库优化

## 团队协作

### 沟通机制
- 定期站会
- 每周例会
- 项目管理工具（如Jira、Trello）
- 即时通讯工具（如微信、Slack）

### 角色与职责
- **项目经理**：负责项目管理和协调
- **产品经理**：负责产品设计和需求管理
- **开发人员**：负责代码编写和维护
- **测试人员**：负责测试和质量保证
- **运维人员**：负责部署和运维

### 知识共享
- 定期技术分享
- 文档共享
- 代码评审
- 经验总结

## 版本管理

### 版本号格式
采用语义化版本号：MAJOR.MINOR.PATCH

- **MAJOR**：不兼容的API更改
- **MINOR**：向下兼容的功能性新增
- **PATCH**：向下兼容的问题修正

### 发布流程
1. 更新版本号
2. 编写发布说明
3. 执行构建和测试
4. 部署到生产环境
5. 创建版本标签

## 变更管理

### 变更流程
1. 提出变更请求
2. 评估变更影响
3. 审批变更请求
4. 实施变更
5. 验证变更结果
6. 记录变更

### 变更类型
- **功能变更**：添加新功能或修改现有功能
- **bug修复**：修复系统bug
- **性能优化**：提高系统性能
- **安全修复**：修复安全漏洞

## 术语表

| 术语 | 解释 |
|------|------|
| SutWxApp | 苏铁微信小程序 |
| JWT | JSON Web Token，用于认证和授权 |
| RBAC | Role-Based Access Control，基于角色的访问控制 |
| RESTful | 一种API设计风格 |
| CI/CD | 持续集成/持续部署 |
| ELK Stack | Elasticsearch、Logstash、Kibana，用于日志管理 |
| Prometheus | 用于监控的开源系统 |
| Grafana | 用于数据可视化的开源工具 |
| Docker | 容器化平台 |
| Kubernetes | 容器编排平台 |

## 附录

### 参考文档
- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [Node.js官方文档](https://nodejs.org/en/docs/)
- [Express.js官方文档](https://expressjs.com/)
- [RESTful API设计指南](https://restfulapi.net/)
- [JWT官方文档](https://jwt.io/)

### 联系方式
- **项目负责人**：Sut
- **邮箱**：sut@example.com
- **微信**：sutwxapp
- **GitHub**：https://github.com/sutchan/SutWxApp
