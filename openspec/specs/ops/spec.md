# 杩愮淮涓庨儴缃茶鑼?
## 鐩殑
鏈鑼冨畾涔変簡鑻忛搧寰俊灏忕▼搴忥紙SutWxApp锛夐」鐩殑杩愮淮涓庨儴缃叉寚鍗楋紝鍖呮嫭鐜瑕佹眰銆佺郴缁熼厤缃€佹潈闄愮鐞嗐€侀儴缃叉祦绋嬨€佹棩甯歌繍缁淬€佺洃鎺ф柟娉曞拰鏁呴殰澶勭悊绋嬪簭锛屼互纭繚绯荤粺绋冲畾杩愯銆?
## 瑕佹眰

### 瑕佹眰锛氱郴缁熸灦鏋?绯荤粺搴旇璁℃竻鏅扮殑鏋舵瀯锛屽寘鎷墠绔€佸悗绔€佹暟鎹簱銆佷腑闂翠欢鍜岀涓夋柟鏈嶅姟銆?
#### 鍦烘櫙锛氭灦鏋勭粍浠?- **褰?*璁捐绯荤粺鏃?- **鍒?*瀹冨簲鍖呮嫭鍓嶇锛堝井淇″皬绋嬪簭锛夈€佸悗绔紙Node.js + Express API锛夈€佹暟鎹簱锛圡ySQL銆丷edis銆丮ongoDB锛夈€佷腑闂翠欢锛圢ginx銆丷edis锛夊拰绗笁鏂规湇鍔★紙寰俊鏀粯銆佺墿娴丄PI锛?
#### 鍦烘櫙锛氱幆澧冩灦鏋?- **褰?*閮ㄧ讲绯荤粺鏃?- **鍒?*瀹冨簲鏀寔涓嶅悓鐨勭幆澧冿紝鍖呮嫭寮€鍙戙€佹祴璇曞拰鐢熶骇鐜

### 瑕佹眰锛氶儴缃叉祦绋?绯荤粺搴斾负涓嶅悓鐜瀹氫箟鏄庣‘鐨勯儴缃叉祦绋嬨€?
#### 鍦烘櫙锛氬紑鍙戠幆澧冮儴缃?- **褰?*閮ㄧ讲鍒板紑鍙戠幆澧冩椂
- **鍒?*寮€鍙戜汉鍛樺簲浣跨敤Docker Compose杩涜蹇€熸惌寤哄拰鎷嗛櫎

#### 鍦烘櫙锛氱敓浜х幆澧冮儴缃?- **褰?*閮ㄧ讲鍒扮敓浜х幆澧冩椂
- **鍒?*杩愮淮浜哄憳搴斾娇鐢↘ubernetes杩涜鍙墿灞曞拰鍙潬鐨勯儴缃?
### 瑕佹眰锛氱郴缁熺洃鎺?绯荤粺搴斿绯荤粺鎬ц兘銆佸簲鐢ㄦ寚鏍囧拰鏁版嵁搴撳仴搴锋儏鍐靛疄鏂藉叏闈㈢洃鎺с€?
#### 鍦烘櫙锛氱洃鎺ф寚鏍?- **褰?*鐩戞帶绯荤粺鏃?- **鍒?*杩愮淮浜哄憳搴旇窡韪湇鍔″櫒鎸囨爣锛圕PU銆佸唴瀛樸€佺鐩樸€佺綉缁滐級銆佸簲鐢ㄦ寚鏍囷紙API鍝嶅簲鏃堕棿銆佹垚鍔熺巼銆佸苟鍙戣繛鎺ユ暟銆侀敊璇巼锛夊拰鏁版嵁搴撴寚鏍囷紙鏌ヨ鍝嶅簲鏃堕棿銆佽繛鎺ユ暟銆佺紦瀛樺懡涓巼銆佹煡璇㈤噺锛?
#### 鍦烘櫙锛氱洃鎺у伐鍏?- **褰?*瀹炴柦鐩戞帶鏃?- **鍒?*绯荤粺搴斾娇鐢≒rometheus杩涜鎸囨爣鏀堕泦锛孏rafana杩涜鍙鍖栵紝Alertmanager杩涜鍛婅

### 瑕佹眰锛氭棩蹇楃鐞?绯荤粺搴斿鎵€鏈夌粍浠跺疄鏂介泦涓紡鏃ュ織绠＄悊銆?
#### 鍦烘櫙锛氭棩蹇楁敹闆?- **褰?*绠＄悊鏃ュ織鏃?- **鍒?*绯荤粺搴斾娇鐢‥LK Stack锛圠ogstash銆丒lasticsearch銆並ibana锛夎繘琛屾棩蹇楁敹闆嗐€佸瓨鍌ㄥ拰鍒嗘瀽

#### 鍦烘櫙锛氭棩蹇椾繚鐣?- **褰?*閰嶇疆鏃ュ織鏃?- **鍒?*杩愮淮浜哄憳搴旇缃€傚綋鐨勬棩蹇椾繚鐣欑瓥鐣ワ紙渚嬪锛?0澶╋級骞跺畾鏈熸竻鐞嗚繃鏈熸棩蹇?
### 瑕佹眰锛氭暟鎹浠?绯荤粺搴斿鎵€鏈夊叧閿暟鎹疄鏂藉畾鏈熸暟鎹浠界▼搴忋€?
#### 鍦烘櫙锛氬浠介鐜?- **褰?*澶囦唤鏁版嵁鏃?- **鍒?*杩愮淮浜哄憳搴旈伒寰浠借鍒掞細MySQL姣忔棩鍏ㄩ噺澶囦唤锛孯edis姣忓皬鏃跺揩鐓э紝MongoDB姣忔棩鍏ㄩ噺澶囦唤锛岄厤缃枃浠舵瘡娆℃洿鏀规椂澶囦唤

#### 鍦烘櫙锛氬浠芥柟娉?- **褰?*鎵ц澶囦唤鏃?- **鍒?*杩愮淮浜哄憳搴斾娇鐢ㄩ€傚綋鐨勫伐鍏凤細MySQL浣跨敤mysqldump锛孯edis浣跨敤BGSAVE锛孧ongoDB浣跨敤mongodump

### 瑕佹眰锛氬畨鍏ㄧ鐞?绯荤粺搴斿疄鏂藉己澶х殑瀹夊叏鎺柦锛屼互闃叉甯歌濞佽儊銆?
#### 鍦烘櫙锛氱郴缁熸洿鏂?- **褰?*缁存姢瀹夊叏鎬ф椂
- **鍒?*杩愮淮浜哄憳搴斿畾鏈熸洿鏂扮郴缁熷拰渚濊禆椤?
#### 鍦烘櫙锛氶槻鐏閰嶇疆
- **褰?*淇濇姢绯荤粺瀹夊叏鏃?- **鍒?*杩愮淮浜哄憳搴旈厤缃槻鐏锛屽彧鍏佽蹇呰鐨勭鍙?
#### 鍦烘櫙锛欻TTPS浣跨敤
- **褰?*澶勭悊鏁版嵁浼犺緭鏃?- **鍒?*绯荤粺搴斾娇鐢ㄥ甫鏈夋湁鏁圫SL璇佷功鐨凥TTPS

### 瑕佹眰锛氭晠闅滃鐞?绯荤粺搴斾负甯歌闂瀹氫箟鏄庣‘鐨勬晠闅滃鐞嗙▼搴忋€?
#### 鍦烘櫙锛欰PI鏈嶅姟涓嶅彲鐢?- **褰?*API鏈嶅姟涓嶅彲鐢ㄦ椂
- **鍒?*杩愮淮浜哄憳搴旀鏌ユ棩蹇楋紝楠岃瘉鏁版嵁搴撹繛鎺ワ紝妫€鏌ユ湇鍔″櫒璧勬簮锛屽苟鍦ㄥ繀瑕佹椂閲嶅惎鏈嶅姟

#### 鍦烘櫙锛氭暟鎹簱杩炴帴澶辫触
- **褰?*鏁版嵁搴撹繛鎺ュけ璐ユ椂
- **鍒?*杩愮淮浜哄憳搴旀鏌ユ暟鎹簱鏈嶅姟鐘舵€侊紝楠岃瘉杩炴帴閰嶇疆锛屾鏌ユ暟鎹簱鏉冮檺锛屽苟鍦ㄥ繀瑕佹椂閲嶅惎鏁版嵁搴撴湇鍔?
#### 鍦烘櫙锛欳PU浣跨敤鐜囬珮
- **褰?*CPU浣跨敤鐜囬珮鏃?- **鍒?*杩愮淮浜哄憳搴旇瘑鍒崰鐢–PU鏈€楂樼殑杩涚▼锛屽垎鏋怌PU浣跨敤鐜囬珮鐨勫師鍥狅紝骞朵紭鍖栧簲鐢ㄤ唬鐮佹垨澧炲姞鏈嶅姟鍣ㄨ祫婧?
### 瑕佹眰锛氱郴缁熷崌绾?绯荤粺搴旀湁瀹氫箟鏄庣‘鐨勫崌绾ф祦绋嬶紝鍖呮嫭鍑嗗銆佹墽琛屽拰鍥炴粴绋嬪簭銆?
#### 鍦烘櫙锛氬崌绾у噯澶?- **褰?*鍑嗗鍗囩骇鏃?- **鍒?*杩愮淮浜哄憳搴斿浠芥暟鎹紝娴嬭瘯鍗囩骇鐗堟湰锛屽苟瀹氫箟鍥炴粴璁″垝

#### 鍦烘櫙锛氬崌绾ф墽琛?- **褰?*鎵ц鍗囩骇鏃?- **鍒?*杩愮淮浜哄憳搴斿仠姝㈠綋鍓嶆湇鍔★紝閮ㄧ讲鏂版湇鍔★紝鎵ц鏁版嵁搴撹縼绉伙紝鍚姩鏂版湇鍔★紝骞堕獙璇佸崌绾х粨鏋?
#### 鍦烘櫙锛氬洖婊氳鍒?- **褰?*鍗囩骇澶辫触鏃?- **鍒?*杩愮淮浜哄憳搴斿仠姝㈡柊鏈嶅姟锛屾仮澶嶆棫鏈嶅姟锛屽苟鎭㈠鏁版嵁澶囦唤

### 瑕佹眰锛氱伨闅炬仮澶?绯荤粺搴旀湁鐏鹃毦鎭㈠璁″垝锛屼互纭繚鍦ㄥ彂鐢熼噸澶ф晠闅滄椂涓氬姟杩炵画鎬с€?
#### 鍦烘櫙锛氱伨闅剧被鍨?- **褰?*瑙勫垝鐏鹃毦鏃?- **鍒?*杩愮淮浜哄憳搴旇€冭檻鏈嶅姟鍣ㄦ晠闅溿€佹暟鎹簱鏁呴殰銆佺綉缁滄晠闅滃拰鑷劧鐏惧

#### 鍦烘櫙锛氭仮澶嶇洰鏍?- **褰?*瀹氫箟鎭㈠鐩爣鏃?- **鍒?*杩愮淮浜哄憳搴斿皢RTO锛堟仮澶嶆椂闂寸洰鏍囷級璁剧疆涓?灏忔椂锛屽皢RPO锛堟仮澶嶇偣鐩爣锛夎缃负1灏忔椂

#### 鍦烘櫙锛氭仮澶嶇▼搴?- **褰?*鎵ц鐏鹃毦鎭㈠鏃?- **鍒?*杩愮淮浜哄憳搴旇瘎浼板奖鍝嶏紝婵€娲荤伨闅炬仮澶嶈鍒掞紝鎭㈠澶囦唤璁炬柦锛屾仮澶嶆暟鎹紝楠岃瘉绯荤粺鍔熻兘锛屽苟鎭㈠鏈嶅姟

## 鐜瑕佹眰

### 鏈嶅姟鍣ㄨ姹?
| 鐜绫诲瀷 | 鏈嶅姟鍣ㄩ厤缃?| 鎿嶄綔绯荤粺 |
|----------|------------|----------|
| 寮€鍙戠幆澧?| 4C8G       | Ubuntu 22.04/Windows 10+ |
| 娴嬭瘯鐜 | 8C16G      | Ubuntu 22.04/Windows 10+ |
| 鐢熶骇鐜 | 16C32G     | Ubuntu 22.04 |

### 杞欢瑕佹眰

| 杞欢 | 鐗堟湰 | 鐢ㄩ€?|
|------|------|------|
| Node.js | 16.0.0+ | 鍚庣寮€鍙戝拰杩愯鏃?|
| npm | 8.0.0+ | 鍖呯鐞?|
| 寰俊寮€鍙戣€呭伐鍏?| 鍥哄畾鐗?| 灏忕▼搴忓紑鍙戝拰娴嬭瘯 |
| MySQL | 8.0+ | 鍏崇郴鍨嬫暟鎹簱 |
| Redis | 6.0+ | 缂撳瓨鍜屼細璇濈鐞?|
| MongoDB | 4.4+ | 鐢ㄤ簬鏃ュ織鍜屾椿鍔ㄧ殑NoSQL鏁版嵁搴?|
| Docker | 20.0.0+ | 瀹瑰櫒鍖?|
| Docker Compose | 2.0.0+ | 寮€鍙戠幆澧冨鍣ㄧ紪鎺?|
| Kubernetes | 1.20.0+ | 鐢熶骇鐜瀹瑰櫒缂栨帓 |

## 绯荤粺閰嶇疆

### 鐜鍙橀噺閰嶇疆

椤圭洰浣跨敤`.env`鏂囦欢瀛樺偍鐜鍙橀噺銆備笅闈㈡槸涓€涓ず渚嬮厤缃細

```dotenv
# 鏈嶅姟鍣ㄩ厤缃?PORT=3000
HOST=localhost
NODE_ENV=development

# 鏁版嵁搴撻厤缃?DB_HOST=localhost
DB_PORT=3306
DB_USER=sutwxapp
DB_PASSWORD=password
DB_NAME=sutwxapp

# Redis閰嶇疆
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# 寰俊灏忕▼搴忛厤缃?APPID=wx1234567890abcdef
APPSECRET=1234567890abcdef1234567890abcdef

# JWT閰嶇疆
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# 鏂囦欢涓婁紶閰嶇疆
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
```

### 閰嶇疆椤硅鏄?
| 閰嶇疆椤?| 绫诲瀷 | 榛樿鍊?| 鎻忚堪 |
|--------|------|--------|------|
| PORT | Number | 3000 | 鏈嶅姟鍣ㄧ鍙?|
| HOST | String | localhost | 鏈嶅姟鍣ㄤ富鏈?|
| NODE_ENV | String | development | 杩愯鐜 (development/production/test) |
| DB_HOST | String | localhost | 鏁版嵁搴撲富鏈?|
| DB_PORT | Number | 3306 | 鏁版嵁搴撶鍙?|
| DB_USER | String | sutwxapp | 鏁版嵁搴撶敤鎴峰悕 |
| DB_PASSWORD | String | password | 鏁版嵁搴撳瘑鐮?|
| DB_NAME | String | sutwxapp | 鏁版嵁搴撳悕绉?|
| REDIS_HOST | String | localhost | Redis涓绘満 |
| REDIS_PORT | Number | 6379 | Redis绔彛 |
| REDIS_PASSWORD | String | | Redis瀵嗙爜 |
| APPID | String | | 寰俊灏忕▼搴廇PPID |
| APPSECRET | String | | 寰俊灏忕▼搴廇PPSECRET |
| JWT_SECRET | String | | JWT瀵嗛挜 |
| JWT_EXPIRES_IN | String | 7d | JWT杩囨湡鏃堕棿 |
| UPLOAD_PATH | String | ./uploads | 鏂囦欢涓婁紶璺緞 |
| MAX_FILE_SIZE | Number | 5242880 | 鏈€澶ф枃浠跺ぇ灏忥紙瀛楄妭锛?|

### 閰嶇疆姝ラ

1. **澶嶅埗閰嶇疆鏂囦欢**
   ```bash
   cp .env.example .env
   ```

2. **缂栬緫閰嶇疆鏂囦欢**
   ```bash
   nano .env
   ```
   鏍规嵁瀹為檯鐜淇敼閰嶇疆椤广€?
3. **閲嶅惎鏈嶅姟**
   淇敼閰嶇疆鍚庯紝閲嶅惎鏈嶅姟浣块厤缃敓鏁堬細
   ```bash
   npm run server
   ```

### 閰嶇疆楠岃瘉

- **鏁版嵁搴撹繛鎺?*锛氭鏌ユ棩蹇椾腑鏄惁鏈?Database connected successfully"淇℃伅
- **Redis杩炴帴**锛氭鏌ユ棩蹇椾腑鏄惁鏈?Redis connected successfully"淇℃伅
- **寰俊灏忕▼搴忛厤缃?*锛氶€氳繃灏濊瘯浠庡皬绋嬪簭鐧诲綍鏉ラ獙璇?
## 鏉冮檺绠＄悊

### 鏉冮檺绠＄悊鍘熷垯

- **鏈€灏忔潈闄愬師鍒?*锛氱敤鎴峰彧鎷ユ湁瀹屾垚宸ヤ綔鎵€闇€鐨勬渶灏忔潈闄?- **鑱岃矗鍒嗙鍘熷垯**锛氫笉鍚岃亴璐ｇ殑鐢ㄦ埛鎷ユ湁涓嶅悓鐨勬潈闄?- **鏉冮檺瀹¤鍘熷垯**锛氭墍鏈夋潈闄愭搷浣滈兘琚褰?- **瀹氭湡瀹℃煡鍘熷垯**锛氬畾鏈熷鏌ョ敤鎴锋潈闄愶紝纭繚鍏跺悎鐞嗘€?
### 瑙掕壊瀹氫箟

| 瑙掕壊鍚嶇О | 鎻忚堪 |
|----------|------|
| 瓒呯骇绠＄悊鍛?| 鎷ユ湁鎵€鏈夌郴缁熸潈闄?|
| 绠＄悊鍛?| 鎷ユ湁绯荤粺绠＄悊鏉冮檺锛屽寘鎷敤鎴风鐞嗗拰瑙掕壊绠＄悊 |
| 寮€鍙戜汉鍛?| 鎷ユ湁寮€鍙戞潈闄愶紝鍖呮嫭浠ｇ爜鎻愪氦鍜屾祴璇?|
| 鏅€氱敤鎴?| 鎷ユ湁鍩烘湰浣跨敤鏉冮檺 |

### 鏉冮檺鍒嗙被

| 鏉冮檺鍒嗙被 | 鎻忚堪 |
|----------|------|
| 绯荤粺绠＄悊 | 鍖呮嫭鐢ㄦ埛绠＄悊銆佽鑹茬鐞嗗拰绯荤粺閰嶇疆 |
| 鍐呭绠＄悊 | 鍖呮嫭浜у搧绠＄悊銆佽鍗曠鐞嗗拰鍐呭鍙戝竷 |
| 鏁版嵁鍒嗘瀽 | 鍖呮嫭鏁版嵁缁熻鍜屾姤鍛婄敓鎴?|
| 寮€鍙戞潈闄?| 鍖呮嫭浠ｇ爜鎻愪氦銆佹祴璇曞拰閮ㄧ讲 |

### 鏉冮檺鍒嗛厤娴佺▼

1. 鍒涘缓瑙掕壊骞跺畾涔夊叾鏉冮檺
2. 鍒涘缓鐢ㄦ埛骞跺皢鍏跺垎閰嶅埌閫傚綋鐨勮鑹?3. 鐢ㄦ埛浠庡叾瑙掕壊缁ф壙鏉冮檺

### 鏉冮檺绠＄悊鎿嶄綔

#### 瑙掕壊绠＄悊

1. **鍒涘缓瑙掕壊**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"瑙掕壊绠＄悊"椤甸潰
   - 鐐瑰嚮"鍒涘缓瑙掕壊"鎸夐挳
   - 濉啓瑙掕壊鍚嶇О銆佹弿杩板拰鏉冮檺
   - 鐐瑰嚮"淇濆瓨"鎸夐挳

2. **缂栬緫瑙掕壊**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"瑙掕壊绠＄悊"椤甸潰
   - 鎵惧埌瑕佺紪杈戠殑瑙掕壊骞剁偣鍑?缂栬緫"鎸夐挳
   - 淇敼瑙掕壊鍚嶇О銆佹弿杩板拰鏉冮檺
   - 鐐瑰嚮"淇濆瓨"鎸夐挳

3. **鍒犻櫎瑙掕壊**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"瑙掕壊绠＄悊"椤甸潰
   - 鎵惧埌瑕佸垹闄ょ殑瑙掕壊骞剁偣鍑?鍒犻櫎"鎸夐挳
   - 纭鍒犻櫎

#### 鐢ㄦ埛绠＄悊

1. **鍒涘缓鐢ㄦ埛**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"鐢ㄦ埛绠＄悊"椤甸潰
   - 鐐瑰嚮"鍒涘缓鐢ㄦ埛"鎸夐挳
   - 濉啓鐢ㄦ埛淇℃伅锛屽寘鎷敤鎴峰悕銆佸瘑鐮佸拰閭
   - 閫夋嫨鐢ㄦ埛瑙掕壊
   - 鐐瑰嚮"淇濆瓨"鎸夐挳

2. **缂栬緫鐢ㄦ埛**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"鐢ㄦ埛绠＄悊"椤甸潰
   - 鎵惧埌瑕佺紪杈戠殑鐢ㄦ埛骞剁偣鍑?缂栬緫"鎸夐挳
   - 淇敼鐢ㄦ埛淇℃伅鍜岃鑹?   - 鐐瑰嚮"淇濆瓨"鎸夐挳

3. **鍒犻櫎鐢ㄦ埛**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"鐢ㄦ埛绠＄悊"椤甸潰
   - 鎵惧埌瑕佸垹闄ょ殑鐢ㄦ埛骞剁偣鍑?鍒犻櫎"鎸夐挳
   - 纭鍒犻櫎

4. **閲嶇疆瀵嗙爜**
   - 鐧诲綍绯荤粺绠＄悊鍚庡彴
   - 杩涘叆"鐢ㄦ埛绠＄悊"椤甸潰
   - 鎵惧埌瑕侀噸缃瘑鐮佺殑鐢ㄦ埛骞剁偣鍑?閲嶇疆瀵嗙爜"鎸夐挳
   - 杈撳叆鏂板瘑鐮?   - 鐐瑰嚮"淇濆瓨"鎸夐挳

### 鏉冮檺瀹¤

#### 鏃ュ織璁板綍

绯荤粺璁板綍鎵€鏈変笌鏉冮檺鐩稿叧鐨勬搷浣滐紝鍖呮嫭锛?- 鐢ㄦ埛鐧诲綍/鐧诲嚭
- 瑙掕壊鍒涘缓/缂栬緫/鍒犻櫎
- 鐢ㄦ埛鍒涘缓/缂栬緫/鍒犻櫎
- 鏉冮檺鍒嗛厤/淇敼

#### 鏃ュ織鏌ヨ

1. 鐧诲綍绯荤粺绠＄悊鍚庡彴
2. 杩涘叆"鏃ュ織绠＄悊"椤甸潰
3. 閫夋嫨鏌ヨ鏉′欢锛屽寘鎷椂闂磋寖鍥淬€佹搷浣滅被鍨嬪拰鐢ㄦ埛
4. 鐐瑰嚮"鏌ヨ"鎸夐挳
5. 鏌ョ湅鏌ヨ缁撴灉

## 绯荤粺鏋舵瀯

### 鎬讳綋鏋舵瀯
```
+----------------+    +----------------+    +----------------+    +----------------+
| 寰俊灏忕▼搴?    |    |      Nginx      |    |   Node.js API   |    |    MySQL       |
|  (鍓嶇)        |    |  鍙嶅悜浠ｇ悊/      |    |    鏈嶅姟         |    |                |
|                |    |   璐熻浇鍧囪　鍣?   |    |                 |    |                |
+----------------+    +----------------+    +----------------+    +----------------+
         |                     |                        |                     |
         |                     |                        |                     |
         |                     |                        |                     |
         |                     |                        |                     |
+----------------+    +----------------+    +----------------+    +----------------+
|  CDN璧勬簮       |    |      Redis      |    |    MongoDB      |    | 绗笁鏂规湇鍔?    |
|                |    |  缂撳瓨/浼氳瘽绠＄悊  |    |  鏃ュ織/娲诲姩鏁版嵁  |    | (寰俊鏀粯,     |
|                |    |                |    |                |    |  鐗╂祦)         |
+----------------+    +----------------+    +----------------+    +----------------+
```

### 鐜閰嶇疆

| 鐜绫诲瀷 | 鏈嶅姟鍣ㄩ厤缃?| 鎿嶄綔绯荤粺 | 閮ㄧ讲鏂瑰紡 |
|----------|------------|----------|----------|
| 寮€鍙戠幆澧?| 4C8G       | Ubuntu 22.04 | Docker Compose |
| 娴嬭瘯鐜 | 8C16G      | Ubuntu 22.04 | Docker Compose |
| 鐢熶骇鐜 | 16C32G     | Ubuntu 22.04 | Kubernetes |

## 閮ㄧ讲娴佺▼

### 寮€鍙戠幆澧冮儴缃?
1. **瀹夎渚濊禆**
   ```bash
   # 瀹夎Docker
   curl -fsSL https://get.docker.com -o get-docker.sh
   sh get-docker.sh
   
   # 瀹夎Docker Compose
   curl -L "https://github.com/docker/compose/releases/download/v2.20.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
   chmod +x /usr/local/bin/docker-compose
   ```

2. **鍏嬮殕浠撳簱**
   ```bash
   git clone https://github.com/sutchan/SutWxApp.git
   cd SutWxApp
   ```

3. **閰嶇疆鐜**
   ```bash
   cp .env.example .env
   # 缂栬緫.env鏂囦欢閰嶇疆鏁版嵁搴撹繛鎺ャ€丷edis杩炴帴绛?   ```

4. **鍚姩鏈嶅姟**
   ```bash
   docker-compose up -d
   ```

5. **楠岃瘉閮ㄧ讲**
   ```bash
   # 妫€鏌ユ湇鍔＄姸鎬?   docker-compose ps
   
   # 娴嬭瘯API鏈嶅姟
   curl http://localhost:3000/api/v1/health
   
   # 鏌ョ湅鏃ュ織
   docker-compose logs -f
   ```

### 鐢熶骇鐜閮ㄧ讲

1. **鍑嗗鐜**
   - 浣跨敤kubeadm瀹夎Kubernetes闆嗙兢
   - 閰嶇疆缃戠粶鎻掍欢锛堜緥濡傦紝Calico锛?   - 閰嶇疆瀛樺偍绫伙紙渚嬪锛孋eph銆丒FS锛?   - 瀹夎Helm
   ```bash
   curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
   ```

2. **閰嶇疆CI/CD娴佹按绾?*
   - 浣跨敤Jenkins鎴朑itLab CI杩涜鑷姩鍖栭儴缃?   - 閰嶇疆Docker闀滃儚浠撳簱锛堜緥濡傦紝Harbor銆丏ocker Hub锛?
3. **閮ㄧ讲搴旂敤**
   ```bash
   # 鍒涘缓鍛藉悕绌洪棿
   kubectl create namespace sutwxapp
   
   # 閮ㄧ讲MySQL
   helm repo add bitnami https://charts.bitnami.com/bitnami
   helm install mysql bitnami/mysql -n sutwxapp -f mysql-values.yaml
   
   # 閮ㄧ讲Redis
   helm install redis bitnami/redis -n sutwxapp -f redis-values.yaml
   
   # 閮ㄧ讲MongoDB
   helm install mongodb bitnami/mongodb -n sutwxapp -f mongodb-values.yaml
   
   # 鏋勫缓骞舵帹閫丄PI闀滃儚
   docker build -t sutwxapp-api:v1.0.0 .
   docker push sutwxapp-api:v1.0.0
   
   # 閮ㄧ讲API鏈嶅姟
   kubectl apply -f k8s/api-deployment.yaml -n sutwxapp
   kubectl apply -f k8s/api-service.yaml -n sutwxapp
   
   # 閮ㄧ讲Nginx Ingress
   kubectl apply -f k8s/nginx-ingress.yaml -n sutwxapp
   ```

4. **楠岃瘉閮ㄧ讲**
   ```bash
   # 妫€鏌ods
   kubectl get pods -n sutwxapp
   
   # 妫€鏌ユ湇鍔?   kubectl get services -n sutwxapp
   
   # 娴嬭瘯API鏈嶅姟
   curl https://api.sutwxapp.com/api/v1/health
   ```

## 鏃ュ父杩愮淮

### 绯荤粺鐩戞帶

#### 鐩戞帶鎸囨爣
- **鏈嶅姟鍣ㄦ寚鏍?*锛欳PU浣跨敤鐜囥€佸唴瀛樹娇鐢ㄧ巼銆佺鐩樹娇鐢ㄧ巼銆佺綉缁滄祦閲?- **搴旂敤鎸囨爣**锛欰PI鍝嶅簲鏃堕棿銆佽姹傛垚鍔熺巼銆佸苟鍙戣繛鎺ユ暟銆侀敊璇巼
- **鏁版嵁搴撴寚鏍?*锛氭煡璇㈠搷搴旀椂闂淬€佽繛鎺ユ暟銆佺紦瀛樺懡涓巼銆佹煡璇㈤噺

#### 鐩戞帶宸ュ叿
- **Prometheus**锛氭寚鏍囨敹闆?- **Grafana**锛氭寚鏍囧彲瑙嗗寲
- **Alertmanager**锛氬憡璀︾鐞?
#### 鍛婅瑙勫垯

| 鍛婅绫诲瀷 | 闃堝€?| 涓ラ噸绋嬪害 | 閫氱煡鏂瑰紡 |
|----------|------|----------|----------|
| CPU浣跨敤鐜?| >80% | 璀﹀憡 | 閭欢銆丼lack |
| 鍐呭瓨浣跨敤鐜?| >85% | 璀﹀憡 | 閭欢銆丼lack |
| 纾佺洏浣跨敤鐜?| >90% | 涓ラ噸 | 閭欢銆丼lack銆佺數璇?|
| API鍝嶅簲鏃堕棿 | >2s | 璀﹀憡 | 閭欢銆丼lack |
| 璇锋眰閿欒鐜?| >5% | 涓ラ噸 | 閭欢銆丼lack銆佺數璇?|

### 鏃ュ織绠＄悊

#### 鏃ュ織绫诲瀷
- **搴旂敤鏃ュ織**锛歂ode.js API鏈嶅姟鏃ュ織
- **鏁版嵁搴撴棩蹇?*锛歁ySQL銆丷edis銆丮ongoDB鏃ュ織
- **Nginx鏃ュ織**锛氳闂棩蹇椼€侀敊璇棩蹇?- **绯荤粺鏃ュ織**锛氭湇鍔″櫒绯荤粺鏃ュ織

#### 鏃ュ織鏀堕泦
浣跨敤ELK Stack杩涜鏃ュ織绠＄悊锛?- **Logstash**锛氫粠鍚勭鏉ユ簮鏀堕泦鏃ュ織
- **Elasticsearch**锛氬瓨鍌ㄦ棩蹇楁暟鎹?- **Kibana**锛氭煡璇㈠拰鍙鍖栨棩蹇楁暟鎹?
#### 鏃ュ織淇濈暀
- 璁剧疆鏃ュ織淇濈暀绛栫暐涓?0澶?- 瀹氭湡娓呯悊杩囨湡鏃ュ織

### 鏁版嵁澶囦唤

#### 澶囦唤璁″垝

| 鏁版嵁绫诲瀷 | 澶囦唤棰戠巼 | 澶囦唤鏂规硶 | 淇濈暀鏈熼檺 |
|----------|----------|----------|----------|
| MySQL鏁版嵁 | 姣忔棩 | 鍏ㄩ噺澶囦唤 | 30澶?|
| Redis鏁版嵁 | 姣忓皬鏃?| 蹇収 | 7澶?|
| MongoDB鏁版嵁 | 姣忔棩 | 鍏ㄩ噺澶囦唤 | 30澶?|
| 閰嶇疆鏂囦欢 | 姣忔鏇存敼 | 鐗堟湰鎺у埗 | 姘镐箙 |

#### 澶囦唤鍛戒护

1. **MySQL澶囦唤**
   ```bash
   mysqldump -u root -p --all-databases > mysql_backup_$(date +%Y%m%d).sql
   ```

2. **Redis澶囦唤**
   ```bash
   redis-cli BGSAVE
   ```

3. **MongoDB澶囦唤**
   ```bash
   mongodump --out mongodb_backup_$(date +%Y%m%d)
   ```

#### 鎭㈠鍛戒护

1. **MySQL鎭㈠**
   ```bash
   mysql -u root -p < mysql_backup_20251130.sql
   ```

2. **Redis鎭㈠**
   ```bash
   cp dump.rdb /var/lib/redis/
   systemctl restart redis
   ```

3. **MongoDB鎭㈠**
   ```bash
   mongorestore --dir mongodb_backup_20251130
   ```

### 瀹夊叏绠＄悊

1. **瀹氭湡绯荤粺鏇存柊**
   ```bash
   apt update && apt upgrade -y
   ```

2. **闃茬伀澧欓厤缃?*
   ```bash
   ufw allow 22/tcp
   ufw allow 80/tcp
   ufw allow 443/tcp
   ufw enable
   ```

3. **HTTPS閰嶇疆**
   - 閰嶇疆SSL璇佷功
   - 鍚敤HTTPS璁块棶

4. **瀹氭湡瀹夊叏鎵弿**
   ```bash
   # 浣跨敤nmap杩涜绔彛鎵弿
   nmap -sV -p- 192.168.1.100
   
   # 浣跨敤OpenVAS杩涜婕忔礊鎵弿
   openvas-start
   ```

## 鏁呴殰澶勭悊

### 甯歌鏁呴殰

#### API鏈嶅姟涓嶅彲鐢?**鐥囩姸**锛?- API璇锋眰杩斿洖500閿欒
- 鐩戞帶鍛婅鏄剧ずAPI鏈嶅姟涓嶅彲鐢?
**澶勭悊娴佺▼**锛?1. 妫€鏌PI鏈嶅姟鏃ュ織
   ```bash
   docker-compose logs api
   # 鎴?   kubectl logs -f deployment/api -n sutwxapp
   ```

2. 楠岃瘉鏁版嵁搴撹繛鎺?   ```bash
   mysql -u root -p -h localhost
   redis-cli ping
   mongo
   ```

3. 妫€鏌ユ湇鍔″櫒璧勬簮
   ```bash
   top
   df -h
   ```

4. 閲嶅惎API鏈嶅姟
   ```bash
   docker-compose restart api
   # 鎴?   kubectl rollout restart deployment/api -n sutwxapp
   ```

#### 鏁版嵁搴撹繛鎺ュけ璐?**鐥囩姸**锛?- API鏈嶅姟鏃ュ織鏄剧ず鏁版嵁搴撹繛鎺ュけ璐?- 搴旂敤鏃犳硶璁块棶鏁版嵁搴?
**澶勭悊娴佺▼**锛?1. 妫€鏌ユ暟鎹簱鏈嶅姟鐘舵€?   ```bash
   systemctl status mysql
   systemctl status redis
   systemctl status mongod
   ```

2. 楠岃瘉杩炴帴閰嶇疆
   ```bash
   cat .env
   ```

3. 妫€鏌ユ暟鎹簱鏉冮檺
   ```bash
   mysql -u root -p -e "SHOW GRANTS FOR 'sutwxapp'@'%';"
   ```

4. 閲嶅惎鏁版嵁搴撴湇鍔?   ```bash
   systemctl restart mysql
   ```

#### CPU浣跨敤鐜囬珮
**鐥囩姸**锛?- 鐩戞帶鍛婅鏄剧ずCPU浣跨敤鐜囬珮
- 绯荤粺鍝嶅簲缂撴參

**澶勭悊娴佺▼**锛?1. 璇嗗埆鍗犵敤CPU鏈€楂樼殑杩涚▼
   ```bash
   top
   ```

2. 鍒嗘瀽CPU浣跨敤鐜囬珮鐨勫師鍥?   ```bash
   # 浣跨敤strace鍒嗘瀽杩涚▼
   strace -p <pid>
   
   # 浣跨敤perf鍒嗘瀽鎬ц兘
   perf top -p <pid>
   ```

3. 浼樺寲搴旂敤浠ｇ爜鎴栧鍔犳湇鍔″櫒璧勬簮

### 鏁呴殰璁板綍

姣忔鏁呴殰澶勭悊鍚庯紝璁板綍浠ヤ笅淇℃伅锛?
| 瀛楁 | 鎻忚堪 |
|------|------|
| 鏁呴殰鏃堕棿 | 鏁呴殰鍙戠敓鐨勬椂闂?|
| 鏁呴殰绫诲瀷 | 鏁呴殰绫诲瀷 |
| 鏁呴殰鎻忚堪 | 鏁呴殰鐨勮缁嗘弿杩?|
| 褰卞搷鑼冨洿 | 鍙楁晠闅滃奖鍝嶇殑鑼冨洿 |
| 澶勭悊娴佺▼ | 璇︾粏鐨勫鐞嗘楠?|
| 鏍规湰鍘熷洜 | 鏁呴殰鐨勬牴鏈師鍥?|
| 棰勯槻鎺柦 | 闃叉绫讳技鏁呴殰鐨勬帾鏂?|
| 澶勭悊浜?| 澶勭悊鏁呴殰鐨勪汉鍛?|

## 绯荤粺鍗囩骇

### 鍗囩骇娴佺▼

1. **鍑嗗**锛?   - 澶囦唤鏁版嵁
   - 娴嬭瘯鍗囩骇鐗堟湰
   - 瀹氫箟鍥炴粴璁″垝

2. **鍗囩骇鎵ц**锛?   - 鍋滄褰撳墠鏈嶅姟
   - 閮ㄧ讲鏂版湇鍔?   - 鎵ц鏁版嵁搴撹縼绉?   - 鍚姩鏂版湇鍔?   - 楠岃瘉鍗囩骇缁撴灉

3. **鍥炴粴璁″垝**锛?   - 濡傛灉鍗囩骇澶辫触锛屽仠姝㈡柊鏈嶅姟
   - 鎭㈠鏃ф湇鍔?   - 鎭㈠鏁版嵁澶囦唤

### 鐗堟湰鍙戝竷

1. **鐗堟湰鍛藉悕**锛氫娇鐢ㄨ涔夊寲鐗堟湰鎺у埗锛圡AJOR.MINOR.PATCH锛?2. **鍙戝竷璇存槑**锛氱紪鍐欒缁嗙殑鍙戝竷璇存槑锛屽寘鎷柊鍔熻兘銆侀敊璇慨澶嶅拰鍗囩骇璇存槑
3. **鍙戝竷娴佺▼**锛?   - 浠ｇ爜瀹℃煡
   - 鑷姩鍖栨祴璇?   - 鏋勫缓闀滃儚
   - 閮ㄧ讲鍒版祴璇曠幆澧?   - 娴嬭瘯楠岃瘉
   - 閮ㄧ讲鍒扮敓浜х幆澧?
## 鐏鹃毦鎭㈠

### 鐏鹃毦绫诲瀷
- 鏈嶅姟鍣ㄦ晠闅?- 鏁版嵁搴撴晠闅?- 缃戠粶鏁呴殰
- 鑷劧鐏惧

### 鎭㈠鐩爣
- **RTO锛堟仮澶嶆椂闂寸洰鏍囷級**锛?灏忔椂
- **RPO锛堟仮澶嶇偣鐩爣锛?*锛?灏忔椂

### 鎭㈠娴佺▼
1. **璇勪及褰卞搷**锛氳瘎浼扮伨闅剧殑绋嬪害鍙婂叾褰卞搷
2. **婵€娲绘仮澶嶈鍒?*锛氬惎鍔ㄩ瀹氫箟鐨勭伨闅炬仮澶嶇▼搴?3. **鎭㈠澶囦唤璁炬柦**锛氳缃浠芥湇鍔″櫒鍜屽熀纭€璁炬柦
4. **鎭㈠鏁版嵁**锛氫粠澶囦唤涓仮澶嶆暟鎹?5. **楠岃瘉绯荤粺鍔熻兘**锛氭祴璇曟墍鏈夌郴缁熺粍浠?6. **鎭㈠鏈嶅姟**锛氶€愭鍚戠敤鎴锋仮澶嶆湇鍔?
### 澶囦唤鍜屾仮澶?
1. **鏁版嵁澶囦唤**锛?   - 寮傚湴澶囦唤
   - 鏁版嵁搴撲富浠庡鍒?   - 鏁版嵁鍚屾

2. **鏈嶅姟澶囦唤**锛?   - 澶氬彲鐢ㄥ尯閮ㄧ讲
   - 璐熻浇鍧囪　
   - 鑷姩鏁呴殰杞Щ

## 甯哥敤鍛戒护

### Docker鍛戒护
```bash
# 妫€鏌ュ鍣ㄧ姸鎬?docker ps

# 鏌ョ湅瀹瑰櫒鏃ュ織
docker logs -f <container_id>

# 杩涘叆瀹瑰櫒
docker exec -it <container_id> bash
```

### Kubernetes鍛戒护
```bash
# 妫€鏌od鐘舵€?kubectl get pods

# 妫€鏌ユ湇鍔＄姸鎬?kubectl get services

# 鏌ョ湅鏃ュ織
kubectl logs -f <pod_name>
```

### 鏁版嵁搴撳懡浠?```bash
# 妫€鏌ySQL杩涚▼
mysqladmin -u root -p processlist

# 妫€鏌edis淇℃伅
redis-cli info

# 妫€鏌ongoDB鐘舵€?mongo --eval "db.stats()"
```

## 閰嶇疆鏂囦欢

- **.env**锛氱幆澧冨彉閲忛厤缃?- **docker-compose.yml**锛欴ocker Compose閰嶇疆
- **k8s/**锛欿ubernetes閰嶇疆鏂囦欢

## 鑱旂郴鏂瑰紡

| 瑙掕壊 | 濮撳悕 | 閭 | 鐢佃瘽 |
|------|------|------|------|
| 杩愮淮鏀寔 | Sut | sut@example.com | 13800138000 |
| 寮€鍙戣礋璐ｄ汉 | Dev | dev@example.com | 13800138001 |
| 绯荤粺绠＄悊鍛?| Admin | admin@example.com | 13800138002 |