<!--
文件名: spec.md
版本号: 1.0.0
更新日期: 2025-12-26
作者: Sut
描述: 苏铁微信小程序功能规范，详细定义各功能模块的需求和实现标准
-->

# 功能规范

## 目录

[TOC]

## 1. 概述

### 1.1 文档目的

本文档定义了苏铁微信小程序（SutWxApp）的功能规范，详细描述各功能模块的需求、实现标准和质量要求，确保开发团队对功能有一致的理解和执行标准。

### 1.2 适用范围

本文档适用于 SutWxApp 项目的所有功能开发、测试和验收工作，包括但不限于：

- 商品管理功能
- 用户管理功能
- 订单管理功能
- 积分系统功能
- 社交功能
- 支付功能
- 消息通知功能

### 1.3 功能模块概览

| 模块名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|--------|------|
| 商品管理 | 商品浏览、搜索、详情展示 | P0 | 已完成 |
| 用户管理 | 注册登录、个人信息管理 | P0 | 已完成 |
| 订单管理 | 下单、支付、订单跟踪 | P0 | 进行中 |
| 积分系统 | 积分获取、使用、兑换 | P1 | 已完成 |
| 社交功能 | 分享、评论、点赞、关注 | P1 | 已完成 |
| 支付功能 | 微信支付、退款 | P0 | 进行中 |
| 消息通知 | 订单通知、活动通知 | P2 | 待开发 |

## 2. 商品管理功能

### 2.1 商品分类

#### 2.1.1 功能描述

商品分类功能提供多级分类体系，支持用户按类别浏览和筛选商品。

#### 2.1.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-GC-001 | 支持三级商品分类 | P0 | 分类层级清晰，切换流畅 |
| FR-GC-002 | 分类图标和名称展示 | P0 | 图标清晰，名称准确 |
| FR-GC-003 | 分类商品数量显示 | P1 | 数量实时更新 |
| FR-GC-004 | 分类搜索功能 | P1 | 支持关键词搜索 |

#### 2.1.3 交互设计

1. **分类入口**：首页底部导航栏"分类"入口
2. **分类列表**：左侧显示一级分类，右侧显示二级和三级分类
3. **分类切换**：点击一级分类，右侧更新二级和三级分类列表
4. **进入分类**：点击分类进入商品列表页

#### 2.1.4 接口设计

```
GET /api/v1/categories
GET /api/v1/categories/{id}
GET /api/v1/categories/{id}/products
```

### 2.2 商品搜索

#### 2.2.1 功能描述

商品搜索功能支持用户通过关键词搜索商品，提供搜索建议和搜索历史。

#### 2.2.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-GS-001 | 关键词搜索 | P0 | 搜索结果准确，响应时间<1秒 |
| FR-GS-002 | 搜索建议 | P1 | 输入时实时显示建议 |
| FR-GS-003 | 搜索历史 | P1 | 显示最近搜索记录 |
| FR-GS-004 | 搜索结果筛选 | P1 | 支持价格、销量、评分筛选 |

#### 2.2.3 交互设计

1. **搜索入口**：首页顶部搜索框
2. **输入搜索**：用户输入关键词，实时显示搜索建议
3. **执行搜索**：点击搜索按钮或回车执行搜索
4. **结果展示**：以列表形式展示搜索结果

#### 2.2.4 接口设计

```
GET /api/v1/products/search?q={keyword}
GET /api/v1/products/search/suggestions?q={keyword}
```

### 2.3 商品详情

#### 2.3.1 功能描述

商品详情页展示商品的完整信息，包括图片、价格、规格、评价等。

#### 2.3.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-GD-001 | 商品图片展示 | P0 | 支持多图切换和放大 |
| FR-GD-002 | 商品价格和优惠 | P0 | 价格准确，优惠信息清晰 |
| FR-GD-003 | 商品规格选择 | P0 | 规格选择联动库存 |
| FR-GD-004 | 商品评价展示 | P0 | 显示评分和评价内容 |
| FR-GD-005 | 相关商品推荐 | P1 | 推荐相关商品 |
| FR-GD-006 | 商品分享 | P1 | 支持分享到微信 |

#### 2.3.3 交互设计

1. **图片浏览**：左右滑动切换图片，支持双指放大
2. **规格选择**：点击规格弹窗选择，选择后显示价格变化
3. **加入购物车**：选择规格后点击加入购物车
4. **立即购买**：选择规格后点击立即购买跳转结算页
5. **收藏商品**：点击收藏按钮收藏商品

#### 2.3.4 接口设计

```
GET /api/v1/products/{id}
GET /api/v1/products/{id}/reviews
GET /api/v1/products/{id}/related
```

## 3. 用户管理功能

### 3.1 用户注册与登录

#### 3.1.1 功能描述

用户注册与登录功能支持多种登录方式，包括微信授权登录和手机号登录。

#### 3.1.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-UL-001 | 微信授权登录 | P0 | 一键登录，获取用户信息 |
| FR-UL-002 | 手机号验证码登录 | P1 | 验证码发送和验证 |
| FR-UL-003 | 自动注册 | P0 | 新用户自动注册 |
| FR-UL-004 | 登录状态保持 | P0 | 7天免登录 |
| FR-UL-005 | 退出登录 | P0 | 清除登录状态 |

#### 3.1.3 交互设计

1. **授权弹窗**：首次登录弹出微信授权弹窗
2. **获取信息**：用户确认后获取昵称和头像
3. **登录成功**：自动注册并登录，跳转首页
4. **手机登录**：点击"手机号登录"切换登录方式

#### 3.1.4 接口设计

```
POST /api/v1/auth/wechat-login
POST /api/v1/auth/login/phone
POST /api/v1/auth/logout
```

### 3.2 个人中心

#### 3.2.1 功能描述

个人中心展示用户的基本信息和相关功能入口。

#### 3.2.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-UP-001 | 用户头像和昵称展示 | P0 | 信息准确 |
| FR-UP-002 | 会员等级展示 | P0 | 等级和成长值 |
| FR-UP-003 | 订单入口 | P0 | 显示待处理订单数 |
| FR-UP-004 | 积分入口 | P0 | 显示当前积分 |
| FR-UP-005 | 收藏入口 | P1 | 显示收藏数量 |
| FR-UP-006 | 地址管理 | P0 | 新增、编辑、删除地址 |

#### 3.2.3 交互设计

1. **头部信息**：头像、昵称、会员等级
2. **订单中心**：全部、待付款、待发货、待收货、待评价
3. **功能列表**：积分、收藏、地址、设置等

#### 3.2.4 接口设计

```
GET /api/v1/user/info
GET /api/v1/user/addresses
POST /api/v1/user/addresses
PUT /api/v1/user/addresses/{id}
DELETE /api/v1/user/addresses/{id}
```

### 3.3 收货地址管理

#### 3.3.1 功能描述

收货地址管理功能支持用户添加、编辑、删除和设置默认地址。

#### 3.3.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-UA-001 | 新增收货地址 | P0 | 表单完整，验证正确 |
| FR-UA-002 | 编辑收货地址 | P0 | 信息回显，保存成功 |
| FR-UA-003 | 删除收货地址 | P0 | 二次确认后删除 |
| FR-UA-004 | 设置默认地址 | P0 | 默认地址标识 |
| FR-UA-005 | 地址列表展示 | P0 | 清晰展示，默认标识 |

#### 3.3.3 交互设计

1. **地址列表**：卡片式展示地址信息
2. **新增地址**：点击新增按钮进入表单页
3. **编辑地址**：点击地址进入编辑表单
4. **删除地址**：左滑或长按显示删除按钮

#### 3.3.4 接口设计

```
GET /api/v1/user/addresses
POST /api/v1/user/addresses
PUT /api/v1/user/addresses/{id}
DELETE /api/v1/user/addresses/{id}
PUT /api/v1/user/addresses/{id}/default
```

## 4. 订单管理功能

### 4.1 购物车

#### 4.1.1 功能描述

购物车功能支持用户管理待结算的商品，包括选择商品、修改数量、删除商品等。

#### 4.1.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-SC-001 | 购物车列表展示 | P0 | 商品信息完整 |
| FR-SC-002 | 商品数量修改 | P0 | 数量±操作，库存联动 |
| FR-SC-003 | 商品删除 | P0 | 二次确认后删除 |
| FR-SC-004 | 商品选择 | P0 | 单选和全选 |
| FR-SC-005 | 价格计算 | P0 | 实时计算总价 |
| FR-SC-006 | 失效商品提示 | P1 | 过期商品下架提示 |

#### 4.1.3 交互设计

1. **列表展示**：商品图片、名称、规格、价格、数量
2. **数量操作**：点击+和-修改数量
3. **选择操作**：勾选框选择商品
4. **结算按钮**：显示已选商品数量和总价

#### 4.1.4 接口设计

```
GET /api/v1/cart
POST /api/v1/cart/items
PUT /api/v1/cart/items/{id}
DELETE /api/v1/cart/items/{id}
DELETE /api/v1/cart
```

### 4.2 订单创建

#### 4.2.1 功能描述

订单创建功能支持用户确认订单信息并提交订单。

#### 4.2.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-OC-001 | 订单信息确认 | P0 | 商品、地址、价格 |
| FR-OC-002 | 收货地址选择 | P0 | 选择已有地址或新建 |
| FR-OC-003 | 优惠券选择 | P1 | 列出可用优惠券 |
| FR-OC-004 | 备注填写 | P0 | 订单备注 |
| FR-OC-005 | 订单提交 | P0 | 创建订单成功 |

#### 4.2.3 交互设计

1. **订单预览**：显示商品列表、地址、价格信息
2. **地址选择**：点击地址区域选择收货地址
3. **优惠券**：点击选择可用优惠券
4. **提交订单**：点击提交按钮创建订单

#### 4.2.4 接口设计

```
POST /api/v1/orders
GET /api/v1/orders/{id}/preview
GET /api/v1/coupons/available
```

### 4.3 订单支付

#### 4.3.1 功能描述

订单支付功能支持用户使用微信支付完成订单付款。

#### 4.3.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-OP-001 | 发起微信支付 | P0 | 调起微信支付 |
| FR-OP-002 | 支付结果查询 | P0 | 轮询支付状态 |
| FR-OP-003 | 支付超时处理 | P0 | 超时自动取消 |
| FR-OP-004 | 支付成功通知 | P0 | 发送通知 |

#### 4.3.3 交互设计

1. **订单支付页**：显示订单金额，点击支付按钮
2. **微信支付**：确认支付，输入密码
3. **支付结果**：显示成功或失败信息
4. **跳转页**：成功跳转订单详情，失败留在原页

#### 4.3.4 接口设计

```
POST /api/v1/orders/{id}/pay
GET /api/v1/orders/{id}/pay/status
POST /api/v1/orders/{id}/pay/cancel
```

## 5. 积分系统功能

### 5.1 积分获取

#### 5.1.1 功能描述

积分获取功能定义用户获取积分的规则和方式。

#### 5.1.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-PG-001 | 购物得积分 | P0 | 按支付金额计算 |
| FR-PG-002 | 签到得积分 | P1 | 连续签到加成 |
| FR-PG-003 | 分享得积分 | P1 | 分享商品/活动 |
| FR-PG-004 | 评价得积分 | P1 | 提交商品评价 |
| FR-PG-005 | 积分变动通知 | P0 | 实时通知 |

#### 5.1.3 积分规则

| 行为 | 基础积分 | 额外加成 |
|------|---------|---------|
| 购物 | 1元=1积分 | 会员加成最高50% |
| 签到 | 5积分 | 连续7天额外50积分 |
| 分享 | 10积分 | 被访问额外2积分 |
| 评价 | 20积分 | 优质评价额外10积分 |

### 5.2 积分使用

#### 5.2.1 功能描述

积分使用功能定义用户使用积分的方式和规则。

#### 5.2.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-PU-001 | 积分抵扣 | P0 | 100积分=1元 |
| FR-PU-002 | 积分兑换 | P1 | 兑换商品或优惠券 |
| FR-PU-003 | 积分规则展示 | P0 | 显示使用规则 |
| FR-PU-004 | 积分不足提示 | P0 | 积分不足时提示 |

#### 5.2.3 积分抵扣规则

- 每订单最高使用积分不超过订单金额的50%
- 100积分抵扣1元
- 积分不找零

### 5.3 积分查询

#### 5.3.1 功能描述

积分查询功能提供用户查看当前积分和积分明细。

#### 5.3.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-PQ-001 | 当前积分展示 | P0 | 首页和个人中心显示 |
| FR-PQ-002 | 积分明细列表 | P0 | 收支记录完整 |
| FR-PQ-003 | 积分规则查询 | P0 | 展示积分规则 |
| FR-PQ-004 | 积分有效期 | P0 | 显示过期时间 |

#### 5.3.3 接口设计

```
GET /api/v1/points/balance
GET /api/v1/points/history
GET /api/v1/points/rules
```

## 6. 社交功能

### 6.1 商品分享

#### 6.1.1 功能描述

商品分享功能支持用户将商品分享到微信好友和朋友圈。

#### 6.1.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-SS-001 | 分享到好友 | P0 | 跳转微信分享 |
| FR-SS-002 | 分享到朋友圈 | P1 | 生成分享图片 |
| FR-SS-003 | 分享奖励 | P1 | 分享获得积分 |
| FR-SS-004 | 分享统计 | P1 | 记录分享次数 |

### 6.2 商品评价

#### 6.2.1 功能描述

商品评价功能支持用户对已购商品进行评价。

#### 6.2.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-SC-001 | 评价入口 | P0 | 订单完成后可评价 |
| FR-SC-002 | 评分和评论 | P0 | 星级评分和文字评价 |
| FR-SC-003 | 图片评价 | P1 | 支持上传图片 |
| FR-SC-004 | 评价展示 | P0 | 商品详情页展示 |
| FR-SC-005 | 评价回复 | P1 | 商家可回复评价 |

### 6.3 用户关注

#### 6.3.1 功能描述

用户关注功能支持用户关注其他用户，形成社交关系。

#### 6.3.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-SF-001 | 关注用户 | P0 | 点击关注按钮 |
| FR-SF-002 | 取消关注 | P0 | 点击取消关注 |
| FR-SF-003 | 关注列表 | P1 | 查看关注用户 |
| FR-SF-004 | 粉丝列表 | P1 | 查看粉丝用户 |
| FR-SF-005 | 关注状态展示 | P0 | 显示已关注状态 |

## 7. 支付功能

### 7.1 微信支付

#### 7.1.1 功能描述

微信支付功能集成微信支付API，支持用户完成订单支付。

#### 7.1.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-WP-001 | 统一下单 | P0 | 获取支付参数 |
| FR-WP-002 | 调起支付 | P0 | 调起微信支付 |
| FR-WP-003 | 支付结果通知 | P0 | 接收微信通知 |
| FR-WP-004 | 支付查询 | P0 | 查询支付状态 |

#### 7.1.3 接口设计

```
POST /api/v1/pay/wechat/preorder
POST /api/v1/pay/wechat/notify
GET /api/v1/pay/wechat/query/{orderId}
```

### 7.2 退款功能

#### 7.2.1 功能描述

退款功能支持用户申请退款，处理退款流程。

#### 7.2.2 功能需求

| 需求编号 | 需求描述 | 优先级 | 验收标准 |
|---------|---------|--------|----------|
| FR-RE-001 | 申请退款 | P0 | 填写退款原因 |
| FR-RE-002 | 退款审核 | P0 | 商家审核退款 |
| FR-RE-003 | 退款处理 | P0 | 原路退回微信 |
| FR-RE-004 | 退款查询 | P0 | 查看退款状态 |

## 8. 消息通知功能

### 8.1 订单通知

#### 8.1.1 功能描述

订单通知功能通过微信订阅消息通知用户订单状态变化。

#### 8.1.2 通知类型

| 通知类型 | 触发条件 | 通知内容 |
|---------|---------|----------|
| 订单发货 | 商家发货 | 物流单号和查询链接 |
| 订单签收 | 用户签收 | 确认收货提醒 |
| 评价提醒 | 订单完成 | 评价商品邀请 |
| 退款结果 | 退款处理完成 | 退款金额和到账时间 |

### 8.2 活动通知

#### 8.2.1 功能描述

活动通知功能推送促销活动和优惠信息给用户。

#### 8.2.2 通知类型

| 通知类型 | 触发条件 | 通知内容 |
|---------|---------|----------|
| 优惠提醒 | 优惠券即将过期 | 优惠信息和使用链接 |
| 促销活动 | 活动开始 | 活动内容和参与方式 |
| 积分变动 | 积分变动 | 变动说明和当前积分 |

## 9. 性能要求

### 9.1 响应时间

| 操作类型 | 最大响应时间 |
|---------|-------------|
| 页面加载 | 3秒 |
| 接口请求 | 1秒 |
| 图片加载 | 2秒 |
| 搜索响应 | 500毫秒 |

### 9.2 可用性

| 指标 | 要求 |
|------|------|
| 系统可用性 | 99.9% |
| 页面崩溃率 | <0.1% |
| 接口成功率 | >99% |

## 10. 安全要求

### 10.1 数据安全

- 用户敏感信息加密存储
- 传输过程使用HTTPS
- 防止SQL注入和XSS攻击

### 10.2 接口安全

- 身份认证：JWT Token
- 权限控制：RBAC
- 频率限制：防止恶意请求

## 11. 版本历史

| 版本号 | 更新日期 | 更新内容 | 作者 |
|--------|----------|----------|------|
| 1.0.0 | 2025-12-26 | 初始版本，完成功能规范文档 | Sut |
