<!--
文件名: spec.md
版本号: 1.0.0
更新日期: 2025-12-27
作者: Sut
描述: SutWxApp 项目用户指南文档，涵盖开发者指南和用户操作手册，帮助开发人员快速上手开发工作，帮助用户了解小程序的使用方法
-->

# 用户指南

## 概述

本指南为苏铁微信小程序（SutWxApp）项目提供全面的使用说明，旨在帮助两类读者快速上手：一是为新加入项目组的开发人员提供开发环境搭建、代码结构说明和开发流程指导；二是为小程序的实际用户提供功能操作指南和常见问题解答。本指南与开发规范文档形成互补，开发规范侧重于代码编写规范和开发流程约束，而本指南侧重于实际操作的步骤说明和功能介绍。

苏铁微信小程序是一款面向普通消费者的电商微信小程序，专注于提供优质的商品和服务。平台集成了商品浏览、购物车管理、订单处理、支付集成、积分系统和用户中心等核心功能模块，为用户提供便捷的购物体验。开发人员通过阅读本指南可以快速了解项目的技术架构和代码组织方式；用户通过阅读本指南可以掌握小程序各功能模块的使用方法。

## 第一部分：开发者指南

### 项目简介

苏铁微信小程序采用微信小程序原生框架开发，前端使用 TypeScript 语言编写，后端采用 Bun 1.x 运行时配合 Hono 框架构建 RESTful API 服务。数据存储层使用 MySQL、Redis 和 MongoDB 三种数据库，分别处理关系型数据、缓存数据和文档型数据。项目遵循模块化设计原则，将功能拆分为用户模块、商品模块、订单模块、积分模块、支付模块、物流模块和客服模块等独立模块，各模块之间通过服务层进行通信，保持低耦合高内聚的特性。

项目的技术栈选择充分考虑了性能和开发效率。Bun 作为 JavaScript 运行时，提供了比 Node.js 更快的启动速度和执行性能，同时内置了包管理器、测试框架和打包工具，简化了开发工具链。TypeScript 的类型系统为代码提供了更好的可维护性和 IDE 支持，减少运行时错误。WeUI 组件库提供了符合微信设计规范的 UI 组件，加速界面开发的同时保证了用户体验的一致性。

### 开发环境搭建

#### 环境准备

在开始开发之前，需要准备好以下软件环境。微信开发者工具是开发微信小程序的必备工具，用于小程序的调试、预览和上传。开发者需要前往微信公众平台官网下载并安装最新版本的微信开发者工具。安装完成后，使用微信扫码登录，并在工具中创建一个小程序项目来验证环境是否正常。

Bun 是项目的包管理器和运行时环境。访问 Bun 官网（https://bun.sh）下载适用于 Windows 的安装包，或使用以下命令通过命令行安装。如果已经安装了 Bun，可以通过 `bun --version` 命令验证安装版本，确保版本号在 1.0.0 以上。

```bash
# Windows 安装
npm install -g bun

# 验证安装
bun --version
```

Visual Studio Code 是推荐的代码编辑器，它提供了优秀的 TypeScript 支持和丰富的插件生态。推荐安装以下 VS Code 插件以提升开发效率：ESLint 用于代码规范检查，Prettier 用于代码格式化，微信小程序代码片段提供小程序语法高亮和代码补全，GitLens 增强 Git 操作界面。

MySQL 8.0 用于存储关系型数据，Redis 7.0 用于缓存和会话管理，MongoDB 6.0 用于存储文档型数据。开发环境可以选择在本机安装这些数据库，或者使用 Docker 容器运行。对于使用 Docker 的开发者，可以使用以下命令快速启动数据库服务。

```bash
# 使用 Docker 启动 MySQL
docker run --name sutwxapp-mysql -e MYSQL_ROOT_PASSWORD=root -p 3306:3306 -d mysql:8.0

# 使用 Docker 启动 Redis
docker run --name sutwxapp-redis -p 6379:6379 -d redis:7.0

# 使用 Docker 启动 MongoDB
docker run --name sutwxapp-mongodb -p 27017:27017 -d mongo:6.0
```

#### 项目初始化

克隆项目仓库到本地后，进入项目根目录执行依赖安装命令。Bun 会自动读取 package.json 文件并安装所有依赖项。安装完成后，需要配置环境变量文件来设置数据库连接、Redis 连接和微信小程序配置等信息。

```bash
# 克隆仓库
git clone https://github.com/sutchan/SutWxApp.git
cd SutWxApp

# 安装依赖
bun install

# 复制环境配置文件
cp .env.example .env

# 编辑配置文件
nano .env
```

环境配置文件 `.env` 包含以下关键配置项。数据库配置需要设置 MySQL 连接信息，包括主机地址、端口号、用户名、密码和数据库名称。Redis 配置需要设置缓存连接信息。微信小程序配置包括 AppID 和 APPSECRET，这些信息在微信公众平台获取。JWT 配置包括密钥和过期时间，用于用户认证 Token 的生成和验证。

```dotenv
# 服务器配置
PORT=3000
HOST=localhost

# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=sutwxapp

# Redis配置
REDIS_HOST=localhost
REDIS_PORT=6379

# 微信小程序配置
APPID=wx1234567890abcdef
APPSECRET=1234567890abcdef1234567890abcdef

# JWT配置
JWT_SECRET=your-jwt-secret-key
JWT_EXPIRES_IN=7d
```

#### 启动服务

开发环境启动分为前端和后端两部分。前端使用微信开发者工具打开项目目录（`SutWxApp/SutWxApp`）即可启动小程序开发服务器。微信开发者工具支持热重载，修改代码后会自动刷新预览界面。后端服务使用 Bun 启动开发服务器，支持 TypeScript 直接运行和热重载功能。

```bash
# 启动后端开发服务器（热重载）
bun run dev

# 或使用生产模式启动
bun start
```

启动后，可以通过浏览器访问 `http://localhost:3000/api/v1/health` 来验证后端服务是否正常运行。如果返回健康检查响应，则表示服务启动成功。小程序前端的 API 请求需要配置为指向本地后端服务地址，配置方式为修改 `app.js` 中的 `apiBaseUrl` 值。

### 代码结构说明

#### 目录结构概览

项目采用清晰的目录结构组织代码，便于开发者快速定位和理解代码。根目录包含小程序前端代码和后端服务代码两大部分。前端代码位于 `SutWxApp/` 目录下，遵循微信小程序的标准目录结构。后端服务代码位于各个功能模块的 `services/` 目录中，采用分层架构组织。

```
SutWxApp/
├── app.js                    # 小程序入口文件
├── app.json                  # 全局配置
├── app.wxss                  # 全局样式
├── assets/                   # 静态资源
│   └── images/              # 图片资源
├── components/               # 自定义组件
│   ├── common/              # 通用组件
│   │   ├── button/          # 按钮组件
│   │   ├── card/            # 卡片组件
│   │   └── dialog/          # 对话框组件
│   └── business/            # 业务组件
│       ├── product-card/    # 商品卡片
│       ├── cart-item/       # 购物车项
│       └── order-card/      # 订单卡片
├── images/                   # 项目图片
├── pages/                    # 页面文件
│   ├── home/                # 首页
│   ├── category/            # 分类页
│   ├── product/             # 商品详情页
│   ├── cart/                # 购物车页
│   ├── order/               # 订单页
│   ├── user/                # 用户中心
│   └── ...                  # 其他页面
├── services/                 # 服务层（后端）
│   ├── user/                # 用户服务
│   ├── product/             # 商品服务
│   ├── order/               # 订单服务
│   ├── points/              # 积分服务
│   └── payment/             # 支付服务
├── utils/                    # 工具函数
│   ├── request.js           # 网络请求封装
│   ├── auth.js              # 认证工具
│   └── helper.js            # 通用工具
├── tests/                    # 测试文件
├── docs/                     # 项目文档
└── openspec/                 # 规范文档
```

#### 前端代码结构

微信小程序前端代码遵循微信官方推荐的目录结构。`app.js` 是小程序的入口文件，负责应用生命周期的处理和全局数据的初始化。`app.json` 定义了小程序的所有页面路径、窗口表现、网络超时时间等全局配置。`app.wxss` 定义了全局样式，包括颜色变量、字体规范和通用样式类。

页面文件存放在 `pages/` 目录下，每个页面是一个独立的文件夹，包含 JS（逻辑）、JSON（配置）、WXML（结构）和 WXSS（样式）四个文件。页面文件夹使用小驼峰命名法，如 `pointsTasks` 表示积分任务页面。自定义组件存放在 `components/` 目录下，组件文件夹同样使用小驼峰命名法。

服务层目录 `services/` 包含了后端 API 服务的实现代码。每个功能模块对应一个子目录，如 `user/` 目录包含用户相关的 API 路由、业务逻辑和数据访问代码。服务层使用 TypeScript 编写，采用分层架构，包括路由层（routes/）、控制器层（controllers/）、服务层（services/）和数据访问层（repositories/）。

#### 代码规范遵循

开发过程中应当遵循项目代码规范，确保代码风格的一致性。命名规范方面，变量和函数使用小驼峰命名法（如 `userInfo`、`getUserPoints`），类和构造函数使用大驼峰命名法（如 `UserService`、`OrderController`），常量使用全大写字母加下划线分隔（如 `MAX_RETRY_COUNT`），文件和目录使用短横线分隔（如 `user-service.ts`）。

注释规范要求每个函数必须添加函数级注释，说明函数的功能、参数和返回值。注释使用中文，遵循以下格式。文件头部需要添加文件说明注释，记录文件名、版本号、更新日期和功能描述。复杂的业务逻辑需要添加行内注释说明实现思路。

```javascript
/**
 * 文件名: user-service.ts
 * 版本号: 1.0.0
 * 更新日期: 2025-12-27
 * 功能描述: 用户相关业务逻辑处理
 * 获取用户信息
 * @param {string} userId - 用户ID
 * @returns {Promise<Object>} 用户信息对象
 */
async function getUserInfo(userId) {
  // 根据用户ID查询用户信息
  const user = await userRepository.findById(userId);
  return user;
}
```

### 功能模块概述

#### 用户模块

用户模块负责处理用户注册、登录、个人信息管理和权限控制等功能。用户注册支持微信授权登录和手机号登录两种方式。微信授权登录通过微信提供的登录凭证 code 换取用户的 openid 和 session_key，完成用户身份识别。手机号登录通过微信提供的手机号快捷登录能力，实现用户手机号绑定和登录。

用户信息管理包括昵称修改、头像更换、收货地址管理和账号绑定等功能。收货地址支持新增、编辑、删除和设为默认操作，最多保存 20 个收货地址。用户权限控制采用 RBAC 模型，区分普通用户和管理员角色，不同角色拥有不同的功能访问权限。

#### 商品模块

商品模块负责商品展示、分类管理、商品搜索和详情查看等功能。商品展示支持列表视图和网格视图两种模式，用户可以根据偏好切换。分类管理采用两级分类结构，一级分类下包含二级子分类，用户可以通过分类导航快速定位目标商品。

商品搜索支持关键词搜索、分类筛选、价格区间筛选和排序功能。搜索结果按照综合排序、价格排序和销量排序展示，用户可以灵活调整排序方式。商品详情页展示商品图片、价格、规格、库存、评价和销量等信息，支持加入购物车、立即购买和收藏操作。

#### 购物车模块

购物车模块负责商品添加、数量修改、规格选择和结算功能。用户可以从商品详情页将商品加入购物车，也可以在购物车页面直接调整商品数量。购物车支持规格选择和规格切换，不同规格的商品作为独立的购物车项处理。

结算功能会校验购物车中商品的库存状态和价格变化，生成结算订单。用户确认订单信息后，点击支付按钮发起微信支付。购物车数据存储在本地缓存和后端数据库中，支持多设备同步和登录恢复。

#### 订单模块

订单模块负责订单创建、状态跟踪、订单操作和历史记录等功能。订单创建时会锁定商品库存，生成订单编号，记录订单金额和优惠信息。订单状态包括待付款、待发货、待收货、已完成和已取消六种状态，状态流转遵循订单生命周期的业务规则。

用户可以在订单列表查看所有订单，按照订单状态筛选。点击订单可以进入订单详情页，查看订单商品、物流信息和支付状态。订单操作包括取消订单、申请退款、确认收货和再次购买等功能，不同状态下的可操作项有所不同。

#### 积分模块

积分模块负责积分获取、积分使用和积分记录查询等功能。积分获取来源包括新用户注册奖励、每日签到、订单消费返积分和活动奖励等。积分使用支持兑换商品、抵扣订单金额和参与抽奖活动等场景。积分具有有效期限制，过期积分会在每月固定日期清零。

积分记录完整记录积分的获取和使用流水，包括积分变动时间、变动原因和变动数值。用户可以在积分中心查看当前积分余额、积分等级、积分规则和积分记录。积分等级根据累计积分计算，不同等级享有不同的权益和优惠。

### 常见问题解答

#### 开发环境问题

问题一：微信开发者工具提示"没有找到 app.json"错误。解决方法是在微信开发者工具中点击"导入项目"，选择 `SutWxApp/SutWxApp` 目录（注意不是项目根目录），然后选择 AppID（可以使用测试号），点击确定导入项目。

问题二：后端服务启动失败，提示数据库连接错误。首先检查 MySQL 服务是否启动，然后验证 `.env` 文件中的数据库配置是否正确，包括主机地址、端口号、用户名、密码和数据库名称。如果使用 Docker 启动的 MySQL，需要确保容器正在运行。

问题三：Bun 安装依赖时速度慢或失败。可以尝试使用国内镜像源加速安装，配置方式为设置环境变量 `BUN_INSTALL_URL=https://registry.npmmirror.com`。如果仍然失败，可以删除 `node_modules` 目录和 `bun.lockb` 文件后重新安装。

#### 功能开发问题

问题四：如何添加新的 API 接口。在对应功能模块的 `routes/` 目录下创建新的路由文件，定义路由路径和请求处理函数。然后在模块的入口文件中注册路由。API 接口应当遵循 RESTful 设计规范，使用标准的 HTTP 方法和状态码。

问题五：如何在页面中调用后端 API。项目封装了统一的网络请求工具 `utils/request.js`，提供了 `get`、`post`、`put` 和 `delete` 方法。调用示例如下，首先导入请求工具，然后调用相应的方法发起请求，请求会自动携带用户认证 Token。

```javascript
import { get } from '../../utils/request';

// 获取商品列表
const products = await get('/api/v1/products', {
  categoryId: 'cat_001',
  page: 1,
  pageSize: 20,
});
```

问题六：如何调试小程序前端代码。微信开发者工具提供了调试器功能，可以在 Sources 面板中设置断点，在 Console 面板中执行 JavaScript 代码查看变量值。网络面板可以查看所有网络请求的请求参数和响应数据。真机调试功能可以在真实手机上预览和调试小程序。

## 第二部分：用户操作手册

### 快速入门

#### 注册与登录

首次使用苏铁微信小程序，需要完成注册和登录操作。打开小程序后，点击右下角"我的"进入个人中心页面。如果还未登录，页面会显示登录按钮，点击后选择微信快捷登录。微信授权登录需要确认用户信息授权，授权成功后即可完成登录并使用小程序全部功能。

登录后建议完善个人资料，包括设置昵称、头像和绑定手机号。绑定手机号可以提高账户安全性，也便于接收订单通知和优惠信息。在"我的"页面点击"设置"进入设置页面，然后点击"个人信息"可以修改个人资料。手机号绑定在账户安全设置中进行，点击"手机绑定"按照提示完成验证。

#### 浏览商品

小程序首页展示了推荐商品、轮播图和快捷入口。用户可以通过以下方式浏览商品：在首页推荐位直接点击感兴趣的商品；在分类页面按照分类导航浏览；在搜索框输入关键词搜索目标商品。商品列表支持切换视图模式（列表/网格），支持按照综合、价格和销量排序。

点击商品图片或名称可以进入商品详情页。详情页展示了商品大图、价格、规格选择、库存数量、商品详情和用户评价等信息。选择商品规格后，可以点击"加入购物车"将商品添加到购物车，或者点击"立即购买"直接下单购买。收藏功能可以收藏喜欢的商品，方便以后快速找到。

### 购物指南

#### 添加购物车

在商品详情页选择合适的规格后，点击"加入购物车"按钮即可将商品添加到购物车。系统会提示添加成功，同时显示当前购物车中的商品数量。添加失败可能是因为商品库存不足或规格已下架，此时会显示相应的提示信息。

购物车页面可以查看已添加的所有商品。在购物车中可以修改商品数量，移除不需要的商品，或者切换商品规格。数量调整时会实时计算商品总价，库存不足时会提示用户调整数量。确认购物车中的商品后，点击"去结算"按钮进入订单确认页面。

#### 结算下单

结算页面分为三个部分：订单商品清单、收货地址选择和支付方式选择。商品清单显示待结算的所有商品，支持查看商品详情。收货地址默认选择上次使用的地址，用户可以点击地址区域切换或新增收货地址。支付方式目前仅支持微信支付。

确认订单信息无误后，点击"提交订单"按钮。系统会创建订单并跳转到支付页面。支付成功后，订单状态变更为"待发货"，用户可以在订单列表中查看订单详情和物流信息。如果支付失败，可以重新发起支付或取消订单。

### 账户管理

#### 收货地址管理

在"我的"页面点击"收货地址"进入地址管理页面。地址列表显示所有已保存的收货地址，默认地址会有标识。点击地址可以查看详细信息，点击"编辑"可以修改地址信息，点击"删除"可以移除地址，点击"设为默认"可以将地址设为默认收货地址。

新增地址需要填写收货人姓名、联系电话、所在地区和详细地址。所在地区支持省市区三级联动选择，详细地址填写楼栋门牌号等信息。保存地址后，系统会进行格式校验，确保地址信息完整准确。每个账户最多保存 20 个收货地址。

#### 积分管理

在"我的"页面点击"积分"进入积分中心。积分中心顶部显示当前积分余额和积分等级，下方展示了积分获取规则和积分记录。用户可以通过签到、购物和参与活动获取积分，积分可以用于兑换商品或抵扣订单金额。

积分记录完整记录了积分的每次变动，包括变动时间、变动原因和变动数值。收入记录显示积分增加的情况，如签到奖励、购物返积分等；支出记录显示积分减少的情况，如兑换商品、抵扣订单等。积分具有有效期，获得积分后有效期为一年，过期未使用的积分会在每年年底清零。

### 订单管理

#### 查看订单

在"我的"页面点击"我的订单"进入订单列表页面。订单列表默认显示所有订单，可以点击顶部的状态标签筛选特定状态的订单。订单状态分为全部、待付款、待发货、待收货、待评价和已取消七个分类。

点击订单可以进入订单详情页，查看订单商品列表、订单金额、订单状态、收货地址和物流信息。已完成的订单支持再次购买功能，点击"再次购买"可以将订单中的商品快速加入购物车。订单详情页还提供了订单操作入口，根据订单状态显示不同的操作按钮。

#### 取消与退款

待付款状态的订单可以取消，点击订单详情页的"取消订单"按钮，选择取消原因后确认取消。取消成功后，订单金额会原路退回，商品库存会释放。如果订单已支付但商家尚未发货，可以申请退款。点击"申请退款"按钮，填写退款原因后提交申请。商家审核通过后，金额会原路退回。

已发货的订单需要收到货后申请退货退款。点击"申请售后"按钮，选择退货退款，填写退货原因和退款金额后提交。商家同意退货后，用户需要将商品寄回，物流信息填写完成后等待商家确认收货。商家确认收货后，系统会自动发起退款。

### 常见问题解答

#### 登录与账户

问题一：为什么无法登录小程序？首先检查网络连接是否正常，然后确认微信版本是否支持小程序功能。如果提示"登录失败"，可以尝试退出小程序后重新进入，或清除微信缓存后重试。如果问题仍然存在，可能是服务器暂时不可用，可以稍后再试。

问题二：如何退出登录？在"我的"页面点击"设置"，然后点击"退出登录"按钮即可退出当前账户。退出登录后，小程序会清除本地的用户信息，再次使用需要重新登录。

#### 购物与支付

问题三：商品加入购物车失败怎么办？首先检查商品是否有库存，如果显示"缺货"则无法加入购物车。然后检查网络连接是否正常，网络异常可能导致请求失败。如果多次尝试仍然失败，可以联系客服咨询。

问题四：支付时提示金额异常怎么办？商品价格可能会因促销活动而变化，支付时会再次校验商品价格。如果价格变化较大，系统会提示用户确认新价格。如果不同意新价格，可以取消订单后重新添加购物车。

问题五：如何查看物流信息？已发货的订单可以在订单详情页查看物流信息。点击"查看物流"按钮，可以查看物流公司和运单号，点击物流单号可以跳转到物流公司官网查看详细物流轨迹。部分订单可能没有物流信息，点击按钮会显示提示。

#### 积分与优惠

问题六：积分为什么不见了？积分具有有效期限制，过期的积分会被清零。清零前会通过微信服务通知提醒用户尽快使用。可以在积分中心查看积分明细，了解积分的获取和使用记录，以及积分的过期时间。

问题七：优惠券如何使用？领取优惠券后，在结算页面会自动显示可用的优惠券。点击优惠券选择器可以选择使用某张优惠券，优惠券金额会在订单金额中扣除。如果优惠券无法使用，可能是优惠券已过期或不满足使用条件。

## 版本历史

| 版本 | 更新日期 | 更新内容 | 作者 |
|------|----------|----------|------|
| 1.0.0 | 2025-12-27 | 初始版本，完成用户指南文档 | Sut |
