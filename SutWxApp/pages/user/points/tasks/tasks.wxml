/**
 * 文件名: tasks.wxml
 * 版本号: 1.0.0
 * 更新日期: 2025-11-23
 * 描述: tasks 椤甸潰缁撴瀯鏂囦欢
 */
<!-- 绉垎浠诲姟椤甸潰 -->
<view class="tasks-container">
  <!-- 鐢ㄦ埛绉垎淇℃伅 -->
  <view class="points-header">
    <view class="points-info">
      <text class="points-value">{{userPoints.availablePoints}}</text>
      <text class="points-label">鎴戠殑绉垎</text>
    </view>
    <view class="today-earned">
      <text class="earned-value">+{{userPoints.todayEarned}}</text>
      <text class="earned-label">浠婃棩鑾峰緱</text>
    </view>
  </view>
  
  <!-- 浠诲姟绫诲瀷绛涢€?-->
  <view class="task-types">
    <scroll-view scroll-x="true" class="types-scroll">
      <view class="types-list">
        <view wx:for="{{taskTypes}}" wx:key="key" 
              class="type-item {{currentType === item.key ? 'active' : ''}}"
              data-type="{{item.key}}" bindtap="switchTaskType">
          <text class="type-name">{{item.name}}</text>
          <view wx:if="{{item.count > 0}}" class="type-count">{{item.count}}</view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- 浠诲姟鐘舵€佺瓫閫?-->
  <view class="task-statuses">
    <scroll-view scroll-x="true" class="statuses-scroll">
      <view class="statuses-list">
        <view wx:for="{{taskStatuses}}" wx:key="key" 
              class="status-item {{currentStatus === item.key ? 'active' : ''}}"
              data-status="{{item.key}}" bindtap="switchTaskStatus">
          <text class="status-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- 浠诲姟鍒楄〃 -->
  <view class="tasks-list">
    <!-- 加载状态-->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">姝ｅ湪鍔犺浇浠诲姟...</text>
    </view>
    
    <!-- 浠诲姟椤?-->
    <view wx:else class="task-items">
      <view wx:for="{{taskList}}" wx:key="id" class="task-item" data-id="{{item.id}}" bindtap="goToTaskDetail">
        <!-- 浠诲姟鍥炬爣鍜屽熀鏈俊鎭?-->
        <view class="task-header">
          <view class="task-icon {{item.type}}">
            <image src="{{item.icon}}" mode="aspectFit"></image>
          </view>
          
          <view class="task-basic-info">
            <view class="task-title">{{item.title}}</view>
            <view class="task-desc">{{item.description}}</view>
          </view>
          
          <view class="task-reward">
            <text class="reward-value">+{{item.points}}</text>
            <text class="reward-label">绉垎</text>
          </view>
        </view>
        
        <!-- 浠诲姟杩涘害 -->
        <view wx:if="{{item.target > 1}}" class="task-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{getTaskProgressPercent(item.current, item.target)}}%"></view>
          </view>
          <view class="progress-text">
            {{formatTaskProgress(item.current, item.target)}}
          </view>
        </view>
        
        <!-- 浠诲姟鐘舵€佸拰鎿嶄綔 -->
        <view class="task-footer">
          <view class="task-status {{item.status}}">
            <text wx:if="{{item.status === 'pending'}}">鏈畬鎴?/text>
            <text wx:elif="{{item.status === 'completed'}}">宸插畬鎴?/text>
            <text wx:elif="{{item.status === 'unclaimed'}}">寰呴鍙?/text>
            <text wx:elif="{{item.status === 'claimed'}}">宸查鍙?/text>
          </view>
          
          <view class="task-actions">
            <button wx:if="{{item.status === 'pending' && item.actionable}}" 
                    class="action-btn primary" 
                    data-id="{{item.id}}" 
                    catchtap="completeTask">
              {{item.actionText || '鍘诲畬鎴?}}
            </button>
            
            <button wx:elif="{{item.status === 'unclaimed'}}" 
                    class="action-btn primary" 
                    data-id="{{item.id}}" 
                    catchtap="claimTaskReward">
              棰嗗彇濂栧姳
            </button>
            
            <button wx:else class="action-btn disabled" disabled>
              {{item.statusText || '宸插畬鎴?}}
            </button>
          </view>
        </view>
      </view>
      
      <!-- 鍔犺浇鏇村 -->
      <view wx:if="{{hasMore && loading}}" class="loading-more">
        <view class="loading-spinner small"></view>
        <text class="loading-text">鍔犺浇鏇村...</text>
      </view>
      
      <!-- 娌℃湁鏇村鏁版嵁 -->
      <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
        <text>娌℃湁鏇村浠诲姟浜?/text>
      </view>
      
      <!-- 绌虹姸鎬?-->
      <view wx:if="{{taskList.length === 0 && !loading}}" class="empty-state">
        <view class="empty-icon"></view>
        <text class="empty-text">鏆傛棤浠诲姟</text>
        <text class="empty-desc">褰撳墠绛涢€夋潯浠朵笅娌℃湁浠诲姟</text>
      </view>
    </view>
  </view>
</view>
