/**
 * 鏂囦欢鍚? tasks.wxml
 * 鐗堟湰鍙? 1.0.0
 * 更新日期: 2025-11-23
 * 描述: tasks 妞ょ敻娼扮紒鎾寸€弬鍥︽
 */
<!-- 缁夘垰鍨庢禒璇插妞ょ敻娼?-->
<view class="tasks-container">
  <!-- 閻劍鍩涚粔顖氬瀻娣団剝浼?-->
  <view class="points-header">
    <view class="points-info">
      <text class="points-value">{{userPoints.availablePoints}}</text>
      <text class="points-label">閹存垹娈戠粔顖氬瀻</text>
    </view>
    <view class="today-earned">
      <text class="earned-value">+{{userPoints.todayEarned}}</text>
      <text class="earned-label">娴犲﹥妫╅懢宄扮繁</text>
    </view>
  </view>
  
  <!-- 娴犺濮熺猾璇茬€风粵娑⑩偓?-->
  <view class="task-types">
    <scroll-view scroll-x="true" class="types-scroll">
      <view class="types-list">
        <view wx:for="{{taskTypes}}" wx:key="key" 
              class="type-item {{currentType === item.key ? 'active' : ''}}"
              data-type="{{item.key}}" bindtap="switchTaskType">
          <text class="type-name">{{item.name}}</text>
          <view wx:if="{{item.count > 0}}" class="type-count">{{item.count}}</view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- 娴犺濮熼悩鑸碘偓浣虹摣闁?-->
  <view class="task-statuses">
    <scroll-view scroll-x="true" class="statuses-scroll">
      <view class="statuses-list">
        <view wx:for="{{taskStatuses}}" wx:key="key" 
              class="status-item {{currentStatus === item.key ? 'active' : ''}}"
              data-status="{{item.key}}" bindtap="switchTaskStatus">
          <text class="status-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- 娴犺濮熼崚妤勩€?-->
  <view class="tasks-list">
    <!-- 加载状态->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">濮濓絽婀崝鐘烘祰娴犺濮?..</text>
    </view>
    
    <!-- 娴犺濮熸い?-->
    <view wx:else class="task-items">
      <view wx:for="{{taskList}}" wx:key="id" class="task-item" data-id="{{item.id}}" bindtap="goToTaskDetail">
        <!-- 娴犺濮熼崶鐐垼閸滃苯鐔€閺堫兛淇婇幁?-->
        <view class="task-header">
          <view class="task-icon {{item.type}}">
            <image src="{{item.icon}}" mode="aspectFit"></image>
          </view>
          
          <view class="task-basic-info">
            <view class="task-title">{{item.title}}</view>
            <view class="task-desc">{{item.description}}</view>
          </view>
          
          <view class="task-reward">
            <text class="reward-value">+{{item.points}}</text>
            <text class="reward-label">缁夘垰鍨?/text>
          </view>
        </view>
        
        <!-- 娴犺濮熸潻娑樺 -->
        <view wx:if="{{item.target > 1}}" class="task-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{getTaskProgressPercent(item.current, item.target)}}%"></view>
          </view>
          <view class="progress-text">
            {{formatTaskProgress(item.current, item.target)}}
          </view>
        </view>
        
        <!-- 娴犺濮熼悩鑸碘偓浣告嫲閹垮秳缍?-->
        <view class="task-footer">
          <view class="task-status {{item.status}}">
            <text wx:if="{{item.status === 'pending'}}">閺堫亜鐣幋?/text>
            <text wx:elif="{{item.status === 'completed'}}">瀹告彃鐣幋?/text>
            <text wx:elif="{{item.status === 'unclaimed'}}">瀵板懘顣崣?/text>
            <text wx:elif="{{item.status === 'claimed'}}">瀹告煡顣崣?/text>
          </view>
          
          <view class="task-actions">
            <button wx:if="{{item.status === 'pending' && item.actionable}}" 
                    class="action-btn primary" 
                    data-id="{{item.id}}" 
                    catchtap="completeTask">
              {{item.actionText || '閸樿鐣幋?}}
            </button>
            
            <button wx:elif="{{item.status === 'unclaimed'}}" 
                    class="action-btn primary" 
                    data-id="{{item.id}}" 
                    catchtap="claimTaskReward">
              妫板棗褰囨總鏍уС
            </button>
            
            <button wx:else class="action-btn disabled" disabled>
              {{item.statusText || '瀹告彃鐣幋?}}
            </button>
          </view>
        </view>
      </view>
      
      <!-- 閸旂姾娴囬弴鏉戭樋 -->
      <view wx:if="{{hasMore && loading}}" class="loading-more">
        <view class="loading-spinner small"></view>
        <text class="loading-text">閸旂姾娴囬弴鏉戭樋...</text>
      </view>
      
      <!-- 濞屸剝婀侀弴鏉戭樋閺佺増宓?-->
      <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
        <text>濞屸剝婀侀弴鏉戭樋娴犺濮熸禍?/text>
      </view>
      
      <!-- 缁岃櫣濮搁幀?-->
      <view wx:if="{{taskList.length === 0 && !loading}}" class="empty-state">
        <view class="empty-icon"></view>
        <text class="empty-text">閺嗗倹妫ゆ禒璇插</text>
        <text class="empty-desc">瑜版挸澧犵粵娑⑩偓澶嬫蒋娴犳湹绗呭▽鈩冩箒娴犺濮?/text>
      </view>
    </view>
  </view>
</view>
