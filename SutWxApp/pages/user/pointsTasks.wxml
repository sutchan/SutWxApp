/**
 * 鏂囦欢鍚? pointsTasks.wxml
 * 鐗堟湰鍙? 1.0.0
 * 鏇存柊鏃ユ湡: 2025-11-23
 * 鎻忚堪: pointsTasks 椤甸潰缁撴瀯鏂囦欢
 */
<!-- 绉垎浠诲姟椤甸潰 -->
<view class="container">
  <!-- 浠诲姟缁熻鍗＄墖 -->
  <view class="stats-card">
    <view class="stats-item">
      <text class="stats-value">{{taskStats.total}}</text>
      <text class="stats-label">鎬讳换鍔?/text>
    </view>
    <view class="stats-item">
      <text class="stats-value">{{taskStats.completed}}</text>
      <text class="stats-label">宸插畬鎴?/text>
    </view>
    <view class="stats-item">
      <text class="stats-value">{{taskStats.pending}}</text>
      <text class="stats-label">杩涜涓?/text>
    </view>
    <view class="stats-item">
      <text class="stats-value">{{taskStats.totalPoints}}</text>
      <text class="stats-label">鎬荤Н鍒?/text>
    </view>
  </view>
  
  <!-- 鏍囩鍒囨崲 -->
  <view class="tab-bar">
    <view wx:for="{{tabs}}" wx:key="key" 
          class="tab-item {{activeTab === item.key ? 'active' : ''}}"
          data-tab="{{item.key}}" 
          bindtap="onTabChange">
      {{item.name}}
    </view>
  </view>
  
  <!-- 浠诲姟鍒楄〃 -->
  <view class="content">
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text>鍔犺浇涓?..</text>
    </view>
    
    <view wx:elif="{{taskList.length === 0 && !loading}}" class="empty-state">
      <image class="empty-icon" src="/images/empty-tasks.png"></image>
      <text>鏆傛棤浠诲姟</text>
      <text class="empty-tip">蹇幓瀹屾垚鍏朵粬浠诲姟鍚?/text>
    </view>
    
    <view wx:else class="task-list">
      <view wx:for="{{taskList}}" wx:key="id" 
            class="task-item {{item.isExpired ? 'expired' : ''}}">
        <!-- 浠诲姟澶撮儴 -->
        <view class="task-header">
          <view class="task-title">
            <text class="task-name">{{item.name}}</text>
            <view wx:if="{{item.isExpired}}" class="task-tag expired-tag">宸茶繃鏈?/view>
            <view wx:elif="{{item.status === 'completed' && !item.rewardReceived}}" class="task-tag reward-tag">寰呴鍙?/view>
            <view wx:elif="{{item.status === 'claimed'}}" class="task-tag claimed-tag">宸查鍙?/view>
            <view wx:elif="{{item.status === 'completed'}}" class="task-tag completed-tag">宸插畬鎴?/view>
          </view>
          <view class="task-points">+{{item.points}}绉垎</view>
        </view>
        
        <!-- 浠诲姟鎻忚堪 -->
        <view class="task-desc">{{item.description}}</view>
        
        <!-- 浠诲姟杩涘害 -->
        <view class="task-progress">
          <view class="progress-info">
            <text>杩涘害: {{item.currentCount || 0}}/{{item.targetCount || 0}}</text>
            <text>{{item.progress}}%</text>
          </view>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.progress}}%"></view>
          </view>
        </view>
        
        <!-- 浠诲姟鏃堕棿 -->
        <view wx:if="{{item.expireTime}}" class="task-time">
          <text>鏈夋晥鏈熻嚦: {{item.expireTime}}</text>
        </view>
        
        <!-- 浠诲姟鎿嶄綔 -->
        <view class="task-actions">
          <button wx:if="{{item.status === 'pending' && !item.isExpired}}" 
                  class="action-btn primary" 
                  data-id="{{item.id}}" 
                  bindtap="onTaskAction">
            {{item.actionText || '鍘诲畬鎴?}}
          </button>
          
          <button wx:elif="{{item.status === 'completed' && !item.rewardReceived && !item.isExpired}}" 
                  class="action-btn reward" 
                  data-id="{{item.id}}" 
                  bindtap="onReceiveReward">
            棰嗗彇濂栧姳
          </button>
          
          <button wx:else 
                  class="action-btn detail" 
                  data-id="{{item.id}}" 
                  bindtap="onViewTaskDetail">
            鏌ョ湅璇︽儏
          </button>
        </view>
      </view>
    </view>
    
    <!-- 鍔犺浇鏇村 -->
    <view wx:if="{{loadingMore}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text>鍔犺浇鏇村...</text>
    </view>
    
    <!-- 娌℃湁鏇村鏁版嵁 -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more-data">
      娌℃湁鏇村浠诲姟浜?    </view>
  </view>
</view>