<!-- pages/user/profile/profile.wxml -->
<view class="profile-container">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{isLoading && !error && !showSkeleton}}">
    <view class="loading">
      <text>加载中...</text>
    </view>
  </view>

  <!-- 骨架屏 -->
  <view class="skeleton-container" wx:if="{{showSkeleton && !error}}">
    <!-- 用户信息骨架屏 -->
    <view class="skeleton-user-header">
      <view class="skeleton-avatar"></view>
      <view class="skeleton-user-info">
        <view class="skeleton-name"></view>
        <view class="skeleton-id"></view>
      </view>
      <view class="skeleton-arrow"></view>
    </view>
    
    <!-- 积分卡片骨架屏 -->
    <view class="skeleton-points-card">
      <view class="skeleton-points-label"></view>
      <view class="skeleton-points-value"></view>
      <view class="skeleton-arrow"></view>
    </view>
    
    <!-- 签到卡片骨架屏 -->
    <view class="skeleton-signin-card">
      <view class="skeleton-signin-info">
        <view class="skeleton-signin-icon"></view>
        <view class="skeleton-signin-text"></view>
      </view>
      <view class="skeleton-signin-reward"></view>
    </view>
    
    <!-- 统计卡片骨架屏 -->
    <view class="skeleton-stats-card">
      <view class="skeleton-stat-item">
        <view class="skeleton-stat-value"></view>
        <view class="skeleton-stat-label"></view>
      </view>
      <view class="skeleton-stat-item">
        <view class="skeleton-stat-value"></view>
        <view class="skeleton-stat-label"></view>
      </view>
      <view class="skeleton-stat-item">
        <view class="skeleton-stat-value"></view>
        <view class="skeleton-stat-label"></view>
      </view>
    </view>
    
    <!-- 功能列表骨架屏 -->
    <view class="skeleton-feature-list">
      <view class="skeleton-feature-item" wx:for="[1,2,3,4,5,6]" wx:key="index">
        <view class="skeleton-feature-left">
          <view class="skeleton-feature-icon"></view>
          <view class="skeleton-feature-text"></view>
        </view>
        <view class="skeleton-feature-right">
          <view class="skeleton-feature-count"></view>
          <view class="skeleton-arrow"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 错误状态 -->
  <view class="error-container" wx:if="{{error}}">
    <image src="/images/error.png" class="error-icon"></image>
    <text class="error-text">{{error}}</text>
    <button class="retry-button" bindtap="onRetry">重试</button>
  </view>

  <!-- 未登录状态 -->
  <view class="unlogin-container" wx:elif="{{!isLoggedIn && !isLoading}}">
    <view class="unlogin-content">
      <image src="/images/default-avatar.png" class="default-avatar"></image>
      <text class="unlogin-text">请先登录</text>
      <button class="login-btn" type="primary" bindtap="navigateToLogin">立即登录</button>
      <text class="unlogin-tip">登录后可享受更多功能</text>
    </view>
  </view>

  <!-- 已登录状态 -->
  <view class="logged-container" wx:else>
    <!-- 用户信息头部 -->
    <view class="user-header" aria-label="用户信息">
      <image src="{{userInfo.avatar || '/images/default-avatar.png'}}" class="user-avatar" aria-label="用户头像" bindtap="onAvatarTap" mode="aspectFill"></image>
      <view class="user-info">
        <view class="user-name-row">
          <text class="user-name">{{userInfo.nickname || userInfo.username || '用户'}}</text>
          <text class="user-id">ID: {{userInfo.openid || ''}}</text>
        </view>
        <text class="user-level">普通用户</text>
      </view>
      <image src="/images/arrow-right.png" class="arrow-icon" bindtap="navigateToSettings" aria-label="设置"></image>
    </view>

    <!-- 积分信息 -->
    <view class="points-card">
      <view class="points-info" bindtap="navigateToPointsCenter" aria-label="我的积分：{{userStats.points || 0}}，点击查看积分详情">
        <text class="points-label">我的积分</text>
        <text class="points-value">{{userStats.points || 0}}</text>
        <image src="/images/arrow-right.png" class="arrow-icon"></image>
      </view>
    </view>

    <!-- 签到区域 -->
    <view class="signin-card" bindtap="doSignin" aria-label="{{signinStatus ? '今日已签到，连续' + signinDays + '天' : '点击签到，当前连续' + signinDays + '天'}}">
      <view class="signin-info">
        <image src="{{signinStatus ? '/images/signin-checked.png' : '/images/signin.png'}}" class="signin-icon"></image>
        <text class="signin-text">{{signinStatus ? '已签到' : '每日签到'}}</text>
        <text class="signin-days" wx:if="{{signinDays > 0}}">连续{{signinDays}}天</text>
      </view>
      <text class="signin-reward" wx:if="{{!signinStatus}}">+5积分</text>
    </view>

    <!-- 统计数据卡片 -->
    <view class="stats-card" wx:if="{{showStatsCard}}" aria-label="用户统计数据">
      <view class="stat-item">
        <text class="stat-value">{{userStats.articles || 0}}</text>
        <text class="stat-label">发布文章</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{userStats.comments || 0}}</text>
        <text class="stat-label">发表评论</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{userStats.favorites || 0}}</text>
        <text class="stat-label">我的收藏</text>
      </view>
    </view>

    <!-- 功能列表 -->
    <view class="feature-list">
      <!-- 我的收藏 -->
      <view class="feature-item" bindtap="navigateToFavoriteList" aria-label="我的收藏，共{{userStats.favorites || 0}}个">
        <view class="feature-left">
          <image src="/images/favorite.png" class="feature-icon"></image>
          <text class="feature-text">我的收藏</text>
        </view>
        <view class="feature-right">
          <text class="feature-count">{{userStats.favorites || 0}}</text>
          <image src="/images/arrow-right.png" class="arrow-icon"></image>
        </view>
      </view>

      <!-- 我的地址 -->
      <view class="feature-item" bindtap="navigateToAddressList" aria-label="我的地址">
        <view class="feature-left">
          <image src="/images/address.png" class="feature-icon"></image>
          <text class="feature-text">我的地址</text>
        </view>
        <image src="/images/arrow-right.png" class="arrow-icon"></image>
      </view>

      <!-- 签到历史 -->
      <view class="feature-item" bindtap="navigateToSigninHistory" aria-label="签到历史">
        <view class="feature-left">
          <image src="/images/calendar.png" class="feature-icon"></image>
          <text class="feature-text">签到历史</text>
        </view>
        <image src="/images/arrow-right.png" class="arrow-icon"></image>
      </view>

      <!-- 意见反馈 -->
      <view class="feature-item" bindtap="navigateToFeedback" aria-label="意见反馈">
        <view class="feature-left">
          <image src="/images/feedback.png" class="feature-icon"></image>
          <text class="feature-text">意见反馈</text>
        </view>
        <image src="/images/arrow-right.png" class="arrow-icon"></image>
      </view>

      <!-- 设置 -->
      <view class="feature-item" bindtap="navigateToSettings" aria-label="设置">
        <view class="feature-left">
          <image src="/images/settings.png" class="feature-icon"></image>
          <text class="feature-text">设置</text>
        </view>
        <image src="/images/arrow-right.png" class="arrow-icon"></image>
      </view>

      <!-- 帮助中心 -->
      <view class="feature-item" bindtap="navigateToHelpCenter" wx:if="{{showHelpCenter}}" aria-label="帮助中心">
        <view class="feature-left">
          <image src="/images/help.png" class="feature-icon"></image>
          <text class="feature-text">帮助中心</text>
        </view>
        <image src="/images/arrow-right.png" class="arrow-icon"></image>
      </view>
    </view>

    <!-- 版本信息 -->
    <view class="version-info" wx:if="{{appVersion}}" aria-label="当前版本">
      <text class="version-text">当前版本：{{appVersion}}</text>
    </view>

    <!-- 退出登录按钮 -->
    <view class="logout-container">
      <button class="logout-btn" bindtap="logout" aria-label="退出登录">退出登录</button>
    </view>
  </view>
</view>