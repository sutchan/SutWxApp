/**
 * 鏂囦欢鍚? pointsExchange.wxml
 * 鐗堟湰鍙? 1.0.0
 * 鏇存柊鏃ユ湡: 2025-11-23
 * 鎻忚堪: pointsExchange 妞ょ敻娼扮紒鎾寸€弬鍥︽
 */
<view class="container">
  <!-- 缁夘垰鍨庢径鎾劥 -->
  <view class="points-header">
    <view class="points-info">
      <text class="points-label">閹存垹娈戠粔顖氬瀻</text>
      <text class="points-value">{{currentPoints}}</text>
    </view>
    <view class="points-actions">
      <view class="action-item" bindtap="onGoToDetail">
        <text class="iconfont">缁夘垰鍨庨弰搴ｇ矎</text>
      </view>
      <view class="action-item" bindtap="onGoToTasks">
        <text class="iconfont">鐠ф氨袧閸?/text>
      </view>
    </view>
  </view>

  <!-- 閸掑棛琚弽鍥╊劮 -->
  <view class="tab-bar">
    <view 
      wx:for="{{tabs}}" 
      wx:key="key" 
      class="tab-item {{activeTab === item.key ? 'active' : ''}}" 
      data-tab="{{item.key}}" 
      bindtap="onTabChange">
      {{item.label}}
    </view>
  </view>

  <!-- 閹烘帒绨粵娑⑩偓?-->
  <view class="sort-bar">
    <view class="sort-current" bindtap="onShowFilter">
      <text>{{sortOptions.find(item => item.key === sortType).label}}</text>
      <text class="iconfont arrow">閳?/text>
    </view>
  </view>

  <!-- 閸愬懎顔愰崠鍝勭厵 -->
  <view class="content">
    <!-- 閸忔垶宕查崯鍡楁惂閸掓銆?-->
    <view class="exchange-list" wx:if="{{!isEmpty}}">
      <view 
        wx:for="{{exchangeList}}" 
        wx:key="id" 
        class="exchange-item">
        
        <!-- 閸熷棗鎼ч崶鍓у -->
        <view class="item-image" bindtap="onViewDetail" data-id="{{item.id}}">
          <image src="{{item.image}}" mode="aspectFill" class="image"></image>
          <!-- 鎼存挸鐡ㄦ稉宥堝喕閺嶅洨顒?-->
          <view class="stock-tag" wx:if="{{item.stock <= 0}}">瀹告彃鍘€?/view>
          <!-- 閻戭參妫弽鍥╊劮 -->
          <view class="hot-tag" wx:if="{{item.isHot}}">閻戭參妫?/view>
        </view>
        
        <!-- 浜у搧淇℃伅 -->
        <view class="item-info">
          <view class="item-name" bindtap="onViewDetail" data-id="{{item.id}}">{{item.name}}</view>
          <view class="item-desc">{{item.description}}</view>
          
          <!-- 閸忔垶宕叉穱鈩冧紖 -->
          <view class="item-exchange">
            <view class="points-info">
              <text class="points-value">{{item.points}}</text>
              <text class="points-label">缁夘垰鍨?/text>
            </view>
            
            <!-- 鎼存挸鐡ㄦ穱鈩冧紖 -->
            <view class="stock-info" wx:if="{{item.stock > 0}}">
              <text class="stock-text">閸撯晙缍憑{item.stock}}娴?/text>
            </view>
            <view class="stock-info out-of-stock" wx:else>
              <text class="stock-text">瀹告彃鍘€?/text>
            </view>
          </view>
          
          <!-- 閹垮秳缍旈幐澶愭尦 -->
          <view class="item-actions">
            <button 
              class="detail-btn" 
              bindtap="onViewDetail" 
              data-id="{{item.id}}">
              鐠囷附鍎?            </button>
            <button 
              class="exchange-btn {{item.stock <= 0 || currentPoints < item.points ? 'disabled' : ''}}" 
              bindtap="onExchange" 
              data-id="{{item.id}}"
              disabled="{{item.stock <= 0 || currentPoints < item.points}}">
              {{item.stock <= 0 ? '瀹告彃鍘€? : (currentPoints < item.points ? '缁夘垰鍨庢稉宥堝喕' : '缁斿宓嗛崗鎴炲床')}}
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- 缁岃櫣濮搁幀?-->
    <view class="empty-state" wx:if="{{isEmpty}}">
      <image class="empty-icon" src="/images/empty-exchange.png" mode="aspectFit"></image>
      <text>閺嗗倹妫ら崗鎴炲床閸熷棗鎼?/text>
      <view class="empty-tip">閺侇剝顕張鐔风窡閺囨潙顦跨划鎯у兊閸熷棗鎼?/view>
    </view>

    <!-- 鍔犺浇鐘舵€?->
    <view class="loading-state" wx:if="{{isLoading && exchangeList.length === 0}}">
      <view class="loading-spinner"></view>
      <text>鍔犺浇涓?.</text>
    </view>

    <!-- 濞屸剝婀侀弴鏉戭樋閺佺増宓?-->
    <view class="no-more-data" wx:if="{{!hasMore && exchangeList.length > 0}}">
      濞屸剝婀侀弴鏉戭樋閸熷棗鎼ф禍?    </view>
  </view>

  <!-- 缁涙盯鈧鑴婄粣?-->
  <view class="filter-popup" wx:if="{{showFilter}}" bindtap="onHideFilter">
    <view class="filter-content" catchtap="">
      <view class="filter-header">
        <text>閹烘帒绨弬鐟扮础</text>
        <view class="close-btn" bindtap="onHideFilter">鑴?/view>
      </view>
      <view class="filter-options">
        <view 
          wx:for="{{sortOptions}}" 
          wx:key="key" 
          class="option-item {{sortType === item.key ? 'active' : ''}}" 
          data-sort="{{item.key}}" 
          bindtap="onSelectSort">
          {{item.label}}
        </view>
      </view>
    </view>
  </view>
</view>
