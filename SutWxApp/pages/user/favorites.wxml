/**
 * 文件名: favorites.wxml
 * 版本号: 1.0.0
 * 更新日期: 2025-11-23
 * 描述: favorites 页面结构文件
 */
<view class="container">
  <!-- 标签切换 -->
  <view class="tabs">
    <view class="tabs-item {{activeTab === index ? 'active' : ''}}" 
          wx:for="{{tabs}}" 
          wx:key="index"
          data-index="{{index}}"
          bindtap="onTabChange">
      {{item}}
    </view>
  </view>

  <!-- 商品收藏列表 -->
  <view class="content" wx:if="{{activeTab === 0}}">
    <view class="list-header">
      <text class="count">共{{productFavorites.length}}件商品</text>
      <text class="edit-btn" bindtap="onEditMode" wx:if="{{!editMode && productFavorites.length > 0}}">管理</text>
    </view>
    
    <!-- 编辑模式操作栏 -->
    <view class="edit-bar" wx:if="{{editMode}}">
      <view class="select-all" bindtap="onSelectAll">
        <icon type="{{selectAll.product ? 'success' : 'circle'}}" size="18"/>
        <text>全选</text>
      </view>
      <view class="edit-actions">
        <text class="cancel-btn" bindtap="onCancelEdit">取消</text>
        <text class="delete-btn" bindtap="onDeleteSelected">删除</text>
      </view>
    </view>
    
    <!-- 商品列表 -->
    <view class="product-list" wx:if="{{productFavorites.length > 0}}">
      <view class="product-item" 
            wx:for="{{productFavorites}}" 
            wx:key="id"
            data-id="{{item.id}}"
            bindtap="onProductTap">
        <view class="select-box" wx:if="{{editMode}}" 
              data-id="{{item.id}}"
              data-type="product"
              bindtap="onSelectItem"
              catchtap="true">
          <icon type="{{selectedItems.product.indexOf(item.id) > -1 ? 'success' : 'circle'}}" size="18"/>
        </view>
        <image class="product-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-price">
            <text class="current-price">¥{{item.price}}</text>
            <text class="original-price" wx:if="{{item.originalPrice > item.price}}">¥{{item.originalPrice}}</text>
          </view>
          <view class="product-meta">
            <text class="sales">已售{{item.sales}}件</text>
            <text class="collect-time">{{item.collectTime}}收藏</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{productFavorites.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/empty/empty-favorite.png"></image>
      <text class="empty-text">暂无收藏商品</text>
      <button class="empty-btn" bindtap="goToHome">去逛逛</button>
    </view>
  </view>

  <!-- 文章收藏列表 -->
  <view class="content" wx:if="{{activeTab === 1}}">
    <view class="list-header">
      <text class="count">共{{articleFavorites.length}}篇文章</text>
      <text class="edit-btn" bindtap="onEditMode" wx:if="{{!editMode && articleFavorites.length > 0}}">管理</text>
    </view>
    
    <!-- 编辑模式操作栏 -->
    <view class="edit-bar" wx:if="{{editMode}}">
      <view class="select-all" bindtap="onSelectAll">
        <icon type="{{selectAll.article ? 'success' : 'circle'}}" size="18"/>
        <text>全选</text>
      </view>
      <view class="edit-actions">
        <text class="cancel-btn" bindtap="onCancelEdit">取消</text>
        <text class="delete-btn" bindtap="onDeleteSelected">删除</text>
      </view>
    </view>
    
    <!-- 文章列表 -->
    <view class="article-list" wx:if="{{articleFavorites.length > 0}}">
      <view class="article-item" 
            wx:for="{{articleFavorites}}" 
            wx:key="id"
            data-id="{{item.id}}"
            bindtap="onArticleTap">
        <view class="select-box" wx:if="{{editMode}}" 
              data-id="{{item.id}}"
              data-type="article"
              bindtap="onSelectItem"
              catchtap="true">
          <icon type="{{selectedItems.article.indexOf(item.id) > -1 ? 'success' : 'circle'}}" size="18"/>
        </view>
        <image class="article-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="article-info">
          <view class="article-title">{{item.title}}</view>
          <view class="article-summary">{{item.summary}}</view>
          <view class="article-meta">
            <text class="author">{{item.author}}</text>
            <text class="publish-time">{{item.publishTime}}</text>
            <text class="read-count">{{item.readCount}}阅读</text>
          </view>
          <view class="collect-time">{{item.collectTime}}收藏</view>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{articleFavorites.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/empty/empty-favorite.png"></image>
      <text class="empty-text">暂无收藏文章</text>
      <button class="empty-btn" bindtap="goToArticle">去看看</button>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 没有更多数据 -->
  <view class="no-more" wx:if="{{!hasMore[activeTab === 0 ? 'product' : 'article'] && (activeTab === 0 ? productFavorites : articleFavorites).length > 0}}">
    <text>没有更多了</text>
  </view>
</view>