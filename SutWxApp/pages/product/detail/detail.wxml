<!-- 鍟嗗搧璇︽儏椤甸潰 -->
<view class="container">
  <!-- 鍔犺浇涓姸鎬?-->
  <view class="loading" wx:if="{{loading}}">
    <text>鍔犺浇涓?..</text>
  </view>

  <!-- 閿欒鐘舵€?-->
  <view class="error" wx:if="{{error}}">
    <image src="/images/error.svg" class="error-icon"></image>
    <text class="error-text">{{errorMsg}}</text>
    <button class="retry-btn" bindtap="onRetry">閲嶈瘯</button>
  </view>

  <!-- 鍟嗗搧璇︽儏鍐呭 -->
  <view class="product-detail" wx:if="{{!loading && !error && product}}">
    <!-- 鍟嗗搧鍥剧墖杞挱 -->
    <swiper class="image-swiper" indicator-dots="true" autoplay="false" bindchange="onImageChange">
      <block wx:for="{{images}}" wx:key="index">
        <swiper-item>
          <image class="product-image" src="{{item}}" mode="aspectFill"></image>
        </swiper-item>
      </block>
      <view wx:if="{{images.length === 0}}">
        <image class="product-image" src="/images/default-post.svg" mode="aspectFill"></image>
      </view>
    </swiper>

    <!-- 鍟嗗搧鍩烘湰淇℃伅 -->
    <view class="product-info">
      <view class="product-price">楼{{selectedSku.price || product.price}}</view>
      <view class="product-title">{{product.title}}</view>
      <view class="product-meta">
        <text class="product-sales">閿€閲?{{product.sales || 0}}</text>
        <text class="product-stock" wx:if="{{selectedSku.stock || product.stock < 10}}">搴撳瓨 {{selectedSku.stock || product.stock}} 浠?/text>
      </view>
    </view>

    <!-- 鍟嗗搧瑙勬牸閫夋嫨 -->
    <view class="sku-section" wx:if="{{product.skus && product.skus.length > 0}}">
      <view class="section-title">閫夋嫨瑙勬牸</view>
      <view class="sku-list">
        <view 
          class="sku-item {{selectedSku.id === item.id ? 'active' : ''}}" 
          wx:for="{{product.skus}}" 
          wx:key="id"
          bindtap="onSkuSelect"
          data-id="{{item.id}}"
        >
          <text class="sku-name">{{item.name}}</text>
          <text class="sku-price">楼{{item.price}}</text>
          <text class="sku-stock" wx:if="{{item.stock < 10}}">浠呭墿{{item.stock}}浠?/text>
        </view>
      </view>
    </view>

    <!-- 璐拱鏁伴噺 -->
    <view class="quantity-section">
      <view class="section-title">璐拱鏁伴噺</view>
      <view class="quantity-control">
        <button class="quantity-btn" disabled="{{quantity <= 1}}" bindtap="onDecreaseQuantity">-</button>
        <view class="quantity-value">{{quantity}}</view>
        <button class="quantity-btn" disabled="{{quantity >= (selectedSku.stock || product.stock || 99)}}" bindtap="onIncreaseQuantity">+</button>
      </view>
    </view>

    <!-- 鍟嗗搧鎻忚堪 -->
    <view class="description-section">
      <view class="section-title">鍟嗗搧璇︽儏</view>
      <view class="product-description">
        <rich-text nodes="{{product.description}}"></rich-text>
      </view>
    </view>

    <!-- 鐩稿叧鍟嗗搧 -->
    <view class="related-section" wx:if="{{relatedProducts.length > 0}}">
      <view class="section-title">鐩稿叧鎺ㄨ崘</view>
      <view class="related-list">
        <view class="related-item" wx:for="{{relatedProducts}}" wx:key="id" bindtap="onRelatedProductTap" data-id="{{item.id}}">
          <image class="related-image" src="{{item.images[0] || '/images/default-post.svg'}}" mode="aspectFill"></image>
          <view class="related-info">
            <view class="related-title">{{item.title}}</view>
            <view class="related-price">楼{{item.price}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 搴曢儴鎿嶄綔鏍?-->
  <view class="bottom-bar" wx:if="{{!loading && !error && product}}">
    <view class="left-actions">
      <view class="action-item" bindtap="onToggleFavorite">
        <image class="action-icon" src="{{isFavorite ? '/images/favorite-active.png' : '/images/favorite.png'}}"></image>
        <text>鏀惰棌</text>
      </view>
    </view>
    <view class="right-actions">
      <button class="cart-btn" bindtap="addToCart">鍔犲叆璐墿杞?/button>
      <button class="buy-btn" bindtap="buyNow">绔嬪嵆璐拱</button>
    </view>
  </view>
</view>\n