锘?!-- 閸熷棗鎼х拠锔藉剰妞ょ敻娼?-->
<view class="container">
  <!-- 閸旂姾娴囨稉顓犲Ц閹?-->
  <view class="loading" wx:if="{{loading}}">
    <text>閸旂姾娴囨稉?..</text>
  </view>

  <!-- 闁挎瑨顕ら悩鑸碘偓?-->
  <view class="error" wx:if="{{error}}">
    <image src="/images/error.svg" class="error-icon"></image>
    <text class="error-text">{{errorMsg}}</text>
    <button class="retry-btn" bindtap="onRetry">闁插秷鐦?/button>
  </view>

  <!-- 閸熷棗鎼х拠锔藉剰閸愬懎顔?-->
  <view class="product-detail" wx:if="{{!loading && !error && product}}">
    <!-- 閸熷棗鎼ч崶鍓у鏉烆喗鎸?-->
    <swiper class="image-swiper" indicator-dots="true" autoplay="false" bindchange="onImageChange">
      <block wx:for="{{images}}" wx:key="index">
        <swiper-item>
          <image class="product-image" src="{{item}}" mode="aspectFill"></image>
        </swiper-item>
      </block>
      <view wx:if="{{images.length === 0}}">
        <image class="product-image" src="/images/default-post.svg" mode="aspectFill"></image>
      </view>
    </swiper>

    <!-- 閸熷棗鎼ч崺鐑樻拱娣団剝浼?-->
    <view class="product-info">
      <view class="product-price">妤納{selectedSku.price || product.price}}</view>
      <view class="product-title">{{product.title}}</view>
      <view class="product-meta">
        <text class="product-sales">闁库偓闁?{{product.sales || 0}}</text>
        <text class="product-stock" wx:if="{{selectedSku.stock || product.stock < 10}}">鎼存挸鐡?{{selectedSku.stock || product.stock}} 娴?/text>
      </view>
    </view>

    <!-- 閸熷棗鎼х憴鍕壐闁瀚?-->
    <view class="sku-section" wx:if="{{product.skus && product.skus.length > 0}}">
      <view class="section-title">闁瀚ㄧ憴鍕壐</view>
      <view class="sku-list">
        <view 
          class="sku-item {{selectedSku.id === item.id ? 'active' : ''}}" 
          wx:for="{{product.skus}}" 
          wx:key="id"
          bindtap="onSkuSelect"
          data-id="{{item.id}}"
        >
          <text class="sku-name">{{item.name}}</text>
          <text class="sku-price">妤納{item.price}}</text>
          <text class="sku-stock" wx:if="{{item.stock < 10}}">娴犲懎澧縶{item.stock}}娴?/text>
        </view>
      </view>
    </view>

    <!-- 鐠愵厺鎷遍弫浼村櫤 -->
    <view class="quantity-section">
      <view class="section-title">鐠愵厺鎷遍弫浼村櫤</view>
      <view class="quantity-control">
        <button class="quantity-btn" disabled="{{quantity <= 1}}" bindtap="onDecreaseQuantity">-</button>
        <view class="quantity-value">{{quantity}}</view>
        <button class="quantity-btn" disabled="{{quantity >= (selectedSku.stock || product.stock || 99)}}" bindtap="onIncreaseQuantity">+</button>
      </view>
    </view>

    <!-- 閸熷棗鎼ч幓蹇氬牚 -->
    <view class="description-section">
      <view class="section-title">閸熷棗鎼х拠锔藉剰</view>
      <view class="product-description">
        <rich-text nodes="{{product.description}}"></rich-text>
      </view>
    </view>

    <!-- 閻╃鍙ч崯鍡楁惂 -->
    <view class="related-section" wx:if="{{relatedProducts.length > 0}}">
      <view class="section-title">閻╃鍙ч幒銊ㄥ礃</view>
      <view class="related-list">
        <view class="related-item" wx:for="{{relatedProducts}}" wx:key="id" bindtap="onRelatedProductTap" data-id="{{item.id}}">
          <image class="related-image" src="{{item.images[0] || '/images/default-post.svg'}}" mode="aspectFill"></image>
          <view class="related-info">
            <view class="related-title">{{item.title}}</view>
            <view class="related-price">妤納{item.price}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 鎼存洟鍎撮幙宥勭稊閺?-->
  <view class="bottom-bar" wx:if="{{!loading && !error && product}}">
    <view class="left-actions">
      <view class="action-item" bindtap="onToggleFavorite">
        <image class="action-icon" src="{{isFavorite ? '/images/favorite-active.png' : '/images/favorite.png'}}"></image>
        <text>閺€鎯版</text>
      </view>
    </view>
    <view class="right-actions">
      <button class="cart-btn" bindtap="addToCart">閸旂姴鍙嗙拹顓犲⒖鏉?/button>
      <button class="buy-btn" bindtap="buyNow">缁斿宓嗙拹顓濇嫳</button>
    </view>
  </view>
</view>\n