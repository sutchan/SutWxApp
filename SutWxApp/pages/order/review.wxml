<!-- review.wxml - 璁㈠崟璇勪环椤甸潰妯℃澘 -->

<view class="review-container">
  <!-- 椤堕儴瀵艰埅 -->
  <view class="nav-bar">
    <view class="nav-back" bindtap="navigateBack">
      <text>杩斿洖</text>
    </view>
    <view class="nav-title">璇勪环璁㈠崟</view>
    <view class="nav-placeholder"></view>
  </view>

  <!-- 鍔犺浇涓姸鎬?-->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">
      <text>鍔犺浇涓?..</text>
    </view>
  </view>

  <!-- 閿欒鐘舵€?-->
  <view class="error-container" wx:if="{{error}}">
    <view class="error-message">{{errorMessage}}</view>
    <button class="btn-primary" bindtap="loadOrderItems">閲嶆柊鍔犺浇</button>
  </view>

  <!-- 璇勪环鍐呭 -->
  <view class="review-content" wx:if="{{!loading && !error && reviewData.length > 0}}">
    <!-- 鍖垮悕璇勪环閫夐」 -->
    <view class="anonymous-option">
      <text class="anonymous-label">鍖垮悕璇勪环</text>
      <switch class="anonymous-switch" checked="{{anonymous}}" bindchange="toggleAnonymous"></switch>
    </view>

    <!-- 鍟嗗搧璇勪环鍒楄〃 -->
    <view class="goods-review-list">
      <view wx:for="{{reviewData}}" wx:key="index" class="goods-review-item">
        <!-- 鍟嗗搧淇℃伅 -->
        <view class="goods-info">
          <view class="goods-image">
            <image src="{{item.product_image}}" mode="aspectFit"></image>
          </view>
          <view class="goods-details">
            <view class="goods-name">{{item.product_name}}</view>
            <view wx:if="{{item.specs}}" class="goods-specs">{{item.specs}}</view>
          </view>
        </view>

        <!-- 璇勫垎 -->
        <view class="rating-section">
          <view class="rating-label">璇勫垎</view>
          <view class="rating-stars">
            <view 
              wx:for="[1, 2, 3, 4, 5]" 
              wx:for-item="star" 
              wx:key="star" 
              class="star {{star <= item.score ? 'active' : ''}}" 
              bindtap="setScore" 
              data-index="{{index}}" 
              data-score="{{star}}"
            >
              鈽?            </view>
          </view>
        </view>

        <!-- 璇勪环鍐呭 -->
        <view class="content-section">
          <view class="content-label">璇勪环鍐呭</view>
          <textarea 
            class="content-input" 
            placeholder="璇疯緭鍏ユ偍瀵瑰晢鍝佺殑璇勪环" 
            value="{{item.content}}" 
            bindinput="inputContent" 
            data-index="{{index}}"
            maxlength="200"
          ></textarea>
          <view class="content-count">{{item.content.length}}/200</view>
        </view>

        <!-- 鍥剧墖涓婁紶 -->
        <view class="image-section">
          <view class="image-label">涓婁紶鍥剧墖</view>
          <view class="image-uploader">
            <!-- 宸蹭笂浼犲浘鐗?-->
            <view 
              wx:for="{{item.images}}" 
              wx:for-item="image" 
              wx:for-index="imageIndex" 
              wx:key="imageIndex" 
              class="image-item" 
              bindtap="previewImage" 
              data-index="{{index}}" 
              data-image-index="{{imageIndex}}"
            >
              <image src="{{image}}" mode="aspectFit"></image>
              <view class="image-delete" bindtap="deleteImage" data-index="{{index}}" data-image-index="{{imageIndex}}">脳</view>
            </view>
            <!-- 娣诲姞鍥剧墖鎸夐挳 -->
            <view 
              wx:if="{{item.images.length < 5}}" 
              class="image-add" 
              bindtap="chooseImage" 
              data-index="{{index}}"
            >
              <view class="add-icon">+</view>
              <view class="add-text">娣诲姞鍥剧墖</view>
              <view class="add-tip">{{item.images.length}}/5</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 鎻愪氦鎸夐挳 -->
  <view class="submit-bar" wx:if="{{!loading && !error && reviewData.length > 0}}">
    <button 
      class="btn-submit" 
      bindtap="submitReview" 
      disabled="{{submitting}}"
    >
      {{submitting ? '鎻愪氦涓?..' : '鎻愪氦璇勪环'}}
    </button>
  </view>
</view>\n