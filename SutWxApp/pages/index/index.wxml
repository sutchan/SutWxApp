<!-- pages/index/index.wxml -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading && !error}}" aria-label="é¡µé¢åŠ è½½ä¸­">
    <view class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:if="{{error}}" aria-label="é¡µé¢åŠ è½½é”™è¯¯">
    <image src="/images/error.png" class="error-icon"></image>
    <text class="error-text">{{error}}</text>
    <button class="retry-button" bindtap="onRetry">é‡è¯•</button>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view wx:elif="{{!loading && !error}}">
    <!-- è½®æ’­å›¾ -->
    <view class="banner-container" aria-label="è½®æ’­å¹¿å‘Š">
      <swiper class="banner-swiper" indicator-dots="true" autoplay="true" interval="3000" duration="500" circular="true" skip-hidden-item-layout="true">
        <block wx:for="{{bannerList}}" wx:key="id">
          <swiper-item bindtap="onBannerClick" data-item="{{item}}" aria-label="ç‚¹å‡»æŸ¥çœ‹ï¼š{{item.title}}">
            <image src="{{item.image_url}}" mode="aspectFill" class="banner-image" aria-label="è½®æ’­å›¾ç‰‡ï¼š{{item.title}}"></image>
            <view class="banner-title">{{item.title}}</view>
          </swiper-item>
        </block>
      </swiper>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-container" bindtap="navigateToSearch" aria-label="æœç´¢æ–‡ç« ">
      <view class="search-bar">
        <text class="search-icon">ğŸ”</text>
        <text class="search-text">æœç´¢æ–‡ç« ...</text>
      </view>
    </view>

    <!-- åˆ†ç±»å¯¼èˆª -->
    <view class="categories-container" aria-label="åˆ†ç±»å¯¼èˆª">
      <view class="section-title">
        <text>åˆ†ç±»å¯¼èˆª</text>
        <view class="more" bindtap="navigateToCategories" aria-label="æŸ¥çœ‹æ›´å¤šåˆ†ç±»">
          <text>æ›´å¤š</text>
          <text class="icon">></text>
        </view>
      </view>
      <view class="categories-list">
        <block wx:for="{{categories}}" wx:key="id">
          <view class="category-item" bindtap="navigateToCategoryPosts" data-id="{{item.id}}" aria-label="æŸ¥çœ‹{{item.name}}åˆ†ç±»ï¼Œå…±{{item.count}}ç¯‡æ–‡ç« ">
            <view class="category-icon">
              <text>{{item.name.charAt(0)}}</text>
            </view>
            <text class="category-name">{{item.name}}</text>
            <text class="category-count">({{item.count}})</text>
          </view>
        </block>
      </view>
    </view>

    <!-- çƒ­é—¨æ–‡ç«  -->
    <view class="hot-posts-container" aria-label="çƒ­é—¨æ¨èæ–‡ç« ">
      <view class="section-title">
        <text>çƒ­é—¨æ¨è</text>
      </view>
      <view class="hot-posts-list">
        <block wx:for="{{hotPosts}}" wx:key="id">
          <view class="hot-post-item" bindtap="navigateToPostDetail" data-id="{{item.id}}" aria-label="çƒ­é—¨ç¬¬{{index + 1}}åï¼š{{item.title}}ï¼Œ{{item.views}}é˜…è¯»">
            <view class="hot-post-rank" wx:if="{{index < 3}}" style="background-color: {{index === 0 ? '#FF6B6B' : index === 1 ? '#4ECDC4' : '#45B7D1'}}">{{index + 1}}</view>
            <view class="hot-post-rank" wx:else>{{index + 1}}</view>
            <text class="hot-post-title">{{item.title}}</text>
            <text class="hot-post-views">{{item.views}}é˜…è¯»</text>
          </view>
        </block>
      </view>
    </view>

    <!-- æœ€æ–°æ–‡ç«  -->
    <view class="latest-posts-container" aria-label="æœ€æ–°èµ„è®¯æ–‡ç« ">
      <view class="section-title">
        <text>æœ€æ–°èµ„è®¯</text>
      </view>
      <view class="latest-posts-list">
        <block wx:for="{{latestPosts}}" wx:key="id">
          <view class="post-item" bindtap="navigateToPostDetail" data-id="{{item.id}}" aria-label="æŸ¥çœ‹æ–‡ç« ï¼š{{item.title}}">
            <image src="{{item.featured_image || '/images/default-post.png'}}" mode="aspectFill" class="post-image" aria-label="æ–‡ç« ç¼©ç•¥å›¾"></image>
            <view class="post-content">
              <text class="post-title">{{item.title}}</text>
              <view class="post-meta">
                <text class="post-category">{{item.category_name}}</text>
                <text class="post-date">{{item.date}}</text>
                <text class="post-views">{{item.views}}é˜…è¯»</text>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="loading-more" wx:if="{{loadingMore}}" aria-label="åŠ è½½æ›´å¤šå†…å®¹">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{!hasMore && latestPosts.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{!loading && !loadingMore && latestPosts.length === 0}}">
      <image src="/images/empty.png" mode="aspectFit" class="empty-icon"></image>
      <text class="empty-text">æš‚æ— æ–‡ç« </text>
      <button class="empty-button" bindtap="onRetry">åˆ·æ–°</button>
    </view>
  </view>

  <!-- éª¨æ¶å± -->
  <view class="skeleton-container" wx:if="{{showSkeleton && loading}}">
    <view class="skeleton-banner"></view>
    <view class="skeleton-search"></view>
    <view class="skeleton-section-title"></view>
    <view class="skeleton-categories">
      <view class="skeleton-category" wx:for="[1,2,3,4,5]" wx:key="index"></view>
    </view>
    <view class="skeleton-section-title"></view>
    <view class="skeleton-hot-posts">
      <view class="skeleton-hot-post" wx:for="[1,2,3]" wx:key="index"></view>
    </view>
    <view class="skeleton-section-title"></view>
    <view class="skeleton-posts">
      <view class="skeleton-post" wx:for="[1,2,3]" wx:key="index">
        <view class="skeleton-post-image"></view>
        <view class="skeleton-post-content">
          <view class="skeleton-post-title"></view>
          <view class="skeleton-post-meta"></view>
        </view>
      </view>
    </view>
  </view>
</view>