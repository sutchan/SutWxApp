/**\n * 鏂囦欢鍚? list.js\n * 鐗堟湰鍙? 1.0.0\n * 鏇存柊鏃ユ湡: 2025-11-29\n * 鎻忚堪: 鍒嗛攢鍒楄〃椤甸潰\n */\n\nconst distributeService = require('../../services/distributeService');\nconst store = require('../../utils/store');\n\nPage({\n  data: {\n    distributeList: [],\n    status: 'all', // all/pending/approved/rejected/deleted\n    type: 'all', // all/product/article\n    page: 1,\n    pageSize: 20,\n    total: 0,\n    loading: false,\n    hasMore: true\n  },\n\n  onLoad(options) {\n    // 鍒濆鍖栨暟鎹?
    this.setData({\n      status: options.status || 'all',\n      type: options.type || 'all'\n    });\n    this.getDistributeList();\n  },\n\n  onShow() {\n    // 椤甸潰鏄剧ず鏃跺埛鏂版暟鎹?
    this.setData({\n      page: 1,\n      distributeList: [],\n      hasMore: true\n    });\n    this.getDistributeList();\n  },\n\n  onReachBottom() {\n    // 瑙﹀簳鍔犺浇鏇村\n    if (!this.data.loading && this.data.hasMore) {\n      this.setData({\n        page: this.data.page + 1\n      });\n      this.getDistributeList();\n    }\n  },\n\n  onPullDownRefresh() {\n    // 涓嬫媺鍒锋柊\n    this.setData({\n      page: 1,\n      distributeList: [],\n      hasMore: true\n    });\n    this.getDistributeList(() => {\n      wx.stopPullDownRefresh();\n    });\n  },\n\n  /**\n   * 鑾峰彇鍒嗛攢鍒楄〃\n   * @param {Function} callback - 鍥炶皟鍑芥暟\n   */\n  getDistributeList(callback) {\n    if (this.data.loading) return;\n\n    this.setData({ loading: true });\n\n    distributeService.getDistributeList({\n      status: this.data.status,\n      type: this.data.type,\n      page: this.data.page,\n      pageSize: this.data.pageSize\n    })\n      .then(res => {\n        const newList = this.data.page === 1 ? res.list : [...this.data.distributeList, ...res.list];\n        this.setData({\n          distributeList: newList,\n          total: res.total,\n          hasMore: newList.length < res.total,\n          loading: false\n        });\n        if (callback) callback();\n      })\n      .catch(err => {\n        console.error('鑾峰彇鍒嗛攢鍒楄〃澶辫触:', err);\n        this.setData({ loading: false });\n        wx.showToast({\n          title: '鑾峰彇鍒嗛攢鍒楄〃澶辫触',\n          icon: 'none'\n        });\n        if (callback) callback();\n      });\n  },\n\n  /**\n   * 鍒囨崲鐘舵€佺瓫閫?
   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  onStatusChange(e) {\n    this.setData({\n      status: e.detail.value,\n      page: 1,\n      distributeList: [],\n      hasMore: true\n    });\n    this.getDistributeList();\n  },\n\n  /**\n   * 鍒囨崲绫诲瀷绛涢€?
   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  onTypeChange(e) {\n    this.setData({\n      type: e.detail.value,\n      page: 1,\n      distributeList: [],\n      hasMore: true\n    });\n    this.getDistributeList();\n  },\n\n  /**\n   * 璺宠浆鍒板垎閿€璇︽儏\n   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  goToDetail(e) {\n    const id = e.currentTarget.dataset.id;\n    wx.navigateTo({\n      url: `/pages/distribute/detail?id=${id}`\n    });\n  },\n\n  /**\n   * 瀹℃牳鍒嗛攢\n   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  approveDistribute(e) {\n    const id = e.currentTarget.dataset.id;\n    wx.showModal({\n      title: '瀹℃牳鍒嗛攢',\n      content: '纭畾瑕佸鏍搁€氳繃璇ュ垎閿€鍚楋紵',\n      success: (res) => {\n        if (res.confirm) {\n          this.handleApprove(id);\n        }\n      }\n    });\n  },\n\n  /**\n   * 澶勭悊瀹℃牳閫氳繃\n   * @param {string} id - 鍒嗛攢ID\n   */\n  handleApprove(id) {\n    wx.showLoading({\n      title: '瀹℃牳涓?..'\n    });\n\n    distributeService.approveDistribute(id)\n      .then(() => {\n        wx.hideLoading();\n        wx.showToast({\n          title: '瀹℃牳閫氳繃鎴愬姛'\n        });\n        // 鍒锋柊鍒楄〃\n        this.setData({\n          page: 1,\n          distributeList: [],\n          hasMore: true\n        });\n        this.getDistributeList();\n      })\n      .catch(err => {\n        wx.hideLoading();\n        console.error('瀹℃牳閫氳繃澶辫触:', err);\n        wx.showToast({\n          title: '瀹℃牳閫氳繃澶辫触',\n          icon: 'none'\n        });\n      });\n  },\n\n  /**\n   * 椹冲洖鍒嗛攢\n   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  rejectDistribute(e) {\n    const id = e.currentTarget.dataset.id;\n    wx.showModal({\n      title: '椹冲洖鍒嗛攢',\n      content: '纭畾瑕侀┏鍥炶鍒嗛攢鍚楋紵',\n      success: (res) => {\n        if (res.confirm) {\n          this.showRejectReasonInput(id);\n        }\n      }\n    });\n  },\n\n  /**\n   * 鏄剧ず椹冲洖鍘熷洜杈撳叆妗?
   * @param {string} id - 鍒嗛攢ID\n   */\n  showRejectReasonInput(id) {\n    wx.showModal({\n      title: '璇疯緭鍏ラ┏鍥炲師鍥?,\n      editable: true,\n      placeholderText: '璇疯緭鍏ラ┏鍥炲師鍥?,\n      success: (res) => {\n        if (res.confirm && res.content.trim()) {\n          this.handleReject(id, res.content.trim());\n        }\n      }\n    });\n  },\n\n  /**\n   * 澶勭悊椹冲洖\n   * @param {string} id - 鍒嗛攢ID\n   * @param {string} reason - 椹冲洖鍘熷洜\n   */\n  handleReject(id, reason) {\n    wx.showLoading({\n      title: '椹冲洖涓?..'\n    });\n\n    distributeService.rejectDistribute(id, reason)\n      .then(() => {\n        wx.hideLoading();\n        wx.showToast({\n          title: '椹冲洖鎴愬姛'\n        });\n        // 鍒锋柊鍒楄〃\n        this.setData({\n          page: 1,\n          distributeList: [],\n          hasMore: true\n        });\n        this.getDistributeList();\n      })\n      .catch(err => {\n        wx.hideLoading();\n        console.error('椹冲洖澶辫触:', err);\n        wx.showToast({\n          title: '椹冲洖澶辫触',\n          icon: 'none'\n        });\n      });\n  },\n\n  /**\n   * 鍒犻櫎鍒嗛攢\n   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  deleteDistribute(e) {\n    const id = e.currentTarget.dataset.id;\n    wx.showModal({\n      title: '鍒犻櫎鍒嗛攢',\n      content: '纭畾瑕佸垹闄よ鍒嗛攢鍚楋紵',\n      success: (res) => {\n        if (res.confirm) {\n          this.showDeleteReasonInput(id);\n        }\n      }\n    });\n  },\n\n  /**\n   * 鏄剧ず鍒犻櫎鍘熷洜杈撳叆妗?
   * @param {string} id - 鍒嗛攢ID\n   */\n  showDeleteReasonInput(id) {\n    wx.showModal({\n      title: '璇疯緭鍏ュ垹闄ゅ師鍥?,\n      editable: true,\n      placeholderText: '璇疯緭鍏ュ垹闄ゅ師鍥?,\n      success: (res) => {\n        if (res.confirm && res.content.trim()) {\n          this.handleDelete(id, res.content.trim());\n        }\n      }\n    });\n  },\n\n  /**\n   * 澶勭悊鍒犻櫎\n   * @param {string} id - 鍒嗛攢ID\n   * @param {string} reason - 鍒犻櫎鍘熷洜\n   */\n  handleDelete(id, reason) {\n    wx.showLoading({\n      title: '鍒犻櫎涓?..'\n    });\n\n    distributeService.deleteDistribute(id, reason)\n      .then(() => {\n        wx.hideLoading();\n        wx.showToast({\n          title: '鍒犻櫎鎴愬姛'\n        });\n        // 鍒锋柊鍒楄〃\n        this.setData({\n          page: 1,\n          distributeList: [],\n          hasMore: true\n        });\n        this.getDistributeList();\n      })\n      .catch(err => {\n        wx.hideLoading();\n        console.error('鍒犻櫎澶辫触:', err);\n        wx.showToast({\n          title: '鍒犻櫎澶辫触',\n          icon: 'none'\n        });\n      });\n  }\n});