/**\n * 鏂囦欢鍚? settings.js\n * 鐗堟湰鍙? 1.0.0\n * 鏇存柊鏃ユ湡: 2025-11-30\n * 鎻忚堪: 閫氱煡璁剧疆椤甸潰\n */\nconst notificationService = require('../../services/notificationService');\n\nPage({\n  /**\n   * 椤甸潰鐨勫垵濮嬫暟鎹?
   */\n  data: {\n    settings: null,\n    loading: true,\n    unreadCount: 0\n  },\n\n  /**\n   * 鐢熷懡鍛ㄦ湡鍑芥暟--鐩戝惉椤甸潰鍔犺浇\n   */\n  onLoad: function () {\n    this.loadNotificationSettings();\n    this.loadUnreadCount();\n  },\n\n  /**\n   * 鐢熷懡鍛ㄦ湡鍑芥暟--鐩戝惉椤甸潰鏄剧ず\n   */\n  onShow: function () {\n    this.loadNotificationSettings();\n    this.loadUnreadCount();\n  },\n\n  /**\n   * 鍔犺浇閫氱煡璁剧疆\n   */\n  loadNotificationSettings: function () {\n    this.setData({\n      loading: true\n    });\n    \n    notificationService.getNotificationSettings()\n      .then(res => {\n        this.setData({\n          settings: res,\n          loading: false\n        });\n      })\n      .catch(err => {\n        this.setData({\n          loading: false\n        });\n        \n        wx.showToast({\n          title: err.message || '鍔犺浇閫氱煡璁剧疆澶辫触',\n          icon: 'none'\n        });\n      });\n  },\n\n  /**\n   * 鍔犺浇鏈閫氱煡鏁伴噺\n   */\n  loadUnreadCount: function () {\n    notificationService.getUnreadCount()\n      .then(res => {\n        this.setData({\n          unreadCount: res.count || 0\n        });\n      })\n      .catch(err => {\n        console.error('鍔犺浇鏈閫氱煡鏁伴噺澶辫触:', err);\n      });\n  },\n\n  /**\n   * 鏇存柊閫氱煡璁剧疆\n   * @param {Object} newSettings - 鏂扮殑璁剧疆\n   */\n  updateSettings: function (newSettings) {\n    const settings = { ...this.data.settings, ...newSettings };\n    \n    this.setData({\n      settings\n    });\n    \n    notificationService.updateNotificationSettings(settings)\n      .catch(err => {\n        wx.showToast({\n          title: err.message || '鏇存柊閫氱煡璁剧疆澶辫触',\n          icon: 'none'\n        });\n        \n        // 鎭㈠鍘熻缃?
        this.loadNotificationSettings();\n      });\n  },\n\n  /**\n   * 绯荤粺閫氱煡寮€鍏冲彉鍖?
   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  onSystemNotificationChange: function (e) {\n    const { value } = e.detail;\n    this.updateSettings({ systemNotification: value });\n  },\n\n  /**\n   * 璁㈠崟閫氱煡寮€鍏冲彉鍖?
   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  onOrderNotificationChange: function (e) {\n    const { value } = e.detail;\n    this.updateSettings({ orderNotification: value });\n  },\n\n  /**\n   * 淇冮攢閫氱煡寮€鍏冲彉鍖?
   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  onPromotionNotificationChange: function (e) {\n    const { value } = e.detail;\n    this.updateSettings({ promotionNotification: value });\n  },\n\n  /**\n   * 娲诲姩閫氱煡寮€鍏冲彉鍖?
   * @param {Object} e - 浜嬩欢瀵硅薄\n   */\n  onActivityNotificationChange: function (e) {\n    const { value } = e.detail;\n    this.updateSettings({ activityNotification: value });\n  },\n\n  /**\n   * 娓呯┖鎵€鏈夐€氱煡\n   */\n  onClearNotifications: function () {\n    wx.showModal({\n      title: '纭娓呯┖',\n      content: '纭畾瑕佹竻绌烘墍鏈夊凡璇婚€氱煡鍚楋紵',\n      success: (res) => {\n        if (res.confirm) {\n          this.setData({\n            loading: true\n          });\n          \n          notificationService.deleteNotification()\n            .then(() => {\n              this.setData({\n                loading: false\n              });\n              \n              wx.showToast({\n                title: '娓呯┖鎴愬姛',\n                icon: 'success'\n              });\n              \n              // 鍒锋柊鏈鏁伴噺\n              this.loadUnreadCount();\n            })\n            .catch(err => {\n              this.setData({\n                loading: false\n              });\n              \n              wx.showToast({\n                title: err.message || '娓呯┖閫氱煡澶辫触',\n                icon: 'none'\n              });\n            });\n        }\n      }\n    });\n  }\n});