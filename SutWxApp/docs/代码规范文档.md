# 苏特微信小程序代码规范文档

## 1. 项目概述

- **项目名称**: 苏特微信小程序(SutWxApp)
- **项目仓库**: https://github.com/sutchan
- **默认署名**: Sut
- **开发环境**: Windows

## 2. 代码规范工具

本项目使用以下工具确保代码质量和一致性：

- **ESLint**: JavaScript代码质量检查工具
- **Prettier**: 代码格式化工具
- **Husky**: Git钩子工具，在提交前自动运行检查
- **lint-staged**: 只对暂存区的文件进行检查

## 3. 代码风格规范

### 3.1 JavaScript规范

- **缩进**: 使用 2 个空格
- **行宽**: 每行不超过 100 个字符
- **引号**: 使用单引号 `'`
- **分号**: 语句末尾必须使用分号
- **括号**: 使用大括号 `{}` 包围所有代码块
- **逗号**: 不使用尾随逗号
- **换行符**: 使用 Unix LF (\n)

### 3.2 命名规范

- **变量名**: 小驼峰命名法，如 `userInfo`
- **函数名**: 小驼峰命名法，如 `getUserInfo`
- **类名**: 大驼峰命名法，如 `UserManager`
- **常量**: 全大写字母，单词间用下划线分隔，如 `MAX_RETRY_COUNT`
- **文件命名**: 小驼峰命名法，如 `userService.js`

### 3.3 注释规范

- **文件头部**: 必须包含文件名、版本号、更新日期和描述
- **函数注释**: 每个函数必须有注释，描述功能、参数和返回值
- **复杂逻辑**: 关键逻辑必须有行内注释
- **注释语言**: 统一使用中文

```javascript
/**
 * 文件名: example.js
 * 版本号: 1.0.0
 * 更新日期: 2025-11-24
 * 描述: 示例文件
 */

/**
 * 获取用户信息
 * @param {string} userId - 用户ID
 * @param {boolean} withPermission - 是否包含权限信息
 * @returns {Promise<Object>} 用户信息对象
 */
async function getUserInfo(userId, withPermission = false) {
  // 查询用户基本信息
  const userInfo = await userApi.getUserBaseInfo(userId);
  
  if (withPermission) {
    // 获取用户权限信息
    const permissions = await userApi.getUserPermissions(userId);
    return { ...userInfo, permissions };
  }
  
  return userInfo;
}
```

## 4. 微信小程序特有规范

### 4.1 页面和组件结构

- 每个页面或组件应有独立的文件夹
- 文件命名与文件夹名保持一致
- 页面包含 .js、.json、.wxml、.wxss 文件
- 组件包含 .js、.json、.wxml、.wxss 文件

### 4.2 全局对象使用

使用预定义的全局对象：
- `wx`: 微信小程序全局API
- `getApp()`: 获取App实例
- `getCurrentPages()`: 获取页面栈

### 4.3 生命周期方法

按照标准顺序使用生命周期方法：
- 页面: `onLoad` -> `onShow` -> `onReady` -> `onHide` -> `onUnload`
- 组件: `created` -> `attached` -> `ready` -> `moved` -> `detached`

## 5. 性能优化规范

### 5.1 资源优化

- 图片使用合适的格式和大小
- 使用 `lazy-image` 组件实现图片懒加载
- 避免不必要的网络请求
- 合理使用缓存机制

### 5.2 代码优化

- 避免在 `onShow` 中进行复杂计算
- 使用条件渲染替代频繁的显隐切换
- 使用 `setData` 时避免传递不必要的数据
- 优先使用模板字符串 `\`\`` 替代字符串拼接

## 6. 安全规范

- 不允许在代码中硬编码敏感信息
- API密钥和凭证信息必须通过环境变量或配置文件管理
- 输入数据必须进行验证和转义
- 避免使用不安全的第三方库

## 7. 代码审查流程

1. 开发人员在提交代码前运行 `npm run lint` 检查代码质量
2. 使用 `npm run lint:fix` 自动修复常见问题
3. Git钩子会在提交前自动运行检查
4. 代码提交后进行团队审查

## 8. 常见问题及解决方案

### 8.1 ESLint 错误修复

**常见错误**:
- `no-unused-vars`: 删除未使用的变量
- `indent`: 修正缩进为2个空格
- `quotes`: 统一使用单引号
- `semi`: 添加缺失的分号

**修复命令**:
```bash
npm run lint:fix
```

### 8.2 Prettier 格式化

**手动格式化**:
```bash
npx prettier --write "**/*.js"
```

## 9. 版本历史

| 版本号 | 更新日期 | 更新内容 |
|--------|----------|----------|
| 1.0.0  | 2025-11-24 | 初始版本 |

---

*本文档将根据项目发展持续更新*